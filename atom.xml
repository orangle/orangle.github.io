<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Orangleliu Notes</title>
  
  <subtitle>çˆ±åª³å¦‡ï¼Œçˆ±ç”Ÿæ´»ï¼ŒLinuxï¼ŒPython</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://orangleliu.info/"/>
  <updated>2017-03-24T08:37:29.000Z</updated>
  <id>http://orangleliu.info/</id>
  
  <author>
    <name>orangleliu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Openresty generates QR code</title>
    <link href="http://orangleliu.info/2017/03/24/openresty-lua-resty-qrcode/"/>
    <id>http://orangleliu.info/2017/03/24/openresty-lua-resty-qrcode/</id>
    <published>2017-03-24T05:45:11.000Z</published>
    <updated>2017-03-24T08:37:29.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>I would like to use openresty(ngx_lua) to do QRcode generation API, then I found two libraries <a href="https://github.com/dcshi/lua-resty-QRcode" target="_blank" rel="noopener">lua-resty-QRcode</a> and <a href="https://github.com/vincascm/qrencode" target="_blank" rel="noopener">qrencode</a>. After comparisonï¼Œ<a href="https://github.com/vincascm/qrencode" target="_blank" rel="noopener">qrencode</a> is simple to install and use, here is an example of hope that interested friends have inspired</p></blockquote><p>Both of these libraries are dependent <a href="http://fukuchi.org/works/qrencode/" target="_blank" rel="noopener">libqrencode</a> and <a href="http://www.libpng.org/pub/png/libpng.html" target="_blank" rel="noopener">libpng</a> </p><p>Steps for usage:</p><ul><li>install <a href="http://fukuchi.org/works/qrencode/" target="_blank" rel="noopener">libqrencode</a> and <a href="http://www.libpng.org/pub/png/libpng.html" target="_blank" rel="noopener">libpng</a> </li><li>get qrencode, and compiled into a dynamic library <code>qrencode.so</code></li><li>Openresty lua call dynamic library to generate qrcode </li></ul><p>openresty1.9.7  was installed on my Mac book.</p><h2 id="install-libqrencodeï¼Œlibpng"><a href="#install-libqrencodeï¼Œlibpng" class="headerlink" title="install libqrencodeï¼Œlibpng"></a>install libqrencodeï¼Œlibpng</h2><p>you can install them with source code, or following methods</p><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libqrencode-<span class="built_in">dev</span> libpng12-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install libpng-devel</span><br><span class="line"></span><br><span class="line">wget http:<span class="comment">//ftp.riken.jp/Linux/centos/7/os/x86_64/Packages/qrencode-devel-3.4.1-3.el7.x86_64.rpm</span></span><br><span class="line">rpm -ivh qrencode-devel-<span class="number">3.4</span>.<span class="number">1</span>-<span class="number">3</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure><h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>libqrencode</span><br></pre></td></tr></table></figure><p>will auto install libpng.</p><h2 id="install-lua-library-qrencode"><a href="#install-lua-library-qrencode" class="headerlink" title="install lua library qrencode"></a>install lua library qrencode</h2><p>ï¼ï¼For the use of openresty I rewrite the makefile, you can find  <a href="https://github.com/orangle/lua-resty-qrencode" target="_blank" rel="noopener">https://github.com/orangle/lua-resty-qrencode</a> , the Makefile default for Macos, if you use other os like centos, please read Makefile and modify it.</p><p>manual version is below</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/vincascm/qrencode.git</span></span><br><span class="line"></span><br><span class="line">## <span class="keyword">on</span> macos </span><br><span class="line">gcc -bundle -undefined dynamic_lookup -lpng -lqrencode -I/usr/<span class="keyword">local</span>/openresty/luajit/<span class="keyword">include</span>/luajit-2.1/ qrencode.c -o qrencode.<span class="keyword">so</span></span><br><span class="line">cp <span class="keyword">test</span>/<span class="keyword">test</span>.lua ./</span><br><span class="line">/usr/<span class="keyword">local</span>/openresty/luajit/bin/luajit <span class="keyword">test</span>.lua</span><br></pre></td></tr></table></figure><p>then you can see some output on your screen.</p><h2 id="openresty-qrcode-code"><a href="#openresty-qrcode-code" class="headerlink" title="openresty qrcode code"></a>openresty qrcode code</h2><p>copy qrencode.so to openrestyâ€™s lualib directory, or you can set lualib path in nginx conf file.</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp qrencode.so  <span class="regexp">/usr/</span>local<span class="regexp">/openresty/</span>lualib<span class="regexp">/</span></span><br></pre></td></tr></table></figure><p>lua code in nginx conf<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">location /qrcode &#123;</span><br><span class="line">        content_by_lua_block &#123;</span><br><span class="line">            <span class="built_in">local</span> qr = require(<span class="string">"qrencode"</span>)</span><br><span class="line">            <span class="built_in">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">            <span class="built_in">local</span> <span class="built_in">text</span> = args.<span class="built_in">text</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">text</span> == <span class="literal">nil</span> <span class="built_in">or</span> <span class="built_in">text</span>== <span class="string">""</span> <span class="keyword">then</span></span><br><span class="line">                ngx.<span class="built_in">say</span>(<span class="string">'need a text param'</span>)</span><br><span class="line">                ngx.<span class="keyword">exit</span>(<span class="number">404</span>)</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            ngx.<span class="built_in">say</span>(qr &#123;</span><br><span class="line">                <span class="built_in">text</span>=<span class="built_in">text</span>,</span><br><span class="line">                level=<span class="string">"L"</span>,</span><br><span class="line">                kanji=<span class="literal">false</span>,</span><br><span class="line">                ansi=<span class="literal">true</span>,</span><br><span class="line">                <span class="built_in">size</span>=<span class="number">4</span>,</span><br><span class="line">                margin=<span class="number">2</span>,</span><br><span class="line">                symversion=<span class="number">0</span>,</span><br><span class="line">                dpi=<span class="number">78</span>,</span><br><span class="line">                casesensitive=<span class="literal">true</span>,</span><br><span class="line">                foreground=<span class="string">"48AF6D"</span>,</span><br><span class="line">                background=<span class="string">"3FAF6F"</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>using curl to testing</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 'http://127.0.0.1:<span class="number">8008</span>/qrcode?text=http://orangleliu.info'</span><br></pre></td></tr></table></figure><p>then you see a qrcode picture, test is ok. </p><p><img src="http://img.blog.csdn.net/20170322131251751?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvb3JhbmdsZWxpdQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="openresty äºŒç»´ç "></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;I would like to use openresty(ngx_lua) to do QRcode generation API, then I found two libraries &lt;a href=&quot;https://github.com/d
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://orangleliu.info/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="openresty" scheme="http://orangleliu.info/tags/openresty/"/>
    
  </entry>
  
  <entry>
    <title>Python logging æ¨¡å—å’Œä½¿ç”¨ç»éªŒ</title>
    <link href="http://orangleliu.info/2016/12/27/python-logging-module-using-thinking/"/>
    <id>http://orangleliu.info/2016/12/27/python-logging-module-using-thinking/</id>
    <published>2016-12-27T07:49:09.000Z</published>
    <updated>2016-12-27T07:53:15.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>è®°å½•ä¸‹å¸¸ç”¨çš„ä¸€äº›ä¸œè¥¿ï¼Œæ¯æ¬¡ç”¨æ€»æ˜¯æŸ¥æ–‡æ¡£æœ‰ç‚¹å°éº»çƒ¦ã€‚ py2.7<br>æ—¥å¿—åº”è¯¥æ˜¯ç”Ÿäº§åº”ç”¨çš„é‡è¦ç”Ÿå‘½çº¿ï¼Œè°éƒ½ä¸åº”è¯¥æ‰ä»¥è½»å¿ƒ</p></blockquote><h2 id="æœ‰ç›ŠåŸåˆ™"><a href="#æœ‰ç›ŠåŸåˆ™" class="headerlink" title="æœ‰ç›ŠåŸåˆ™"></a>æœ‰ç›ŠåŸåˆ™</h2><h3 id="çº§åˆ«åˆ†ç¦»"><a href="#çº§åˆ«åˆ†ç¦»" class="headerlink" title="çº§åˆ«åˆ†ç¦»"></a>çº§åˆ«åˆ†ç¦»</h3><p>æ—¥å¿—ç³»ç»Ÿé€šå¸¸æœ‰ä¸‹é¢å‡ ç§çº§åˆ«ï¼Œçœ‹æƒ…å†µæ˜¯ä½¿ç”¨</p><ul><li>FATAL - å¯¼è‡´ç¨‹åºé€€å‡ºçš„ä¸¥é‡ç³»ç»Ÿçº§é”™è¯¯ï¼Œä¸å¯æ¢å¤ï¼Œå½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿç®¡ç†å‘˜éœ€è¦ç«‹å³ä»‹å…¥ï¼Œè°¨æ…ä½¿ç”¨ã€‚</li><li>ERROR - è¿è¡Œæ—¶å¼‚å¸¸ä»¥åŠé¢„æœŸä¹‹å¤–çš„é”™è¯¯ï¼Œä¹Ÿéœ€è¦ç«‹å³å¤„ç†ï¼Œä½†ç´§æ€¥ç¨‹åº¦ä½äºFATAL,å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå½±å“äº†ç¨‹åºçš„æ­£ç¡®æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸¤ç§çº§åˆ«å±äºæœåŠ¡è‡ªå·±çš„é”™è¯¯ï¼Œéœ€è¦ç®¡ç†å‘˜ä»‹å…¥ï¼Œç”¨æˆ·è¾“å…¥å‡ºé”™ä¸å±äºæ­¤åˆ†ç±»ã€‚</li><li>WARN - é¢„æœŸä¹‹å¤–çš„è¿è¡Œæ—¶çŠ¶å†µï¼Œè¡¨ç¤ºç³»ç»Ÿå¯èƒ½å‡ºç°é—®é¢˜ã€‚å¯¹äºé‚£äº›ç›®å‰è¿˜ä¸æ˜¯é”™è¯¯ï¼Œç„¶è€Œä¸åŠæ—¶å¤„ç†ä¹Ÿä¼šå˜æˆé”™è¯¯çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥è®°ä¸ºWARNï¼Œå¦‚ç£ç›˜è¿‡ä½ã€‚</li><li>INFO - æœ‰æ„ä¹‰çš„äº‹ä»¶ä¿¡æ¯ï¼Œè®°å½•ç¨‹åºæ­£å¸¸çš„è¿è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚æ”¶åˆ°è¯·æ±‚ï¼ŒæˆåŠŸæ‰§è¡Œã€‚é€šè¿‡æŸ¥çœ‹INFO,å¯ä»¥å¿«é€Ÿå®šä½WARNï¼ŒERROR, FATALã€‚INFOä¸å®œè¿‡å¤šï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸è¶…è¿‡TRACEçš„10%ã€‚</li><li>DEBUG - ä¸ç¨‹åºè¿è¡Œæ—¶çš„æµç¨‹ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠå½“å‰å˜é‡çŠ¶æ€ã€‚</li><li>TRACE - æ›´è¯¦ç»†çš„è·Ÿè¸ªä¿¡æ¯ã€‚DEBUGå’ŒTRACEè¿™ä¸¤ç§è§„èŒƒç”±é¡¹ç›®ç»„è‡ªå·±å®šä¹‰,é€šè¿‡è¯¥ç§æ—¥å¿—ï¼Œå¯ä»¥æŸ¥çœ‹æŸä¸€ä¸ªæ“ä½œæ¯ä¸€æ­¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥å‡†ç¡®å®šä½æ˜¯ä½•ç§æ“ä½œï¼Œä½•ç§å‚æ•°ï¼Œä½•ç§é¡ºåºå¯¼è‡´äº†æŸç§é”™è¯¯çš„å‘ç”Ÿ</li></ul><h3 id="å•ç‹¬ç›®å½•"><a href="#å•ç‹¬ç›®å½•" class="headerlink" title="å•ç‹¬ç›®å½•"></a>å•ç‹¬ç›®å½•</h3><p>æ—¥å¿—æœ€å¥½æ”¾åˆ°å•ç‹¬çš„æ—¥å¿—ç›®å½•ï¼Œä¾‹å¦‚ <code>/var/logs/</code> ä¸‹ï¼ŒæŒ‰ç…§åº”ç”¨åˆ†æˆä¸åŒçš„ç›®å½•ï¼Œæˆ–è€…æ˜¯æ–‡ä»¶ã€‚æ—¥å¿—ä¸è¦æ”¾åœ¨åº”ç”¨ç›®å½•ä¸‹ï¼Œé‚£æ ·ä¸åˆ©äºè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œåº”ç”¨å‡çº§ï¼Œå¤‡ä»½ç­‰ã€‚</p><h3 id="æ—¥å¿—åˆ†ç±»"><a href="#æ—¥å¿—åˆ†ç±»" class="headerlink" title="æ—¥å¿—åˆ†ç±»"></a>æ—¥å¿—åˆ†ç±»</h3><p>è¯Šæ–­æ—¥å¿—ï¼Œç»Ÿè®¡æ—¥å¿—ï¼Œå®¡è®¡æ—¥å¿—ç­‰ç­‰ï¼Œä¸åŒç”¨é€”ç­‰æ—¥å¿—å­˜å‚¨åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œæ–¹é¢åé¢çš„æŸ¥è¯¢ï¼Œåˆ†æã€‚</p><h3 id="æ—¥å¿—æ ¼å¼"><a href="#æ—¥å¿—æ ¼å¼" class="headerlink" title="æ—¥å¿—æ ¼å¼"></a>æ—¥å¿—æ ¼å¼</h3><p>ä¸ç®¡æ˜¯webæ—¥å¿—ï¼Œè¿˜æ˜¯åº”ç”¨æ—¥å¿—ï¼Œæœ€å¥½æœ‰ä¸€ä¸ªæ¯”è¾ƒç»Ÿä¸€çš„æ ¼å¼ï¼ˆä¾‹å¦‚æ—¶é—´æ ¼å¼ï¼‰ï¼Œæ–¹é¢æ—¥å¿—çš„æŸ¥è¯¢ï¼Œå…¥åº“ï¼Œå’Œåˆ†æã€‚è¿˜æœ‰ä¸€äº›åº”ç”¨ç»Ÿä¸€ä½¿ç”¨jsonçš„æ—¥å¿—æ ¼å¼ï¼Œä¹ŸæŒºå¥½çš„ã€‚</p><h3 id="ä¸å¥½çš„åšæ³•"><a href="#ä¸å¥½çš„åšæ³•" class="headerlink" title="ä¸å¥½çš„åšæ³•"></a>ä¸å¥½çš„åšæ³•</h3><ul><li>æ—¥å¿—ä¸­å«æœ‰ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</li><li>çº¿ä¸Šç¨‹åºä¸­ä½¿ç”¨ print</li><li>ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ debug çº§åˆ«æ—¥å¿— ğŸ˜¢</li></ul><h3 id="æ—¥å¿—åˆ‡åˆ†"><a href="#æ—¥å¿—åˆ‡åˆ†" class="headerlink" title="æ—¥å¿—åˆ‡åˆ†"></a>æ—¥å¿—åˆ‡åˆ†</h3><p>æ—¥å¿—å¯ä»¥æŒ‰ç…§æ¯å¤©ï¼Œæ¯å‘¨æˆ–è€…æ˜¯æ–‡ä»¶çš„å¤§å°ï¼Œåˆ‡åˆ†ä¹‹åå‹ç¼©ã€‚ä¸€æ–¹é¢å®¹æ˜“æŒ‰æ—¶é—´å›æº¯ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥å‡å°‘ç£ç›˜ç©ºé—´ï¼Œå¯¹äºå¾ˆä¹…ä¹‹å‰çš„æ—¥å¿—ï¼Œå¯ä»¥ä¼ è¾“åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œæˆ–è€…æ˜¯åˆ é™¤ã€‚</p><h2 id="Python-æ—¥å¿—"><a href="#Python-æ—¥å¿—" class="headerlink" title="Python æ—¥å¿—"></a>Python æ—¥å¿—</h2><h3 id="å¥½ä¹ æƒ¯"><a href="#å¥½ä¹ æƒ¯" class="headerlink" title="å¥½ä¹ æƒ¯"></a>å¥½ä¹ æƒ¯</h3><ul><li>rootçº§åˆ«çš„è®¾ç½®: æ—¥å¿—æ ¼å¼, æœ‰åˆ©äºæ ‡å‡†åŒ–</li><li>class ä¸­è®¾ç½®logger <code>self.logger = logging.getLogger(type(self).__name__)</code></li><li>æ¨¡å—ï¼Œæ–‡ä»¶ä¸­è®¾ç½® logger <code>logger = logging.getLogger(__name__)</code></li><li>ä½¿ç”¨JSON YAMLç­‰æ ¼å¼æ¥é…ç½®loggingï¼Œæ„Ÿè§‰æ¯”ä½¿ç”¨ä»£ç æˆ–è€… iniæ ¼å¼çœ‹èµ·æ¥æ›´æ–¹é¢</li><li>é”™è¯¯æ—¥å¿—æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„æ—¥å¿—ï¼Œå› ä¸ºå®ƒéœ€è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œä¾‹å¦‚é”™è¯¯äº§ç”Ÿçš„ä¸Šä¸‹æ–‡ï¼Œè¿˜æœ‰é”™è¯¯å †æ ˆç­‰ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ <code>python logging context pypi</code> å…³é”®è¯googleä¸€äº›ä¿¡æ¯ï¼Œæˆ–è€…è‡ªå·±è®¾è®¡ä¸€ä¸ª logging handler æ¥å®ç°ã€‚</li></ul><h3 id="å®é™…é—®é¢˜"><a href="#å®é™…é—®é¢˜" class="headerlink" title="å®é™…é—®é¢˜"></a>å®é™…é—®é¢˜</h3><ul><li>ç®€å•çš„å°åº”ç”¨ä¸­ï¼Œå•ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜è¦æ‰“å°æ§åˆ¶å°</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(name)-12s %(levelname)-8s %(message)s'</span>,</span><br><span class="line">                    datefmt=<span class="string">'%m-%d %H:%M'</span>,</span><br><span class="line">                    filename=<span class="string">'/temp/myapp.log'</span>,</span><br><span class="line">                    filemode=<span class="string">'w'</span>)</span><br><span class="line"><span class="built_in">console</span> = logging.StreamHandler()</span><br><span class="line"><span class="built_in">console</span>.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(name)-12s: %(levelname)-8s %(message)s'</span>)</span><br><span class="line"><span class="built_in">console</span>.setFormatter(formatter)</span><br><span class="line"><span class="comment"># add the handler to the root logger</span></span><br><span class="line">logging.getLogger(<span class="string">''</span>).addHandler(<span class="built_in">console</span>)</span><br></pre></td></tr></table></figure><ul><li>è®°å½• Exception çš„trace ä¿¡æ¯ï¼ˆå¾ˆæœ‰ç”¨å“¦)</li></ul><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    <span class="keyword">open</span>('/path/<span class="keyword">to</span>/does/<span class="keyword">not</span>/exist', <span class="symbol">'rb</span>')</span><br><span class="line">except (SystemExit, KeyboardInterrupt):</span><br><span class="line">    raise</span><br><span class="line">except Exception, e:</span><br><span class="line">    logger.<span class="literal">error</span>(<span class="symbol">'Failed</span> <span class="keyword">to</span> <span class="keyword">open</span> <span class="keyword">file</span>', exc_info=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><ul><li>ini æ ¼å¼ä¾‹å­</li></ul><p>è¿™é‡Œç”¨äº†ç¬¬ä¸‰æ–¹çš„ä¸€ä¸ªhandlerï¼ŒConcurrentRotatingFileHandlerï¼Œ å®ç°å¤šè¿›ç¨‹å®‰å…¨</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[loggers]</span></span><br><span class="line"><span class="attr">keys</span>=root</span><br><span class="line"></span><br><span class="line"><span class="section">[handlers]</span></span><br><span class="line"><span class="attr">keys</span>=stream, rotatingFile, errorFile</span><br><span class="line"></span><br><span class="line"><span class="section">[formatters]</span></span><br><span class="line"><span class="attr">keys</span>=form01</span><br><span class="line"></span><br><span class="line"><span class="section">[logger_root]</span></span><br><span class="line"><span class="attr">level</span>=DEBUG</span><br><span class="line"><span class="attr">handlers</span>=stream, rotatingFile, errorFile</span><br><span class="line"></span><br><span class="line"><span class="section">[handler_stream]</span></span><br><span class="line"><span class="attr">class</span>=StreamHandler</span><br><span class="line"><span class="attr">level</span>=NOTSET</span><br><span class="line"><span class="attr">formatter</span>=form01</span><br><span class="line"><span class="attr">args</span>=(sys.stdout,)</span><br><span class="line"></span><br><span class="line"><span class="section">[handler_errorFile]</span></span><br><span class="line"><span class="attr">class</span>=FileHandler</span><br><span class="line"><span class="attr">level</span>=ERROR</span><br><span class="line"><span class="attr">formatter</span>=form01</span><br><span class="line"><span class="attr">args</span>=(<span class="string">'./logs/portal.log'</span>, <span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">[handler_rotatingFile]</span></span><br><span class="line"><span class="attr">level</span>=INFO</span><br><span class="line"><span class="attr">formatter</span>=form01</span><br><span class="line"><span class="attr">class</span>=handlers.ConcurrentRotatingFileHandler</span><br><span class="line"><span class="attr">args</span>=(<span class="string">'./logs/portal.log'</span>,<span class="string">'a'</span>,<span class="number">50240000</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">[formatter_form01]</span></span><br><span class="line"><span class="attr">format</span>=%(asctime)s %(name)s %(levelname)s %(message)s</span><br><span class="line"><span class="attr">datefmt</span>=</span><br><span class="line"><span class="attr">class</span>=logging.Formatter</span><br></pre></td></tr></table></figure><p>å¼•ç”¨<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import logging.config</span><br><span class="line">import cloghandler</span><br><span class="line">logging.config.fileConfig(join(BASE_DIR, <span class="string">"conf/log.conf"</span>))</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br></pre></td></tr></table></figure></p><p>é»˜è®¤ä¼šä½¿ç”¨ root è¿™ä¸ªloggerï¼Œå¦‚æœåç§°åŒ¹é…å°±ä½¿ç”¨å¯¹åº”çš„loggerã€‚ ä¸€ä¸ªloggerä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ª handdler, ç”¨æ¥å¤„ç†ä¸åŒçš„æ—¥å¿—çº§åˆ«ç­‰ã€‚</p><ul><li>JSONæ ¼å¼ ä¾‹å­</li></ul><p>é…ç½®<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"disable_existing_loggers"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"formatters"</span>: &#123;</span><br><span class="line">        <span class="attr">"simple"</span>: &#123;</span><br><span class="line">            <span class="attr">"format"</span>: <span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"handlers"</span>: &#123;</span><br><span class="line">        <span class="attr">"console"</span>: &#123;</span><br><span class="line">            <span class="attr">"class"</span>: <span class="string">"logging.StreamHandler"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"DEBUG"</span>,</span><br><span class="line">            <span class="attr">"formatter"</span>: <span class="string">"simple"</span>,</span><br><span class="line">            <span class="attr">"stream"</span>: <span class="string">"ext://sys.stdout"</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">"info_file_handler"</span>: &#123;</span><br><span class="line">            <span class="attr">"class"</span>: <span class="string">"logging.handlers.RotatingFileHandler"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"INFO"</span>,</span><br><span class="line">            <span class="attr">"formatter"</span>: <span class="string">"simple"</span>,</span><br><span class="line">            <span class="attr">"filename"</span>: <span class="string">"info.log"</span>,</span><br><span class="line">            <span class="attr">"maxBytes"</span>: <span class="number">10485760</span>,</span><br><span class="line">            <span class="attr">"backupCount"</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">"encoding"</span>: <span class="string">"utf8"</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">"error_file_handler"</span>: &#123;</span><br><span class="line">            <span class="attr">"class"</span>: <span class="string">"logging.handlers.RotatingFileHandler"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"ERROR"</span>,</span><br><span class="line">            <span class="attr">"formatter"</span>: <span class="string">"simple"</span>,</span><br><span class="line">            <span class="attr">"filename"</span>: <span class="string">"errors.log"</span>,</span><br><span class="line">            <span class="attr">"maxBytes"</span>: <span class="number">10485760</span>,</span><br><span class="line">            <span class="attr">"backupCount"</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">"encoding"</span>: <span class="string">"utf8"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"loggers"</span>: &#123;</span><br><span class="line">        <span class="attr">"my_module"</span>: &#123;</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"ERROR"</span>,</span><br><span class="line">            <span class="attr">"handlers"</span>: [<span class="string">"console"</span>],</span><br><span class="line">            <span class="attr">"propagate"</span>: <span class="string">"no"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"root"</span>: &#123;</span><br><span class="line">        <span class="attr">"level"</span>: <span class="string">"INFO"</span>,</span><br><span class="line">        <span class="attr">"handlers"</span>: [<span class="string">"console"</span>, <span class="string">"info_file_handler"</span>, <span class="string">"error_file_handler"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è·å–é…ç½®<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line">def setup<span class="number">_</span>logging(</span><br><span class="line">    <span class="keyword">default</span><span class="number">_p</span>ath=<span class="string">'logging.json'</span>,</span><br><span class="line">    <span class="keyword">default</span><span class="number">_</span>level=logging.INFO,</span><br><span class="line">    env<span class="number">_k</span>ey=<span class="string">'LOG_CFG'</span></span><br><span class="line">):</span><br><span class="line">    <span class="string">"""Setup logging configuration</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    path = <span class="keyword">default</span><span class="number">_p</span>ath</span><br><span class="line">    <span class="keyword">value</span> = os.getenv(env<span class="number">_k</span>ey, None)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">value</span>:</span><br><span class="line">        path = <span class="keyword">value</span></span><br><span class="line">    <span class="keyword">if</span> os.path.<span class="keyword">exists</span>(path):</span><br><span class="line">        with open(path, <span class="string">'rt'</span>) as f:</span><br><span class="line">            config = json.load(f)</span><br><span class="line">        logging.config.dictConfig(config)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(level=<span class="keyword">default</span><span class="number">_</span>level)</span><br></pre></td></tr></table></figure></p><ul><li>æŠŠæ—¥å¿—æ ¼å¼åŒ–æˆjsonçš„å·¥å…·</li></ul><p><a href="https://github.com/madzak/python-json-logger" target="_blank" rel="noopener">python-json-logger</a>ï¼Œ<a href="https://github.com/logmatic/logmatic-python/blob/master/logmatic/__init__.py" target="_blank" rel="noopener">logmatic</a> json-loggerå¢åŠ çš„ä¸€äº›å°è£…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"><span class="keyword">from</span> pythonjsonlogger <span class="keyword">import</span> jsonlogger</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonFormatter</span><span class="params">(jsonlogger.JsonFormatter, object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                 fmt=<span class="string">"%(asctime) %(name) %(processName) %(filename)  %(funcName) %(levelname) %(lineno) %(module) %(threadName) %(message)"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 datefmt=<span class="string">"%Y-%m-%dT%H:%M:%SZ%z"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 style=<span class="string">'%'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 extra=&#123;&#125;, *args, **kwargs)</span>:</span></span><br><span class="line">        self._extra = extra</span><br><span class="line">        jsonlogger.JsonFormatter.__init__(self, fmt=fmt, datefmt=datefmt, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_log_record</span><span class="params">(self, log_record)</span>:</span></span><br><span class="line">        <span class="comment"># Enforce the presence of a timestamp</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"asctime"</span> <span class="keyword">in</span> log_record:</span><br><span class="line">            log_record[<span class="string">"timestamp"</span>] = log_record[<span class="string">"asctime"</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            log_record[<span class="string">"timestamp"</span>] = datetime.datetime.utcnow().strftime(<span class="string">"%Y-%m-%dT%H:%M:%S.%fZ%z"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self._extra <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> self._extra.items():</span><br><span class="line">                log_record[key] = value</span><br><span class="line">        <span class="keyword">return</span> super(JsonFormatter, self).process_log_record(log_record)</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://docs.python.org/2/howto/logging-cookbook.html#logging-cookbook" target="_blank" rel="noopener">Logging Cookbook</a> æ–‡æ¡£ä¸€å®šæ˜¯è¦çœ‹çš„</li><li><a href="http://themoon.me/2016/01/05/æ—¥å¿—æœ€ä½³å®è·µ/" target="_blank" rel="noopener">æ—¥å¿—æœ€ä½³å®è·µ</a></li><li><a href="https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/" target="_blank" rel="noopener">good-logging-practice-in-python</a></li><li><a href="https://sentry.io/" target="_blank" rel="noopener">Sentry</a> æ—¥å¿—æ”¶é›†ï¼Œåˆ†æç³»ç»Ÿï¼ŒåŸºäºPython</li><li><a href="#">ConcurrentLogHandler</a> è§£å†³å¤šè¿›ç¨‹æ—¥å¿—åŒæ­¥é—®é¢˜</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;è®°å½•ä¸‹å¸¸ç”¨çš„ä¸€äº›ä¸œè¥¿ï¼Œæ¯æ¬¡ç”¨æ€»æ˜¯æŸ¥æ–‡æ¡£æœ‰ç‚¹å°éº»çƒ¦ã€‚ py2.7&lt;br&gt;æ—¥å¿—åº”è¯¥æ˜¯ç”Ÿäº§åº”ç”¨çš„é‡è¦ç”Ÿå‘½çº¿ï¼Œè°éƒ½ä¸åº”è¯¥æ‰ä»¥è½»å¿ƒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æœ‰ç›ŠåŸåˆ™&quot;&gt;&lt;a href=&quot;#æœ‰ç›ŠåŸ
      
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="http://orangleliu.info/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="logging" scheme="http://orangleliu.info/tags/logging/"/>
    
  </entry>
  
  <entry>
    <title>uWSGI and Nginx deploy Django project</title>
    <link href="http://orangleliu.info/2016/10/29/uwsgi-nginx-deploy-django-project/"/>
    <id>http://orangleliu.info/2016/10/29/uwsgi-nginx-deploy-django-project/</id>
    <published>2016-10-29T08:22:14.000Z</published>
    <updated>2016-10-29T08:27:31.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><ul><li>django version:1.6</li><li>os version: Centos 6.2</li><li>nginx version: 1.4.2</li><li>uwsgi version: 2.0.8</li><li>python version: 2.7.5</li></ul><h2 id="directory"><a href="#directory" class="headerlink" title="directory"></a>directory</h2><ol><li>django project is in <strong>/home/erya/hawk</strong> and settings.py is at <strong>/home/erya/hawk/settings.py</strong></li><li><strong>nginx conf</strong> is at  <strong>/usr/local/nginx/conf</strong></li></ol><h2 id="deployment"><a href="#deployment" class="headerlink" title="deployment"></a>deployment</h2><ul><li>This is not a exhaustive reference, I assume all the softwares were installed correct.</li><li>I record some key point when deploy the project.</li><li>the web client <-> the web server <-> the socket <-> uwsgi <-> Django</-></-></-></-></li></ul><h3 id="small-test"><a href="#small-test" class="headerlink" title="small test"></a>small test</h3><p>use django dev server:   python manage.py runserver 8000   OK!<br>use uwsgi setup django:  uwsgi â€“http :8000 â€“module wsgi    OK!</p><p>it seems ok, the important parts coming!</p><h3 id="uwsgi-configure"><a href="#uwsgi-configure" class="headerlink" title="uwsgi configure"></a>uwsgi configure</h3><p>create uwsgi.ini file in django project directorythe fileâ€™s content is :</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">chdir</span>=/home/erya/hawk</span><br><span class="line"><span class="attr">module</span>=wsgi</span><br><span class="line"></span><br><span class="line"><span class="attr">master</span>=<span class="literal">True</span></span><br><span class="line"><span class="attr">processes</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">pidfile</span>=/home/erya/hawk.pid</span><br><span class="line"><span class="attr">vacuum</span>=<span class="literal">True</span></span><br><span class="line"><span class="attr">max-requests</span>=<span class="number">5000</span></span><br><span class="line"><span class="attr">enable-threads</span>=<span class="literal">True</span></span><br><span class="line"><span class="attr">socket</span>=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9001</span></span><br></pre></td></tr></table></figure><h3 id="nginx-configure"><a href="#nginx-configure" class="headerlink" title="nginx configure"></a>nginx configure</h3><p>check  <strong>uwsgi_params </strong> file in nginx conf or you can donwload it from github <a href="https://github.com/nginx/nginx/blob/master/conf/uwsgi_params" target="_blank" rel="noopener">https://github.com/nginx/nginx/blob/master/conf/uwsgi_params</a><br>and put it in nginx conf directory.</p><p>add uwsgi.conf file,the content is :</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8000</span>;</span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="comment">#       client_max_body_size 64M;</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="comment">#           client_max_body_size 4M;</span></span><br><span class="line">            <span class="attribute">uwsgi_pass</span>   <span class="number">127.0.0.1:9001</span>;</span><br><span class="line">            <span class="attribute">include</span>     uwsgi_params;</span><br><span class="line">            <span class="attribute">access_log</span>  <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>add one line to nginx.conf ,like</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    include uwsgi.conf;    ####here</span><br><span class="line">    <span class="built_in">..</span>.</span><br><span class="line">   <span class="built_in"> server </span>&#123;</span><br><span class="line">        <span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure><h2 id="start-up-the-use-have-the-permission"><a href="#start-up-the-use-have-the-permission" class="headerlink" title="start up(the use have the permission)"></a>start up(the use have the permission)</h2><p>uwsgi: in project directory</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi <span class="comment">--ini uwsgi.ini</span></span><br></pre></td></tr></table></figure><p>nginx:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>sbin<span class="regexp">/nginx</span></span><br></pre></td></tr></table></figure><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p>The you can open your favorite browser, type <code>http://127.0.0.1:8000</code> , you will see your projectâ€™s index page.<br>Of course, what i do is very simple, you can config custom configure of your project.</p><h2 id="REF"><a href="#REF" class="headerlink" title="REF"></a>REF</h2><p><a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html" target="_blank" rel="noopener">django_and_nginx</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;version&quot;&gt;&lt;a href=&quot;#version&quot; class=&quot;headerlink&quot; title=&quot;version&quot;&gt;&lt;/a&gt;version&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;django version:1.6&lt;/li&gt;
&lt;l
      
    
    </summary>
    
    
      <category term="django" scheme="http://orangleliu.info/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>django å•å…ƒæµ‹è¯•å°ç»“</title>
    <link href="http://orangleliu.info/2016/10/09/django-unittest-summary/"/>
    <id>http://orangleliu.info/2016/10/09/django-unittest-summary/</id>
    <published>2016-10-09T11:23:27.000Z</published>
    <updated>2016-10-09T11:24:38.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>ä»å‰å¾ˆå°‘å†™å•å…ƒæµ‹è¯•äº†ï¼Œç‰¹åˆ«æ˜¯webåº”ç”¨ã€‚æœ€è¿‘ä¸çŸ¥ä¸è§‰å–œæ¬¢èµ·æ¥è¿™ä¸ªäº‹æƒ…äº†ï¼Œå‘ç°å•å…ƒæµ‹è¯•å¯¹äºè½¯ä»¶çš„æ¨¡å—ï¼Œæ­£äº¤æ€§æœ‰å¾ˆå¤§ä¿ƒè¿›ä½œç”¨ï¼Œå› ä¸ºå‡½æ•°ï¼Œæ¨¡å—å†™çš„ä¸åˆç†ï¼Œå•å…ƒæµ‹è¯•å†™èµ·æ¥å°±éº»çƒ¦çš„å¤šå‘€ã€‚å…¬å¸çš„é¡¹ç›®ä¸€ç›´éƒ½æ˜¯ç”¨Djangoï¼Œæ‰€ä»¥å†™ç‚¹djangoå•å…ƒæµ‹è¯•çš„å°æ€»ç»“ï¼Œè®°å½•ä¸ºä¸»ï¼Œå¤‡æŸ¥ã€‚</p></blockquote><h2 id="æµ‹è¯•çš„åœºæ™¯"><a href="#æµ‹è¯•çš„åœºæ™¯" class="headerlink" title="æµ‹è¯•çš„åœºæ™¯"></a>æµ‹è¯•çš„åœºæ™¯</h2><p>æ¡†æ¶Django1.8 æµ‹è¯•å·¥å…· unittest, è¦è®°å¾—ç»™testè®¾ç½®ä¸€ä¸ªç‹¬ç‰¹çš„settingsã€‚</p><ol><li><p>æµ‹è¯•è¯·æ±‚ ä¹Ÿå°±æ˜¯æµ‹è¯•æ•´ä¸ªviewéƒ¨åˆ† <a href="https://docs.djangoproject.com/en/1.8/topics/testing/advanced/#example" target="_blank" rel="noopener">å®˜æ–¹æ¡ˆä¾‹</a> å…¶ä¸­å¯èƒ½ä¼šé‡åˆ°ç™»å½•ï¼Œæˆ–è€…æ—¶sessionæ€ä¹ˆæ¨¡æ‹Ÿçš„é—®é¢˜</p></li><li><p>æµ‹è¯•å¸¦æœ‰ormçš„æ¨¡å—</p></li><li>éœ€è¦mockçš„æµ‹è¯•ï¼Œæ¯”è¾ƒå¤šçš„æƒ…å†µæ˜¯æœ‰ç¬¬ä¸‰æ–¹APIè°ƒç”¨, å‘é‚®ä»¶ï¼Œå‘çŸ­ä¿¡è¿™ç§</li></ol><p>unittestæä¾›çš„æ–­è¨€ç§ç±»æŒºå¤š,ä½†æ˜¯ç»å¸¸ç”¨çš„ä¹Ÿå°±å‡ ä¸ª <code>self.assertContains</code>, <code>self.assertEqual</code>, <code>self.assertTrue</code></p><p>é¡ºä¾¿æä¸‹æœ‰ç”¨çš„é€‰é¡¹(æˆ‘è¿™é‡Œæ˜¯å•ç‹¬ç»™æµ‹è¯•å†™äº†ä¸€ä¸ªsettings), ä¸ºäº†æé«˜æµ‹è¯•é€Ÿåº¦ï¼Œå¯ä»¥æŠŠç”¨ä¸åˆ°çš„ä¸­é—´ä»¶ï¼Œinstalled_appsä¹‹ç±»çš„å¤šä½™é…ç½®ç»™å»æ‰ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">æµ‹è¯•å…¨éƒ¨ç”¨ä¾‹</span><br><span class="line">python manage<span class="selector-class">.py</span> test  --setting settings_test</span><br><span class="line"></span><br><span class="line">æµ‹è¯•æŸä¸ªAPP</span><br><span class="line">python manage<span class="selector-class">.py</span> test appname --setting settings_test</span><br><span class="line"></span><br><span class="line">æµ‹è¯•æŸä¸ªappä¸‹çš„TeseCaseç±»</span><br><span class="line">python manage<span class="selector-class">.py</span> test alarm<span class="selector-class">.tests</span><span class="selector-class">.ModelTestCase</span> --setting settings_test</span><br><span class="line"></span><br><span class="line">-v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; æ•°å­—è¶Šå¤§ï¼Œæ˜¾ç¤ºçš„è¾“å‡ºè¶Šè¯¦ç»†ï¼Œæµ‹è¯•çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">python manage<span class="selector-class">.py</span> test --setting settings_test -v3</span><br><span class="line"></span><br><span class="line">å…¶ä»–çš„é€‰é¡¹è¯·æŸ¥çœ‹ --help</span><br><span class="line">python manage<span class="selector-class">.py</span> test --help</span><br></pre></td></tr></table></figure><h3 id="ç”¨è¯·æ±‚æµ‹è¯•-viewså‡½æ•°"><a href="#ç”¨è¯·æ±‚æµ‹è¯•-viewså‡½æ•°" class="headerlink" title="ç”¨è¯·æ±‚æµ‹è¯• viewså‡½æ•°"></a>ç”¨è¯·æ±‚æµ‹è¯• viewså‡½æ•°</h3><p>DJANGOä¸­æä¾›äº†Clientç±»æ¥æ¨¡æ‹Ÿhttpè¯·æ±‚ï¼Œå¯ä»¥æ¨¡æ‹Ÿä¸åŒçš„methodï¼Œç„¶åå°±æ˜¯è¯·æ±‚å‚æ•°çš„æ¨¡æ‹Ÿï¼Œç”¨èµ·æ¥å¾ˆæ–¹é¢ã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">from django.test import TestCase, Client</span><br><span class="line"></span><br><span class="line">from sendviews import *</span><br><span class="line">from core.tests import create_user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendviewsTestCase</span>(<span class="title">TestCase</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.user = create_user()</span><br><span class="line">        <span class="keyword">self</span>.device = Device(hostname=<span class="string">"CN-BJ-0000-00"</span>,</span><br><span class="line">                             mac=<span class="string">"ff:ff:ff:ff:ff:ff"</span>, user=<span class="keyword">self</span>.user).save()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_creat_sms</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        c = Client()</span><br><span class="line">        rep = c.post(<span class="string">"/acquireportal/createsms"</span>,&#123;<span class="string">"phone"</span>: <span class="string">"13988902345"</span>,</span><br><span class="line">                                                 <span class="string">"ssid"</span>: <span class="string">"erya"</span>,</span><br><span class="line">                                                 <span class="string">"dmac"</span>: <span class="string">"ff:ff:ff:ff:ff:ff"</span>&#125;)</span><br><span class="line">        <span class="comment"># æµ‹è¯•httpè¯·æ±‚çš„è¿”å›ç æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">self</span>.assertEqual(rep.status_code, <span class="number">200</span>)</span><br><span class="line">        <span class="comment"># æµ‹è¯•responseçš„å†…å®¹æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">self</span>.assertContains(rep, <span class="string">"OK"</span>)</span><br><span class="line">        <span class="comment"># æµ‹è¯•responseçš„å†…å®¹æ˜¯å¦åŒ…å«å­—ç¬¦ä¸² æ–¹æ³•äºŒ</span></span><br><span class="line">        <span class="keyword">self</span>.assertTrue(<span class="string">'OK'</span> <span class="keyword">in</span> rep.content)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ RequestFactory å¯¹è±¡æ¥è¿›è¡Œæµ‹è¯•ï¼Œä¸æ˜¯ä» http clientæ¥å‘èµ·ï¼ŒæŸäº›æƒ…å†µä¼šç”¨åˆ°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase, RequestFactory</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> util.sign <span class="keyword">import</span> generate_sign, validate_sign</span><br><span class="line"><span class="keyword">from</span> util.decorators <span class="keyword">import</span> apiauth_required, SIGN_KEY</span><br><span class="line"></span><br><span class="line"><span class="meta">@apiauth_required()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">simpleapi</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecoratorsTestCase</span><span class="params">(TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.factory = RequestFactory()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_apiauth</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># create request object</span></span><br><span class="line">        key = SIGN_KEY</span><br><span class="line">        query_string = &#123;<span class="string">u"name"</span>: <span class="string">u"lzz"</span>, <span class="string">u"age"</span>: <span class="string">u"20"</span>, <span class="string">u"data"</span>: <span class="string">u"[python, java, golang, lua]"</span>&#125;</span><br><span class="line">        token = generate_sign(query_string, key)</span><br><span class="line">        query_string.update(&#123;<span class="string">u"sign"</span>: token&#125;)</span><br><span class="line">        req = self.factory.post(<span class="string">"/api/test"</span>, data=query_string)</span><br><span class="line">        response = simpleapi(req)</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><ul><li>HTML æ–‡æœ¬æµ‹è¯•ï¼Œä½¿ç”¨ constants æ¥åˆ¤æ–­å¹¶ä¸æ˜¯ä¸ªå¥½çš„é€‰æ‹©ï¼Œå¯ä»¥ç”¨renderä¹‹åçš„å­—ç¬¦ä¸²å¯¹æ¯”ã€‚</li></ul><p>å¯¹äºéœ€è¦ç™»é™†çš„viewï¼Œæœ‰clientä¹Ÿæ¯”è¾ƒå®¹æ˜“æ“ä½œï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„sessionçš„æ£€æµ‹ç­‰, æˆ‘è¿™é‡Œåšäº†ä¸€ä¸ªç®€å•çš„å°è£…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_client</span><span class="params">(user)</span>:</span></span><br><span class="line">    client = Client()</span><br><span class="line">    client.login(username=user.username, password=<span class="string">"lzz"</span>)</span><br><span class="line">    s = client.session</span><br><span class="line">    s[<span class="string">'cur_user_id'</span>] = user.id</span><br><span class="line">    s.save()</span><br><span class="line">    <span class="keyword">return</span> client</span><br></pre></td></tr></table></figure><h3 id="å¸¦æœ‰mockçš„æµ‹è¯•"><a href="#å¸¦æœ‰mockçš„æµ‹è¯•" class="headerlink" title="å¸¦æœ‰mockçš„æµ‹è¯•"></a>å¸¦æœ‰mockçš„æµ‹è¯•</h3><p>å¯¹æ¨¡å—ä¸­çš„æ–¹æ³•mockæˆ–è€…æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•è¿›è¡Œmockã€‚çœŸå¯¹æµ‹è¯•å‡½æ•°ä¸­ä¸€äº›æ— æ³•ç›´æ¥æµ‹è¯•çš„å‡½æ•°è®¾ç½®é»˜è®¤çš„è¿”å›å€¼, py3æ ‡å‡†åº“ä¸­å·²ç»æœ‰äº†<a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank" rel="noopener">mockæ¨¡å—</a>ï¼Œpy2éœ€è¦è‡ªå·±å®‰è£…, æ¨èæ•™ç¨‹ <a href="http://www.oschina.net/translate/unit-testing-with-the-python-mock-class" target="_blank" rel="noopener">ä½¿ç”¨Pyhton Mockè¿›è¡Œå•å…ƒæµ‹è¯•1</a>ã€‚ ä¸‹é¢æ˜¯ä¸ªå®é™…çš„ä»£ç ç‰‡æ®µã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> core.models <span class="keyword">import</span> Tenant</span><br><span class="line"><span class="keyword">from</span> alarm.models <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> .controler <span class="keyword">import</span> TenantAlarm</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelTestCase</span><span class="params">(TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.tenant = Tenant.objects.create(domainname=<span class="string">"erya"</span>, comname=<span class="string">u"å°”é›…"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @mock.patch.object(TenantAlarm, "sendAlarm")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_record_alarm</span><span class="params">(self, mock_method)</span>:</span></span><br><span class="line">        <span class="comment"># record_alarm è¿™ä¸ªä¸­ä¼šè°ƒç”¨sendAlarmæ–¹æ³•</span></span><br><span class="line">        mock_method.return_value = <span class="keyword">None</span></span><br><span class="line">        content = <span class="string">"ccccc"</span></span><br><span class="line">        atype = <span class="number">0</span></span><br><span class="line">        rec_uid = <span class="number">0</span></span><br><span class="line">        Alarm().record_alarm(content=content, atype=<span class="number">0</span>,</span><br><span class="line">                             rec_tid=self.tenant.id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TenantAlarmTestCase</span><span class="params">(TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.tenant = Tenant.objects.create(domainname=<span class="string">"erya"</span>, comname=<span class="string">u"å°”é›…"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @mock.patch.object(TenantAlarm, "sendSMS", return_value=None)</span></span><br><span class="line"><span class="meta">    @mock.patch.object(TenantAlarm, "sendEmail", return_value=None)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_send_alarm</span><span class="params">(self, method1, method2)</span>:</span></span><br><span class="line">        content = <span class="string">u"æŠ¥è­¦äº†"</span></span><br><span class="line">        ta = TenantAlarm(self.tenant.id, content, &#123;<span class="string">u'SMS'</span>: <span class="number">0</span>, <span class="string">u'EMAIL'</span>: <span class="number">0</span>&#125;)</span><br><span class="line">        ta.sendAlarm()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @mock.patch('util.sendsms_com.send', return_value=1)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sendsms</span><span class="params">(self, send)</span>:</span></span><br><span class="line">        ta = TenantAlarm(self.tenant.id, self.content, &#123;<span class="string">u'SMS'</span>: <span class="number">0</span>, <span class="string">u'EMAIL'</span>: <span class="number">0</span>&#125;)</span><br><span class="line">        ta.sendSMS()</span><br><span class="line">        self.assertEqual(<span class="number">0</span>, Account.objects.get(tenant=self.tenant).sms_num)</span><br><span class="line">        self.account.sms_num = <span class="number">100</span></span><br><span class="line">        self.account.save()</span><br><span class="line">        ta.sendSMS()</span><br><span class="line">        self.assertEqual(<span class="number">99</span>, Account.objects.get(tenant=self.tenant).sms_num)</span><br></pre></td></tr></table></figure><h2 id="coverage"><a href="#coverage" class="headerlink" title="coverage"></a>coverage</h2><p>coverageæ˜¯ä¸€ä¸ªæ£€æŸ¥å•å…ƒæµ‹è¯•è¦†ç›–ç‡çš„å·¥å…·ï¼Œdjangoçš„æ–‡æ¡£ä¸­ä¹Ÿæœ‰ç®€è¦çš„è¯´æ˜coverageçš„é›†æˆ <a href="https://docs.djangoproject.com/en/1.8/topics/testing/advanced/#integration-with-coverage-py" target="_blank" rel="noopener">æ–‡æ¡£åœ°å€</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æµ‹è¯•å¹¶æ”¶é›†æµ‹è¯•ä¿¡æ¯</span></span><br><span class="line">coverage run --<span class="built_in">source</span>=<span class="string">'.'</span> manage.py <span class="built_in">test</span> --setting mandela.settings_test</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æµ‹è¯•ç»“æœ</span></span><br><span class="line">coverage report -m</span><br><span class="line">Name                                                       Stmts   Miss  Cover   Missing</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">acquireportal/__init__.py                                      0      0   100%</span><br><span class="line">acquireportal/controler.py                                    65     47    28%   22-56, 60-71, 76-79</span><br><span class="line">acquireportal/migrations/0001_initial.py                       6      0   100%</span><br><span class="line">acquireportal/migrations/0002_auto_20160622_1059.py            6      0   100%</span><br><span class="line">acquireportal/migrations/0003_auto_20160622_1100.py            5      0   100%</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">TOTAL                                                       8013   5858    27%</span><br></pre></td></tr></table></figure><p>è¦†ç›–ç‡æŒºä½çš„ğŸ˜‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»å‰å¾ˆå°‘å†™å•å…ƒæµ‹è¯•äº†ï¼Œç‰¹åˆ«æ˜¯webåº”ç”¨ã€‚æœ€è¿‘ä¸çŸ¥ä¸è§‰å–œæ¬¢èµ·æ¥è¿™ä¸ªäº‹æƒ…äº†ï¼Œå‘ç°å•å…ƒæµ‹è¯•å¯¹äºè½¯ä»¶çš„æ¨¡å—ï¼Œæ­£äº¤æ€§æœ‰å¾ˆå¤§ä¿ƒè¿›ä½œç”¨ï¼Œå› ä¸ºå‡½æ•°ï¼Œæ¨¡å—å†™çš„ä¸åˆç†ï¼Œå•å…ƒæµ‹è¯•å†™èµ·æ¥å°±éº»çƒ¦çš„å¤šå‘€ã€‚å…¬å¸çš„é¡¹ç›®ä¸€ç›´éƒ½æ˜¯ç”¨Djangoï¼Œæ‰€
      
    
    </summary>
    
      <category term="æŠ€æœ¯åˆ†äº«" scheme="http://orangleliu.info/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
      <category term="django" scheme="http://orangleliu.info/tags/django/"/>
    
      <category term="test" scheme="http://orangleliu.info/tags/test/"/>
    
  </entry>
  
  <entry>
    <title>OpenRestyä¸­å®‰è£…å’Œä½¿ç”¨LJSQlite3</title>
    <link href="http://orangleliu.info/2016/09/27/openresty-sqlite-install-and-use/"/>
    <id>http://orangleliu.info/2016/09/27/openresty-sqlite-install-and-use/</id>
    <published>2016-09-27T10:34:15.000Z</published>
    <updated>2016-09-27T15:26:29.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>å°½ç®¡Openrestyå’Œsqliteç»“åˆå¹¶ä¸æ˜¯å¥½çš„é€‰æ‹©ï¼Œsqliteçš„é˜»å¡ä¼šå¯¼è‡´nginxæ•´ä½“æ€§èƒ½çš„æé€Ÿä¸‹é™ï¼Œä½†æ˜¯æ€»æœ‰äº›å°åº”ç”¨ï¼Œä¹Ÿä¸éœ€è¦é«˜æ€§èƒ½ï¼Œå°±æ˜¯ä¸ºäº†å±•ç¤ºç‚¹ä¸œè¥¿ï¼Œnginx+lua ä¸€å¹¶åšäº†ã€‚ æ€§èƒ½æœ‰è¦æ±‚åœºæ™¯ä¸‹è¯·ä¸è¦é‚£ä¹ˆç©ï¼Œç„¶ååœ¨ç½‘ä¸Šæ‰¾åˆ°äº†<a href="http://scilua.org/ljsqlite3.html" target="_blank" rel="noopener">LJSQlite3</a>è¿™ä¹ˆä¸€ä¸ªåº“ï¼Œæ­£å¥½æ˜¯åŸºäºcffiçš„ï¼Œä¸é”™ã€‚</p></blockquote><ul><li><a href="https://github.com/stepelu/lua-ljsqlite3" target="_blank" rel="noopener">ljsqlite3 on github</a></li><li><a href="http://scilua.org/ljsqlite3.html" target="_blank" rel="noopener">ljsqlite3 doc</a></li></ul><p>å…·ä½“çš„æ“ä½œå’Œæµ‹è¯•ä»£ç éƒ½æ”¾åœ¨ä¸‹é¢äº†</p><p>nginx conf</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/sqlite</span> &#123;</span><br><span class="line">    content_by_lua_file conf/lua/sqlitetest.lua;</span><br><span class="line">    <span class="comment"># curl 'http://127.0.0.1:8008/sqlite'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sqlitetest.lua<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ljsqlite3 æµ‹è¯•ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å®‰è£…çš„æ­¥éª¤</span></span><br><span class="line"><span class="comment">-- ljsqlite3 åŸºäºluajit cffiå†™çš„ï¼Œæ‰€ä»¥é¦–å…ˆè¦å®‰è£…sqliteåœ¨æœºå™¨ä¸Š, lua-xsysæ˜¯å®ƒçš„ä¾èµ–åº“</span></span><br><span class="line"><span class="comment">-- cd usr/local/openresty/lualib</span></span><br><span class="line"><span class="comment">-- git clone https://github.com/stepelu/lua-xsys.git &amp;&amp; mv lua-xsys xsys</span></span><br><span class="line"><span class="comment">-- git clone https://github.com/stepelu/lua-ljsqlite3.git &amp;&amp; mv lua-ljsqlite3 ljsqlite3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> sql = <span class="built_in">require</span> <span class="string">'ljsqlite3'</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">string</span> = <span class="built_in">string</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">unpack</span> = <span class="built_in">unpack</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Open a temporary in-memory database, when conn is closed, database is not exist</span></span><br><span class="line"><span class="comment">-- when the request end, then database is also not exit, so think twice</span></span><br><span class="line"><span class="comment">-- local conn = sql.open("")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- use a db file, rwc mean if the file not exits, create it</span></span><br><span class="line"><span class="comment">-- please notice permission of dir and file</span></span><br><span class="line"><span class="keyword">local</span> conn = sql.<span class="built_in">open</span>(<span class="string">"/tmp/test.db"</span>, <span class="string">'rwc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">create_table</span><span class="params">(conn)</span></span></span><br><span class="line">    <span class="comment">-- create a table, insert into a record</span></span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    conn:exec(<span class="string">[[</span></span><br><span class="line"><span class="string">    DROP TABLE IF EXISTS t;</span></span><br><span class="line"><span class="string">    CREATE TABLE t(id TEXT, num REAL);</span></span><br><span class="line"><span class="string">    ]]</span>)</span><br><span class="line">    ngx.say(<span class="string">"create table t ok"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">insert_record</span><span class="params">(conn, id, num)</span></span></span><br><span class="line">    <span class="keyword">local</span> sqlstr = <span class="string">"INSERT INTO t VALUES('"</span>..id..<span class="string">"', "</span>..num..<span class="string">");"</span></span><br><span class="line">    <span class="keyword">local</span> res, nrow = conn:exec(sqlstr)</span><br><span class="line">    <span class="comment">-- if success res is nil and nrow is 0</span></span><br><span class="line">    <span class="keyword">if</span> nrow == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        ngx.say(<span class="string">"insert ok"</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ngx.say(<span class="string">"insert failure"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">show_record</span><span class="params">(conn, id)</span></span></span><br><span class="line">    <span class="keyword">local</span> sqlstr = <span class="string">"SELECT * FROM t WHERE id=='"</span>..id..<span class="string">"'"</span></span><br><span class="line">    <span class="keyword">local</span> id, num = conn:rowexec(sqlstr)</span><br><span class="line">    <span class="comment">-- if multiple records returned, error</span></span><br><span class="line">    ngx.say(<span class="string">"id:"</span>..<span class="built_in">tostring</span>(id))</span><br><span class="line">    ngx.say(<span class="string">"num:"</span>..<span class="built_in">tostring</span>(num))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">all_record</span><span class="params">(conn)</span></span></span><br><span class="line">    <span class="keyword">local</span> stmt = conn:prepare(<span class="string">"SELECT * FROM t"</span>)</span><br><span class="line">    <span class="keyword">local</span> row, names = stmt:step(&#123;&#125;, &#123;&#125;)</span><br><span class="line">    <span class="keyword">while</span> stmt:step(row) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> id, num = <span class="built_in">unpack</span>(row)</span><br><span class="line">        ngx.say(<span class="string">"id:"</span>..id..<span class="string">" num:"</span>..num)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">update_record</span><span class="params">(conn, id, num)</span></span></span><br><span class="line">    <span class="keyword">local</span> sqlstr = <span class="string">"UPDATE t set num="</span>..num..<span class="string">" where id='"</span>..id..<span class="string">"';"</span></span><br><span class="line">    <span class="keyword">local</span> res, nrow = conn:exec(sqlstr)</span><br><span class="line">    ngx.say(res)</span><br><span class="line">    ngx.say(nrow)</span><br><span class="line">    ngx.say(<span class="string">"update ok"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">remove_record</span><span class="params">(conn, id)</span></span></span><br><span class="line">    <span class="comment">-- è¿™ç§å†™æ³•æ¯”è¾ƒé€‚åˆå¤šæ¡è¯­å¥</span></span><br><span class="line">    <span class="keyword">local</span> stmt = conn:prepare(<span class="string">"delete from t where id=?"</span>)</span><br><span class="line">    stmt:reset():bind(id):step()</span><br><span class="line">    ngx.say(<span class="string">"remove ok"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è§£æ op å’Œ å‚æ•°ï¼Œç„¶åæ“ä½œï¼Œä¸»è¦ç†Ÿæ‚‰apiï¼Œå¹¶æ²¡æœ‰restçš„é£æ ¼ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment">-- sql ä¹Ÿå°±ç›´æ¥æ‹¼æ¥äº†</span></span><br><span class="line"><span class="comment">-- curl 'http://127.0.0.1:8008/sqlite?op=xxx&amp;id=xx&amp;num=xx'</span></span><br><span class="line"><span class="keyword">local</span> op = ngx.var.arg_op</span><br><span class="line"><span class="keyword">local</span> id = ngx.var.arg_id</span><br><span class="line"><span class="keyword">local</span> num = ngx.var.arg_num</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> op == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    ngx.<span class="built_in">exit</span>(<span class="number">404</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> op == <span class="string">'create'</span> <span class="keyword">then</span></span><br><span class="line">    create_table(conn)</span><br><span class="line"><span class="keyword">elseif</span> op == <span class="string">"insert"</span> <span class="keyword">then</span></span><br><span class="line">    insert_record(conn, id, num)</span><br><span class="line"><span class="keyword">elseif</span> op == <span class="string">"showone"</span> <span class="keyword">then</span></span><br><span class="line">    show_record(conn, id)</span><br><span class="line"><span class="keyword">elseif</span> op == <span class="string">"showall"</span> <span class="keyword">then</span></span><br><span class="line">    all_record(conn)</span><br><span class="line"><span class="keyword">elseif</span> op == <span class="string">"update"</span> <span class="keyword">then</span></span><br><span class="line">    update_record(conn, id, num)</span><br><span class="line"><span class="keyword">elseif</span> op == <span class="string">"remove"</span> <span class="keyword">then</span></span><br><span class="line">    remove_record(conn, id)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">conn:<span class="built_in">close</span>()</span><br><span class="line">ngx.<span class="built_in">exit</span>(<span class="number">200</span>)</span><br></pre></td></tr></table></figure></p><p>sqlitetest.luaçš„apiä¸æ˜¯é’ˆå¯¹openrestyï¼Œå¦‚æœæƒ³è¦åœ¨openrestyä¸­çœŸæ­£çš„ä½¿ç”¨ï¼Œè¿˜è¦åšä¸€äº›å°è£…ç­‰å·¥ä½œã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;å°½ç®¡Openrestyå’Œsqliteç»“åˆå¹¶ä¸æ˜¯å¥½çš„é€‰æ‹©ï¼Œsqliteçš„é˜»å¡ä¼šå¯¼è‡´nginxæ•´ä½“æ€§èƒ½çš„æé€Ÿä¸‹é™ï¼Œä½†æ˜¯æ€»æœ‰äº›å°åº”ç”¨ï¼Œä¹Ÿä¸éœ€è¦é«˜æ€§èƒ½ï¼Œå°±æ˜¯ä¸ºäº†å±•ç¤ºç‚¹ä¸œè¥¿ï¼Œnginx+lua ä¸€å¹¶åšäº†ã€‚ æ€§èƒ½æœ‰è¦æ±‚åœºæ™¯ä¸‹
      
    
    </summary>
    
      <category term="openresty" scheme="http://orangleliu.info/categories/openresty/"/>
    
    
      <category term="openresty" scheme="http://orangleliu.info/tags/openresty/"/>
    
      <category term="sqlite3" scheme="http://orangleliu.info/tags/sqlite3/"/>
    
  </entry>
  
  <entry>
    <title>Sweet Nginx-æ ¹æ®User Agentæˆ–è€…urlç‰¹å¾é˜»æ­¢è¯·æ±‚</title>
    <link href="http://orangleliu.info/2016/09/25/sweet-nginx-forbidden-request-by-ua/"/>
    <id>http://orangleliu.info/2016/09/25/sweet-nginx-forbidden-request-by-ua/</id>
    <published>2016-09-25T10:53:17.000Z</published>
    <updated>2016-09-25T10:56:25.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>æœ‰æ—¶å€™ä¸ºäº†è§£å†³ä¸€äº›å®‰å…¨é—®é¢˜éœ€è¦ç¦æ­¢æŸäº›ç‰¹å®šçš„è¯·æ±‚ï¼Œä¾‹å¦‚æ ¹æ®user angentæ¥é˜»æ­¢åƒåœ¾è¯·æ±‚ï¼Œç™¾åº¦çˆ¬è™«è¿™ç§ï¼Œæˆ–è€…æ˜¯å…¶ä»–çš„æ¶æ„è¯·æ±‚ï¼Œè¿˜æœ‰ä¾‹å¦‚æ ¹æ®urlçš„ç‰¹å¾é˜»æ­¢æŸäº›è¯·æ±‚ï¼Œç±»ä¼¼çš„æœ‰sqlæ³¨å…¥ç­‰ã€‚å¦‚æœéœ€æ±‚æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä½¿ç”¨nginxé…ç½®å°±èƒ½è§£å†³ï¼Œå¦‚æœéœ€è¦æ¯”è¾ƒä¸“ä¸šçš„åº”ç”¨é˜²ç«å¢™è¯·ä½¿ç”¨ä¸“ä¸šçš„wafï¼Œåƒlibmodsec æˆ–è€… naxsiã€‚</p></blockquote><p>ä¸‹é¢ä¸»è¦ä»¥ç¦æ­¢UAä½œä¸ºä¾‹å­</p><h2 id="ä½¿ç”¨if"><a href="#ä½¿ç”¨if" class="headerlink" title="ä½¿ç”¨if"></a>ä½¿ç”¨if</h2><p>nginxä¸­çš„ifä¹Ÿæ˜¯åšæµç¨‹åˆ¤æ–­ï¼Œifå¢å¼ºäº†nginxçš„çµæ´»æ€§ã€‚ifä¼šæœ‰ä¸€äº›å‘, è¯·å‚è€ƒ <a href="https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/" target="_blank" rel="noopener">If Is Evil</a></p><p>ä¸‹é¢æ˜¯é…ç½®ç‰‡æ®µ<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">location ~ /ifua &#123;</span><br><span class="line"></span><br><span class="line">        # è®¾å®šä¸€ä¸ªæ ‡å¿—</span><br><span class="line">        <span class="builtin-name">set</span> <span class="variable">$block_user_agents</span> 0;</span><br><span class="line">        # å¯¹uaè¿›è¡Œåˆ¤æ–­</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"curl"</span>) &#123;</span><br><span class="line">           <span class="builtin-name">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"Go-Ahead-Got-It"</span>) &#123;</span><br><span class="line">           <span class="builtin-name">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"TurnitinBot"</span>) &#123;</span><br><span class="line">           <span class="builtin-name">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"GrabNet"</span>) &#123;</span><br><span class="line">           <span class="builtin-name">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        # å¯¹åˆ¤æ–­ç»“æœè¿›è¡Œå¤„ç†</span><br><span class="line">        # æ¯ä¸ªè¯·æ±‚éƒ½ä¼šå¯¹æ‰€æœ‰è§„åˆ™è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ¯æ¬¡åˆ¤æ–­ç›´æ¥return 403æ›´å¥½</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$block_user_agents</span> = 1) &#123;</span><br><span class="line">            return 403;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # æˆ–è€…è¿™ä¹ˆå†™</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~* (QQMusic|Agoo-sdk-2.0|anclient|QQGame|kwai-android))&#123;</span><br><span class="line">            return 403;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # SQLæ³¨å…¥çš„è§„åˆ™å¯ä»¥è¿™ä¹ˆå†™</span><br><span class="line">        <span class="builtin-name">set</span> <span class="variable">$block_sql_injections</span> 0;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"union.*select.*\("</span>) &#123;</span><br><span class="line">            <span class="builtin-name">set</span> <span class="variable">$block_sql_injections</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"union.*all.*select.*"</span>) &#123;</span><br><span class="line">            <span class="builtin-name">set</span> <span class="variable">$block_sql_injections</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"concat.*\("</span>) &#123;</span><br><span class="line">            <span class="builtin-name">set</span> <span class="variable">$block_sql_injections</span> 1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$block_sql_injections</span> = 1) &#123;</span><br><span class="line">            return 403;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return 200;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨curlæµ‹è¯•ä¸‹, æµ‹è¯•ä½¿ç”¨çš„nginxæ˜¯ 1.9.xç‰ˆæœ¬<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -H <span class="string">"User-Agent: chrome"</span> <span class="string">'http://127.0.0.1/ifua'</span> -i</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -H <span class="string">"User-Agent: curl"</span> <span class="string">'http://127.0.0.1/ifua'</span> -i</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">403</span> Forbidden</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -H <span class="string">"User-Agent: QQMusic"</span> <span class="string">'http://127.0.0.1/ifua'</span> -i</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">403</span> Forbidden</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -i -H <span class="string">"User-Agent: chrome"</span> <span class="string">'http://127.0.0.1/ifua?name=concat('</span></span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">403</span> Forbidden</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -i -H <span class="string">"User-Agent: chrome"</span> <span class="string">'http://127.0.0.1/ifua?name=lzz'</span></span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨map"><a href="#ä½¿ç”¨map" class="headerlink" title="ä½¿ç”¨map"></a>ä½¿ç”¨map</h2><p>mapæ˜¯ä¸€ä¸ªæ˜ å°„çš„è¿‡ç¨‹ï¼Œç¬¦åˆæŸäº›æ¡ä»¶å°±ä¼šæ˜ å°„ä¸ºæŸä¸€ä¸ªå€¼ï¼Œæ„Ÿè§‰ç”¨mapæ›´åŠ æ•´æ´ä¸€äº›ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠuaçš„è§„åˆ™æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ useragent.rules, åœ¨é…ç½®ä¸­å°±å¯ä»¥ä½¿ç”¨ <code>$badagent</code> è¿™ä¸ªå˜é‡çš„å€¼æ¥åˆ¤æ–­uaæ˜¯å¦åŒ¹é…äº†ã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">map <span class="variable">$http_user_agent</span> <span class="variable">$badagent</span> &#123;</span><br><span class="line">       <span class="built_in"> default </span>             0;</span><br><span class="line">        ~curl                1;</span><br><span class="line">        ~Go-Ahead-Got-It     1;</span><br><span class="line">        ~TurnitinBot         1;</span><br><span class="line">        ~GrabNet             1;</span><br><span class="line">        ~*(QQMusic|Agoo-sdk-2.0|anclient|QQGame|kwai-android) 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>nginxé…ç½®ï¼Œæ³¨æ„includeçš„ä½ç½®ã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">    # mapåªèƒ½åœ¨httpå—ä¸­å£°æ˜</span><br><span class="line">    include useragent.rules;</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> server </span>&#123;</span><br><span class="line">        <span class="built_in">..</span>.</span><br><span class="line">        location ~ /mapua &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$badagent</span>)&#123;</span><br><span class="line">                return 403;</span><br><span class="line">            &#125;</span><br><span class="line">        return 200;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨curl å¸¦ä¸Šä¸åŒçš„uaæµ‹è¯•<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -i -H <span class="string">"User-Agent: chrome"</span> <span class="string">'http://127.0.0.1/mapua'</span></span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -i -H <span class="string">"User-Agent: curl"</span> <span class="string">'http://127.0.0.1/mapua'</span></span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">403</span> Forbidden</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">liuzhizhi<span class="symbol">@lzz</span>-rmbp|nginx <span class="meta"># curl -i -H <span class="string">"User-Agent: QQMusic"</span> <span class="string">'http://127.0.0.1/mapua'</span></span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">403</span> Forbidden</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>ç”¨mapè¿™ç§æ–¹å¼çœ‹èµ·æ¥æ›´æ•´æ´ï¼Œä¸ªäººæ¯”è¾ƒå–œæ¬¢ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>nginxè®ºå›ä¸Šæ›¾æœ‰äººè®¨è®ºè¿‡è¿™ä¸¤ç§æ–¹å¼çš„æ€§èƒ½å¦‚ä½• <a href="https://forum.nginx.org/read.php?2,269808,269811#msg-269811" target="_blank" rel="noopener">Re: performance hit in using too many ifâ€™s</a>, æ„æ€æ˜¯è¯´ä½¿ç”¨mapæ›´é«˜æ•ˆä¸€äº›ï¼Œæˆ‘è‡ªå·±æµ‹è¯•ä¸‹æ¥å‘ç°å‡ ä¹å·®ä¸å¤šã€‚</p><p>ä¸å…‰æ˜¯uaå’Œquery stringè¿™ä¸¤ä¸ªå˜é‡ï¼Œå¯¹äºnginxå…¶ä»–çš„å˜é‡ä¹Ÿå¯ä»¥é‚£ä¹ˆæ“ä½œï¼Œä¾‹å¦‚ipåœ°å€ï¼Œç‰¹å®šçš„headeréƒ½å¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼çµæ´»çš„é˜»æ­¢è®¿é—®ï¼Œä¿æŠ¤æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/" target="_blank" rel="noopener">If Is Evil</a> æœ€æ—©æ˜¯æ˜¥å“¥æå‡ºæ¥çš„</li><li><a href="http://nginx.org/en/docs/http/ngx_http_map_module.html" target="_blank" rel="noopener">nginx mapæ–‡æ¡£</a></li><li><a href="https://www.howtoforge.com/nginx-how-to-block-exploits-sql-injections-file-injections-spam-user-agents-etc" target="_blank" rel="noopener">nginx: How To Block Exploits, SQL Injections, File Injections, Spam, User Agents, Etc</a></li><li><a href="http://ask.xmodulo.com/block-specific-user-agents-nginx-web-server.html" target="_blank" rel="noopener">How to block specific user agents on nginx web server</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ‰æ—¶å€™ä¸ºäº†è§£å†³ä¸€äº›å®‰å…¨é—®é¢˜éœ€è¦ç¦æ­¢æŸäº›ç‰¹å®šçš„è¯·æ±‚ï¼Œä¾‹å¦‚æ ¹æ®user angentæ¥é˜»æ­¢åƒåœ¾è¯·æ±‚ï¼Œç™¾åº¦çˆ¬è™«è¿™ç§ï¼Œæˆ–è€…æ˜¯å…¶ä»–çš„æ¶æ„è¯·æ±‚ï¼Œè¿˜æœ‰ä¾‹å¦‚æ ¹æ®urlçš„ç‰¹å¾é˜»æ­¢æŸäº›è¯·æ±‚ï¼Œç±»ä¼¼çš„æœ‰sqlæ³¨å…¥ç­‰ã€‚å¦‚æœéœ€æ±‚æ¯”è¾ƒç®€å•ï¼Œç›´
      
    
    </summary>
    
      <category term="æŠ€æœ¯åˆ†äº«" scheme="http://orangleliu.info/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
      <category term="openresty" scheme="http://orangleliu.info/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/openresty/"/>
    
    
      <category term="nginx" scheme="http://orangleliu.info/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>OpenRestyæŸ¥è¯¢Linux VPSä¸»æœºæµé‡</title>
    <link href="http://orangleliu.info/2016/09/23/openresty-get-vps-netflow/"/>
    <id>http://orangleliu.info/2016/09/23/openresty-get-vps-netflow/</id>
    <published>2016-09-23T10:52:36.000Z</published>
    <updated>2016-09-23T10:59:42.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä¹°äº†vpsï¼Œæ¯ä¸ªæœˆæµé‡ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘å°±æƒ³çœ‹çœ‹ç”¨äº†å¤šå°‘æµé‡ã€‚ä½†æ˜¯æˆ‘åˆä¸æƒ³å»ä¸»æœºçš„åå°æŸ¥ï¼Œæˆ‘è¿˜ä¸æƒ³ç”¨é‚£äº›ç›‘æ§è½¯ä»¶ï¼Œä¼˜ç‚¹å°é¢˜å¤§åšäº†ï¼Œäºæ˜¯æˆ‘å°±æƒ³å¼„ä¸ªè„šæœ¬ï¼Œç„¶åopenrestyè¯»å‡ºæ¥ï¼Œæˆ‘æ²¡äº‹çœ‹çœ¼ã€‚</p></blockquote><h2 id="è·å–æµé‡æ•°æ®"><a href="#è·å–æµé‡æ•°æ®" class="headerlink" title="è·å–æµé‡æ•°æ®"></a>è·å–æµé‡æ•°æ®</h2><p>vpsçš„æ“ä½œç³»ç»Ÿæ˜¯Centos6ï¼Œç”¨shellå‘½ä»¤æˆ–è€…æ˜¯è¯»å–æŸä¸ªæ–‡ä»¶è·å–</p><p>å¯ä»¥è¯»ä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ï¼Œvenet0æ˜¯ç½‘å¡å<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@CT1391 ~]# cat <span class="regexp">/sys/</span><span class="keyword">class</span><span class="regexp">/net/</span>venet0<span class="regexp">/statistics/</span>rx_bytes</span><br><span class="line"><span class="number">2300558468</span></span><br><span class="line">[root@CT1391 ~]# cat <span class="regexp">/sys/</span><span class="keyword">class</span><span class="regexp">/net/</span>venet0<span class="regexp">/statistics/</span>tx_bytes</span><br><span class="line"><span class="number">2111210364</span></span><br></pre></td></tr></table></figure></p><p>åœ¨luaä¸­æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¯»å–æ–‡ä»¶å¹¶å¾—åˆ°ç½‘å¡çš„æµé‡å€¼äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¼å¼åŒ–å¹¶è¾“å‡ºå°±å¥½äº†ã€‚</p><h2 id="luaè„šæœ¬"><a href="#luaè„šæœ¬" class="headerlink" title="luaè„šæœ¬"></a>luaè„šæœ¬</h2><p>luaè¯»å–ç½‘å¡æ•°æ®å¹¶æ˜¾ç¤ºï¼Œè¿˜éœ€è¦ä¸€ä¸ªæ¯æœˆæ¸…é›¶çš„åŠ¨ä½œï¼ˆä¸€èˆ¬éƒ½æ˜¯é‡å¯ç½‘å¡ï¼Œæ²¡æœ‰æ‰¾åˆ°å…¶ä»–æ³•å­ï¼Œéº»çƒ¦ç‚¹çš„æ–¹æ³•å°±æ˜¯æ¯ä¸ªæœˆåˆè®°å½•ä¸‹æ¥ï¼Œè‡ªå·±è®¡ç®—å½“æœˆ)ã€‚</p><p>nginxé…ç½®éƒ¨åˆ†<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">lua_code_cache</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /status &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/html;</span><br><span class="line"><span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line"><span class="attribute">content_by_lua_file</span> /etc/nginx/lua/tstatus.lua;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>éƒ¨ç½²çš„æ—¶å€™è®°å¾—æŠŠ <code>lua_code_cache</code> å¼€å¯äº†ã€‚</p><p>tstatus.lua</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">io</span> = <span class="built_in">require</span> <span class="string">"io"</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">math</span> = <span class="built_in">require</span> <span class="string">"math"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ”¹æˆè‡ªå·±çš„ç½‘å¡å’Œæ€»é‡</span></span><br><span class="line"><span class="keyword">local</span> fname = <span class="string">"eth2"</span></span><br><span class="line"><span class="keyword">local</span> month_flow = <span class="string">"250G"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">get_value</span><span class="params">(v)</span></span></span><br><span class="line"><span class="keyword">local</span> file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"/sys/class/net/"</span>..fname..<span class="string">"/statistics/"</span>..v..<span class="string">"_bytes"</span>)</span><br><span class="line"><span class="keyword">local</span> value = file:<span class="built_in">read</span>()</span><br><span class="line">file:<span class="built_in">close</span>()</span><br><span class="line"><span class="keyword">return</span> value</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">round</span><span class="params">(num, dip)</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">tonumber</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%."</span>..(dip <span class="keyword">or</span> <span class="number">0</span>)..<span class="string">"f"</span>, num))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">flow_format</span><span class="params">(v)</span></span></span><br><span class="line"><span class="keyword">local</span> v = <span class="built_in">tonumber</span>(v)</span><br><span class="line"><span class="keyword">if</span> v &lt; <span class="number">1024</span> <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> v..<span class="string">"byte"</span></span><br><span class="line"><span class="keyword">elseif</span> v &lt; <span class="number">1024</span>*<span class="number">1024</span> <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> round(v/<span class="number">1024.0</span>, <span class="number">2</span>)..<span class="string">"Kb"</span></span><br><span class="line"><span class="keyword">elseif</span> v &lt; <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span> <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> round(v/<span class="number">1024.0</span>/<span class="number">1024.0</span>, <span class="number">2</span>)..<span class="string">"M"</span></span><br><span class="line"><span class="keyword">elseif</span> v &lt; <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span> <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> round(v/<span class="number">1024.0</span>/<span class="number">1024.0</span>/<span class="number">1024.0</span>, <span class="number">2</span>)..<span class="string">"G"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> rx = get_value(<span class="string">"rx"</span>)</span><br><span class="line"><span class="keyword">local</span> tx = get_value(<span class="string">"tx"</span>)</span><br><span class="line"><span class="keyword">local</span> total = rx + tx</span><br><span class="line"></span><br><span class="line">ngx.say(<span class="string">"æ‚¨æœ¬æœˆå¯ç”¨çš„æ€»æµé‡æ˜¯"</span>..month_flow..<span class="string">"&lt;br&gt;"</span>)</span><br><span class="line">ngx.say(<span class="string">"RX:"</span>..rx..<span class="string">" -&gt; "</span>..flow_format(rx)..<span class="string">"&lt;br&gt;"</span>)</span><br><span class="line">ngx.say(<span class="string">"TX:"</span>..tx..<span class="string">" -&gt; "</span>..flow_format(tx)..<span class="string">"&lt;br&gt;"</span>)</span><br><span class="line">ngx.say(<span class="string">"Total:"</span>..total..<span class="string">" -&gt; "</span>..flow_format(total))</span><br><span class="line">ngx.<span class="built_in">exit</span>(<span class="number">200</span>)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç”¨curlæµ‹è¯•ï¼Œåœ¨æµè§ˆå™¨ä¸­ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„å“ˆï¼Œå¦‚æœæƒ³è¦çœ‹èµ·æ¥é«˜å¤§ä¸Šï¼Œå¯ä»¥å¼„ä¸€ä¸ªé¥¼å›¾æˆ–è€…æ˜¯ä»ªè¡¨ç›˜ï¼Œç„¶åç”¨jsonè·å–æµé‡å€¼å°±è¡Œäº†ã€‚</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@orangleliu lzz]<span class="meta"># curl http:<span class="comment">//192.168.59.104/status</span></span></span><br><span class="line">æ‚¨æœ¬æœˆå¯ç”¨çš„æ€»æµé‡æ˜¯<span class="number">250</span>G<span class="params">&lt;br&gt;</span></span><br><span class="line"><span class="symbol">RX:</span><span class="number">3412800496</span> -&gt; <span class="number">3.18</span>G<span class="params">&lt;br&gt;</span></span><br><span class="line"><span class="symbol">TX:</span><span class="number">61802720</span> -&gt; <span class="number">58.94</span>M<span class="params">&lt;br&gt;</span></span><br><span class="line"><span class="symbol">Total:</span><span class="number">3474603216</span> -&gt; <span class="number">3.24</span>G</span><br></pre></td></tr></table></figure><p>å…ˆè¿™ä¹ˆç€ï¼Œä¸‹ä¸ªæœˆ1å·å…ˆæŠŠç´¯è®¡çš„æµé‡è®°å½•ä¸‹æ¥ï¼Œå¼„ä¸ªæŒä¹…åŒ–å’Œè®¡ç®—å½“æœˆçš„æµç¨‹å§ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä¹°äº†vpsï¼Œæ¯ä¸ªæœˆæµé‡ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘å°±æƒ³çœ‹çœ‹ç”¨äº†å¤šå°‘æµé‡ã€‚ä½†æ˜¯æˆ‘åˆä¸æƒ³å»ä¸»æœºçš„åå°æŸ¥ï¼Œæˆ‘è¿˜ä¸æƒ³ç”¨é‚£äº›ç›‘æ§è½¯ä»¶ï¼Œä¼˜ç‚¹å°é¢˜å¤§åšäº†ï¼Œäºæ˜¯æˆ‘å°±æƒ³å¼„ä¸ªè„šæœ¬ï¼Œç„¶åopenrestyè¯»å‡ºæ¥ï¼Œæˆ‘æ²¡äº‹çœ‹çœ¼ã€‚&lt;/p&gt;

      
    
    </summary>
    
      <category term="Linux" scheme="http://orangleliu.info/categories/Linux/"/>
    
      <category term="æŠ˜è…¾" scheme="http://orangleliu.info/categories/Linux/%E6%8A%98%E8%85%BE/"/>
    
    
      <category term="openresty" scheme="http://orangleliu.info/tags/openresty/"/>
    
      <category term="vps" scheme="http://orangleliu.info/tags/vps/"/>
    
  </entry>
  
  <entry>
    <title>Openwrtä¸­åˆ©ç”¨iptableså®ç°æµé‡ç›‘æ§å’Œportalçš„åŸç†</title>
    <link href="http://orangleliu.info/2016/09/23/openwrt-iptables-using/"/>
    <id>http://orangleliu.info/2016/09/23/openwrt-iptables-using/</id>
    <published>2016-09-23T10:24:51.000Z</published>
    <updated>2016-09-23T10:42:03.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>openwrtä¸Šéœ€è¦å¼€å‘ä¸€äº›åŠŸèƒ½ï¼Œä¸­é—´ç”¨åˆ°çš„ä¸€äº›iptablesç›¸å…³çš„çŸ¥è¯†çš„æ•´ç†ï¼Œå¸Œæœ›å¯¹éœ€è¦å®ç°wifi portalåŠŸèƒ½æˆ–è€…æ˜¯æµé‡ç›‘æ§çš„æœ‹å‹å¯ä»¥æœ‰äº›å¯å‘</p></blockquote><h2 id="æµé‡ç›‘æ§"><a href="#æµé‡ç›‘æ§" class="headerlink" title="æµé‡ç›‘æ§"></a>æµé‡ç›‘æ§</h2><p>é’ˆå¯¹æ¯ä¸ªmacæ¥ç»Ÿè®¡æµé‡çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœéœ€æ±‚æ˜¯ç»Ÿè®¡æ¯å¤©çš„æ€»æµé‡è¿™ç§ï¼Œè¿˜éœ€è¦å¯¹æ¯æ¬¡å–å¾—çš„ç»“æœè¿›è¡ŒæŒä¹…åŒ–ã€‚å¯ä»¥å‚è€ƒ  <a href="https://github.com/pyrovski/wrtbwmon" target="_blank" rel="noopener">wrtbwmon</a> è¿™ä¸ªè„šæœ¬æ¥åšæ•°æ®æ”¶é›†ã€‚</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">openwrtç›‘æ§æŸä¸ªip</span><br><span class="line">æ·»åŠ ä¸€ä¸ªæ–°çš„iptables chain</span><br><span class="line">iptables -N P45</span><br><span class="line"></span><br><span class="line">å¾€åˆšæ‰å»ºçš„P45å’Œdelegate_forwardæ·»åŠ rulesï¼Œipæ¢æˆä½ æƒ³ç›‘æ§çš„</span><br><span class="line">iptables -I P45 -s <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span> -j ACCEPT</span><br><span class="line">iptables -I P45 -d <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span> -j ACCEPT</span><br><span class="line">iptables -I forwarding_rule -s <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span> -j P45</span><br><span class="line">iptables -I forwarding_rule -d <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span> -j P45</span><br><span class="line"></span><br><span class="line">-I ä»£è¡¨chain</span><br><span class="line">-s source</span><br><span class="line">-d destination</span><br><span class="line">-j å¦‚æœç¬¦åˆå°±</span><br><span class="line"></span><br><span class="line"># iptables -nvL forwarding_rule|grep <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span></span><br><span class="line"><span class="number">19657</span>   <span class="number">20</span>M P45        all  --  *      *       <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span>            <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span></span><br><span class="line"><span class="number">20214</span> <span class="number">2172</span>K P45        all  --  *      *       <span class="number">192.168</span><span class="number">.111</span><span class="number">.115</span>      <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">-n æ˜¾ç¤ºç«¯å£å·</span><br><span class="line">-L è§„åˆ™</span><br><span class="line">-v æ˜¾ç¤ºè®¡æ•°</span><br></pre></td></tr></table></figure><p>ç›‘æ§æœ¬æœºæŸä¸ªIPå’Œç«¯å£ï¼Œç»å¸¸åšæœ¬æœºçš„æŸäº›åº”ç”¨çš„æµé‡ç»Ÿè®¡</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -d <span class="number">45.78</span><span class="number">.37</span><span class="number">.246</span> -p tcp --dport <span class="number">9999</span></span><br><span class="line">iptables -I OUTPUT -s <span class="number">45.78</span><span class="number">.37</span><span class="number">.246</span> -p tcp --sport <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">iptables -I INPUT -d <span class="number">45.78</span><span class="number">.37</span><span class="number">.246</span></span><br><span class="line">iptables -I OUTPUT -s <span class="number">45.78</span><span class="number">.37</span><span class="number">.246</span></span><br><span class="line"></span><br><span class="line">iptables -nvL</span><br><span class="line"></span><br><span class="line">åˆ é™¤ä¸éœ€è¦çš„é“¾</span><br><span class="line">iptables -n -L -v --line-numbers</span><br><span class="line">iptables -D INPUT <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="ç™½åå•"><a href="#ç™½åå•" class="headerlink" title="ç™½åå•"></a>ç™½åå•</h2><p>éè½¬å‘<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç¦æ­¢æŸä¸ª<span class="selector-tag">MAC</span></span><br><span class="line"><span class="selector-tag">iptables</span> <span class="selector-tag">-A</span> <span class="selector-tag">INPUT</span> <span class="selector-tag">-m</span> <span class="selector-tag">mac</span> <span class="selector-tag">--mac-source</span> 00<span class="selector-pseudo">:0F</span><span class="selector-pseudo">:EA</span><span class="selector-pseudo">:91</span><span class="selector-pseudo">:04</span><span class="selector-pseudo">:08</span> <span class="selector-tag">-j</span> <span class="selector-tag">DROP</span></span><br><span class="line"></span><br><span class="line">åªè®©æŸä¸ª<span class="selector-tag">mac</span>è®¿é—®æŸä¸ªç«¯å£</span><br><span class="line"><span class="selector-tag">iptables</span> <span class="selector-tag">-A</span> <span class="selector-tag">INPUT</span> <span class="selector-tag">-p</span> <span class="selector-tag">tcp</span> <span class="selector-tag">--destination-port</span> 22 <span class="selector-tag">-m</span> <span class="selector-tag">mac</span> <span class="selector-tag">--mac-source</span> 00<span class="selector-pseudo">:0F</span><span class="selector-pseudo">:EA</span><span class="selector-pseudo">:91</span><span class="selector-pseudo">:04</span><span class="selector-pseudo">:07</span> <span class="selector-tag">-j</span> <span class="selector-tag">ACCEPT</span></span><br></pre></td></tr></table></figure></p><h3 id="WIFI-Portal-è®¤è¯åŸç†-iptableséƒ¨åˆ†"><a href="#WIFI-Portal-è®¤è¯åŸç†-iptableséƒ¨åˆ†" class="headerlink" title="WIFI Portal è®¤è¯åŸç† iptableséƒ¨åˆ†"></a>WIFI Portal è®¤è¯åŸç† iptableséƒ¨åˆ†</h3><p>OpenWrt è®¤è¯ä½¿ç”¨ Wifidogç±»ä¼¼ï¼Œç»ˆç«¯è¿æ¥ä¸Šæ¥ä¹‹åçœŸå¯¹httpåè®®çš„è¯·æ±‚è¿›è¡Œé‡å®šå‘åˆ°è·¯ç”±çš„portalæœåŠ¡å™¨ï¼Œåé¢å°±æ˜¯è®¤è¯çš„æµç¨‹ï¼Œå½“è®¤è¯å®Œæˆä¹‹åå°±å¯ä»¥çœŸå¯¹æŸä¸ªmacåœ°å€è¿›è¡Œæ”¾è¡Œã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è¿˜æ²¡è®¤è¯</span><br><span class="line">iptables -F forwarding_rule</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-F prerouting_rule</span><br><span class="line">iptables -I forwarding_rule -s 192.168.111.0/24 -j DROP</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I prerouting_rule -p tcp -s 192.168.111.0/24 --dport 80 -j DNAT --to 192.168.111.1:81</span><br><span class="line"></span><br><span class="line">ç™½åå•ï¼ˆç»ˆç«¯æ²¡æœ‰è®¤è¯ä¹‹å‰å¯ä»¥è®¿é—®çš„ç½‘ç«™)</span><br><span class="line">iptables -I forwarding_rule -d 115.29.23.45 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I prerouting_rule -p tcp -d 115.29.23.45 --dport 80 -j ACCEPT</span><br><span class="line">iptables -I forwarding_rule -d mapi.alipay.com -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I prerouting_rule -p tcp -d mapi.alipay.com --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line">å¼€å¯æŸä¸ªMACä¸Šç½‘</span><br><span class="line">iptables -I forwarding_rule -m mac --mac-source a4:5e:60:cd:b3:d9 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I prerouting_rule -p tcp -m mac --mac-source a4:5e:60:cd:b3:d9 --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure></p><ul><li>why new chain?</li><li>-d domaian, how handler? å¯¹äºç™½åå•ä½¿ç”¨åŸŸåï¼Œiptablesä¼šè‡ªåŠ¨æŸ¥è¯¢dnsç„¶åè½¬æ¢æˆipï¼Œç„¶ååŠ å…¥åˆ°è§„åˆ™ä¸­</li><li>ä¸ºä»€ä¹ˆè¿˜è¦natå‘¢ï¼Ÿ<ul><li>natæ˜¯ä¸ºäº†è®©80ç«¯å£httpï¼Œé‡å®šå‘åˆ°portal</li></ul></li><li><p>å¤šä¸ªdportæ€ä¹ˆåŠ?</p><ul><li><p>æœ‰ä¸ª -m â€“dports é€‰é¡¹</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp  --match multiport --dports <span class="number">110</span>,<span class="number">143</span>,<span class="number">993</span>,<span class="number">995</span> -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="http://www.right.com.cn/forum/thread-181287-1-1.html" target="_blank" rel="noopener">å‘ä¸ªopenwrtä¸‹åŸºäºiptablesçš„Luciå›¾å½¢ipæµé‡ç›‘æ§æ•™ç¨‹</a></li><li><a href="http://zhensheng.im/2014/04/27/2212/MIAO_LE_GE_MI" target="_blank" rel="noopener">iptablesæµé‡ç»Ÿè®¡</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;openwrtä¸Šéœ€è¦å¼€å‘ä¸€äº›åŠŸèƒ½ï¼Œä¸­é—´ç”¨åˆ°çš„ä¸€äº›iptablesç›¸å…³çš„çŸ¥è¯†çš„æ•´ç†ï¼Œå¸Œæœ›å¯¹éœ€è¦å®ç°wifi portalåŠŸèƒ½æˆ–è€…æ˜¯æµé‡ç›‘æ§çš„æœ‹å‹å¯ä»¥æœ‰äº›å¯å‘&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æµé‡
      
    
    </summary>
    
      <category term="Linux" scheme="http://orangleliu.info/categories/Linux/"/>
    
    
      <category term="openwrt" scheme="http://orangleliu.info/tags/openwrt/"/>
    
      <category term="iptables" scheme="http://orangleliu.info/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨github webhook ç»“åˆopenrestyè‡ªåŠ¨æ›´æ–°é™æ€åšå®¢</title>
    <link href="http://orangleliu.info/2016/09/19/github-webhooks-auto-deploy-static-blog/"/>
    <id>http://orangleliu.info/2016/09/19/github-webhooks-auto-deploy-static-blog/</id>
    <published>2016-09-19T05:26:04.000Z</published>
    <updated>2016-09-19T06:05:45.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>ä½¿ç”¨hexoåœ¨github pagesä¸Šå¼„äº†ä¸€ä¸ªé™æ€åšå®¢ï¼Œåæ¥è§‰å¾—è®¿é—®æœ‰ç‚¹æ…¢ï¼Œäºæ˜¯æ”¾åˆ°è‡ªå·±vpsä¸Šã€‚</p></blockquote><p>å¯¹äºé™æ€åšå®¢çš„éƒ¨ç½²éå¸¸ç®€å•ï¼Œæœ¬æ¥å°±æ˜¯htmlï¼Œjsï¼Œcssç­‰é™æ€æ–‡ä»¶ï¼Œåªè¦nginxä¸Šé…ç½®ä¸‹ç›®å½•å°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚ éº»çƒ¦çš„æ˜¯åšå®¢æ›´æ–°çš„æ—¶å€™ï¼Œè¿˜è¦å»vpsä¸Šæ“ä½œæ›´æ–°git pullæ“ä½œï¼Œå¦‚æœæ¯æ¬¡åœ¨æœ¬åœ°commitä¹‹åï¼Œgithubä»“åº“èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°åˆ°vpsä¸Šå¤šå¥½å•Šï¼Œäºæ˜¯å°±ç”¨åˆ°äº†webhookçš„åŠŸèƒ½ã€‚ï¼ˆè¿™é‡Œé™æ€æ–‡ä»¶çš„ç”Ÿæˆè¿˜æ˜¯åœ¨æœ¬åœ°ï¼Œåªæ˜¯æŠŠç”Ÿæˆå¥½çš„é™æ€æ–‡ä»¶pushåˆ°githubäº†ï¼Œæ‰€ä»¥è‡ªåŠ¨éƒ¨ç½²æ²¡æœ‰æ„å»ºçš„ç¯èŠ‚)</p><h2 id="éƒ¨ç½²é™æ€åšå®¢"><a href="#éƒ¨ç½²é™æ€åšå®¢" class="headerlink" title="éƒ¨ç½²é™æ€åšå®¢"></a>éƒ¨ç½²é™æ€åšå®¢</h2><p>ä»£ç cloneåˆ°vpsä¸Šçš„ç›®å½•ï¼Œç„¶åé…ç½®nginx</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"> server </span>&#123;</span><br><span class="line">        listen      80;</span><br><span class="line">        server_name  xxx.<span class="builtin-name">info</span> ;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            alias  /www/orangle.github.io/;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸‹æƒé™é—®é¢˜ ï¼Œé…ç½®å®Œæˆ<code>reload nginx</code> å°±èƒ½è®¿é—®äº†ã€‚</p><h2 id="è‡ªåŠ¨æ›´æ–°shellè„šæœ¬"><a href="#è‡ªåŠ¨æ›´æ–°shellè„šæœ¬" class="headerlink" title="è‡ªåŠ¨æ›´æ–°shellè„šæœ¬"></a>è‡ªåŠ¨æ›´æ–°shellè„šæœ¬</h2><p>ä»githubæ‹‰å–ä»£ç ï¼Œç„¶åå¼ºåˆ¶æ›´æ–°æ‰€æœ‰å†…å®¹ã€‚</p><p>git_update.sh<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line">blog_dir=/path/to/git/repository</span><br><span class="line">git=/usr/bin/git</span><br><span class="line">branch=master</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$blog_dir</span></span><br><span class="line"><span class="variable">$git</span> reset --hard origin/<span class="variable">$branch</span></span><br><span class="line"><span class="variable">$git</span> clean -f</span><br><span class="line"><span class="variable">$git</span> pull</span><br><span class="line"></span><br><span class="line">dtime=`date`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"success <span class="variable">$dtime</span>"</span>  &gt; d.txt</span><br></pre></td></tr></table></figure></p><h2 id="é…ç½®webhook"><a href="#é…ç½®webhook" class="headerlink" title="é…ç½®webhook"></a>é…ç½®webhook</h2><p>åœ¨githubä¸Šé…ç½®è¿™ä¸ªé¡¹ç›®çš„webhookï¼Œç„¶ååœ¨openrestyä¸­å†™ä¸€ä¸ªhttpæ¥å£æ¥å‡ºæ¥æ¯æ¬¡githubå‘æ¥çš„ <code>pushäº‹ä»¶</code>ã€‚<br><a href="https://developer.github.com/webhooks/" target="_blank" rel="noopener">webhookçš„è®¾ç½®æ–‡æ¡£</a> ï¼Œè¿™é‡Œè®¾ç½®æˆ  <a href="http://xxx.info/hook" target="_blank" rel="noopener">http://xxx.info/hook</a></p><p>ä¿®æ”¹nginxé…ç½®<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">     <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">     <span class="attribute">server_name</span>  xxx.<span class="literal">info</span> www.xxx.<span class="literal">info</span>;</span><br><span class="line">     <span class="attribute">lua_code_cache</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">     <span class="attribute">location</span> / &#123;</span><br><span class="line">         <span class="attribute">alias</span>  /www/orangle.github.io/;</span><br><span class="line">         <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="attribute">location</span> /hook &#123;</span><br><span class="line">         <span class="attribute">content_by_lua_file</span> /etc/nginx/hook.lua;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>luaè„šæœ¬<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">local signature = ngx.req.get_headers()[<span class="string">"X-Hub-Signature"</span>]</span><br><span class="line">local key = <span class="string">"xxxxxx"</span> --githubä¸Šé…ç½®çš„ç›¸åŒ</span><br><span class="line"><span class="keyword">if</span> signature == nil then</span><br><span class="line">    return ngx.<span class="keyword">exit</span>(<span class="number">404</span>)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- æ ¡éªŒheader</span><br><span class="line">ngx.req.read_body()</span><br><span class="line">local t = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> string.gmatch(signature, <span class="string">"(%w+)=(%w+)"</span>) <span class="keyword">do</span></span><br><span class="line">    t[k] = v</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">local str = require <span class="string">"resty.string"</span></span><br><span class="line">local digest = ngx.hmac_sha1(key, ngx.req.get_body_data())</span><br><span class="line"><span class="keyword">if</span> not str.to_hex(digest) == t[<span class="string">"sha1"</span>] then</span><br><span class="line">    return ngx.<span class="keyword">exit</span>(<span class="number">404</span>)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- æ‰§è¡Œæ›´æ–°</span><br><span class="line">os.execute(<span class="string">"bash /www/blog_update.sh"</span>);</span><br><span class="line">ngx.say(<span class="string">"OK"</span>)</span><br><span class="line">ngx.<span class="keyword">exit</span>(<span class="number">200</span>)</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ï¼githubå‘é€çš„è¯·æ±‚å¯èƒ½playloadæ¯”è¾ƒå¤§ï¼Œè¿™æ—¶å€™ <code>ngx.req.get_body_data()</code> å°±æ— æ³•æ­£å¸¸è·å–å†…å®¹ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´ <code>client_body_buffer_size 100k;</code> é…ç½®æ¥è§£å†³</p><p><a href="http://blog.liaol.net/2015/06/use-github-webhooks-to-deploy-hexo/" target="_blank" rel="noopener">å‚è€ƒæ–‡ç« </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨hexoåœ¨github pagesä¸Šå¼„äº†ä¸€ä¸ªé™æ€åšå®¢ï¼Œåæ¥è§‰å¾—è®¿é—®æœ‰ç‚¹æ…¢ï¼Œäºæ˜¯æ”¾åˆ°è‡ªå·±vpsä¸Šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹äºé™æ€åšå®¢çš„éƒ¨ç½²éå¸¸ç®€å•ï¼Œæœ¬æ¥å°±æ˜¯htmlï¼Œjsï¼Œcssç­‰é™æ€æ–‡ä»¶
      
    
    </summary>
    
      <category term="æŠ€æœ¯åˆ†äº«" scheme="http://orangleliu.info/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
      <category term="github" scheme="http://orangleliu.info/tags/github/"/>
    
      <category term="git" scheme="http://orangleliu.info/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ï¼å›¾</title>
    <link href="http://orangleliu.info/2016/07/13/learn-algorithm-graph/"/>
    <id>http://orangleliu.info/2016/07/13/learn-algorithm-graph/</id>
    <published>2016-07-13T06:47:56.000Z</published>
    <updated>2016-09-19T05:35:39.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>è¿™é‡Œçš„<code>å›¾</code>æ˜¯æ•°æ®ç»“æ„çš„å›¾ï¼Œå°è±¡éå¸¸æµ…ï¼Œæ‰€ä»¥æŒ–æŒ–åŸï¼Œä»æ„Ÿæ€§è®¤è¯†å¼€å§‹ã€‚</p></blockquote><p>å…ˆä»ç†Ÿæ‚‰çš„æƒ³ï¼Œ <code>æ ‘</code>æ˜¯å›¾çš„ä¸€ç§ï¼Œæ˜¯ä¸€ç§æ— å‘å›¾ã€‚ä»è¿™é‡Œå°±å¯ä»¥æƒ³åˆ°å›¾çš„åŒºåˆ†ï¼Œæœ‰å‘æˆ–è€…æ˜¯æ— å‘ï¼Œæ¥ç€å°±ä¼šæƒ³åˆ°èƒ½ä¸èƒ½å½¢æˆå›è·¯çš„ç‰¹æ€§ã€‚å°½é‡å¤šçš„æ¥çœ‹å›¾ï¼Œå°‘çœ‹æ ‘ã€‚</p><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul><li><code>å›¾</code> æ˜¯ç”±å®šç‚¹çš„ <code>æœ‰ç©·éç©ºé›†åˆ</code>     å’Œå®šç‚¹ä¹‹é—´è¾¹çš„é›†åˆç»„æˆã€‚é€šå¸¸çš„è¡¨ç¤º G(V,E) Gè¡¨ç¤ºå›¾ï¼ŒVæ˜¯é¡¶ç‚¹é›†åˆï¼ŒEæ˜¯è¾¹çš„é›†åˆ<ul><li>å›¾ä¸­çš„ç‚¹å«åš <code>é¡¶ç‚¹</code>ï¼Œå›¾ä¸­ä¸èƒ½æ²¡æœ‰é¡¶ç‚¹</li><li>å®šç‚¹ä¹‹é—´çš„å…³ç³»ç”± <code>è¾¹</code> æ¥æè¿°</li></ul></li><li><code>æ— å‘å›¾</code> ä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„è¾¹éƒ½æ˜¯ æ²¡æœ‰æ–¹å‘ä¹‹åˆ†çš„ï¼Œè¯¥å›¾æˆä¸º æ— å‘å›¾ã€‚</li><li><code>æœ‰å‘å›¾</code> ä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„è¾¹éƒ½æ˜¯æœ‰æ–¹å‘çš„ï¼Œä¾‹å¦‚ <code>A-&gt;B</code>ï¼Œè¯¥å›¾æˆä¸º æœ‰å‘å›¾ã€‚æœ‰å‘è¾¹ä¹Ÿå«åš <code>å¼§</code></li><li><code>æ— å‘å®Œå…¨å›¾</code> åœ¨æ— å‘å›¾ä¸­ï¼Œå¦‚æœä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´éƒ½å­˜åœ¨è¾¹ï¼Œç§°ä¸ºæ— å‘å®Œå…¨å›¾ã€‚ nä¸ªé¡¶ç‚¹æ±‚è¾¹ <code>n(n-1)/2</code></li><li><code>æœ‰å‘å®Œå…¨å›¾</code> åœ¨æœ‰å‘å›¾ä¸­ï¼Œå¦‚æœä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´éƒ½å­˜åœ¨æ–¹å‘äº’ä¸ºç›¸åçš„ä¸¤ä¸ªå¼§ï¼Œè¯¥å›¾ç§°ä¸ºæœ‰å‘å®Œå…¨å›¾ã€‚ nä¸ªé¡¶ç‚¹æ±‚è¾¹ <code>n(n-1)</code></li><li><code>ç¨€ç–å›¾</code> å’Œ <code>ç¨ å¯†å›¾</code> åˆå¾ˆå°‘è¾¹æˆ–è€…å¼§çš„å›¾å«åšç¨€ç–å›¾ï¼Œåä¹‹ç§°ä¸ºç¨ å¯†å›¾ï¼Œæ²¡æœ‰é‡åŒ–å®šä¹‰ï¼Œç›¸å¯¹è€Œè¨€ã€‚</li><li><code>æƒ</code> æœ‰äº›å›¾çš„è¾¹æˆ–å¼§å…·æœ‰ä¸å®ƒç›¸å…³çš„æ•°å­—ï¼Œè¿™ç§å’Œè¾¹ï¼Œå¼§ç›¸å…³çš„æ•°å«åšæƒï¼Œæƒå¯ä»¥è¡¨ç¤ºä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„è·ç¦»æˆ–è€…è€—è´¹</li><li><code>ç½‘</code> å¸¦æƒçš„å›¾ç§°ä¸ºç½‘</li></ul><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://www.zybuluo.com/guoxs/note/249812#æ•°æ®ç»“æ„ä¹‹å›¾" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¹‹å›¾</a> å†™çš„éå¸¸è¯¦å°½ï¼Œæ²¡çœ‹å®Œï¼Œæ„Ÿè§‰ä¸é”™ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;å›¾&lt;/code&gt;æ˜¯æ•°æ®ç»“æ„çš„å›¾ï¼Œå°è±¡éå¸¸æµ…ï¼Œæ‰€ä»¥æŒ–æŒ–åŸï¼Œä»æ„Ÿæ€§è®¤è¯†å¼€å§‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆä»ç†Ÿæ‚‰çš„æƒ³ï¼Œ &lt;code&gt;æ ‘&lt;/code&gt;æ˜¯å›¾çš„ä¸€ç§ï¼Œæ˜¯ä¸€ç§æ— å‘å›¾ã€‚ä»è¿™é‡Œå°±
      
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„" scheme="http://orangleliu.info/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="å›¾" scheme="http://orangleliu.info/tags/%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>2016 æš‘å‡çš„é˜…è¯»ä¸ç”Ÿæ´»</title>
    <link href="http://orangleliu.info/2016/07/06/reading-list-lzz-2016summer/"/>
    <id>http://orangleliu.info/2016/07/06/reading-list-lzz-2016summer/</id>
    <published>2016-07-06T10:26:52.000Z</published>
    <updated>2016-09-19T05:36:22.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>åˆæ˜¯ä¸€å¹´æš‘å‡ï¼Œè¿™ä¸ªæ—¶é—´è¿˜æ˜¯æŒºå«äººé«˜å…´çš„ï¼Œå› ä¸ºä»¥å‰è¿™ä¸ªæ—¶å€™æ€»æ˜¯æ”¾å‡å‘€ã€‚</p></blockquote><h2 id="Projects"><a href="#Projects" class="headerlink" title="Projects"></a>Projects</h2><ul><li><a href="https://github.com/kiorky/croniter" target="_blank" rel="noopener">croniter</a> pythonè¯­è¨€ï¼Œè§£æcrontabé£æ ¼çš„å®šæ—¶è®¾ç½®ï¼Œè·å–ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´ã€‚crontab formatå­˜å‚¨å®šæ—¶ä»»åŠ¡æŒºå¥½ç”¨ã€‚</li><li><a href="https://github.com/ryukinix/decorating" target="_blank" rel="noopener">ryukinix/decorating</a> ä¸€ä¸ªåŒ…å«äº†å¾ˆå¤šå°è£…å¥½çš„è£…é¥°å™¨çš„library</li></ul><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><ul><li><a href="http://www.lyonwj.com/2016/06/26/graph-of-thrones-neo4j-social-network-analysis/" target="_blank" rel="noopener">Analyzing the Graph of Thrones</a> ä¸€ä¸ªå›¾æ•°æ®åº“ä½¿ç”¨çš„ç›¸å…³æ–‡ç« ï¼Œæ²¡æ€ä¹ˆçœ‹æ‡‚ï¼Œä¸è¿‡æ„Ÿè§‰ä»¥åä¼šé‡åˆ°ã€‚</li><li><a href="https://cbrownley.wordpress.com/2016/06/26/parsing-pdfs-in-python-with-tika/" target="_blank" rel="noopener">Parsing PDFs in Python with Tika</a> ä½¿ç”¨tikaæ¥è§£æpdf</li><li><a href="https://blog.esharesinc.com/supercharging-django-productivity-at-eshares-8dbf9042825e#.4yq70uh3b" target="_blank" rel="noopener">Supercharging Django Productivity</a> djangoä¸€äº›å¸¸ç”¨çš„å®šåˆ¶ï¼Œmodelå’Œviewä¸­çš„æƒé™ç­‰ã€‚</li><li><p><a href="http://johntellsall.github.io/johntellsall.com/class/django-queryset4/_build/slides/#1" target="_blank" rel="noopener">Functional Programming and Django QuerySets</a> python å‡½æ•°å¼ç¼–ç¨‹å’Œ djangoä¸­querysetç›¸å…³çš„çŸ¥è¯†</p></li><li><p>Celery æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–</p><ul><li><a href="http://atodorov.org/blog/2014/11/05/speeding-up-celery-backends/" target="_blank" rel="noopener">Speeding up Celery Backends, Part 1</a></li><li><a href="http://atodorov.org/blog/2014/11/07/speeding-up-celery-backends-part-2/" target="_blank" rel="noopener">Speeding up Celery Backends, Part 2</a></li><li><a href="http://atodorov.org/blog/2014/11/11/speeding-up-celery-backends-part-3/" target="_blank" rel="noopener">Speeding Up Celery Backends, Part 3</a></li><li><a href="https://gist.github.com/atodorov/2bc1fcd34531ad260ed7" target="_blank" rel="noopener">test code</a></li></ul></li><li><p><a href="https://ruslanspivak.com/lsbaws-part2/" target="_blank" rel="noopener">Letâ€™s Build A Web Server. Part 2.</a> ä¸€èµ·é€ ä¸ªwebæœåŠ¡å™¨</p></li></ul><h2 id="ç³»ç»Ÿè¿ç»´"><a href="#ç³»ç»Ÿè¿ç»´" class="headerlink" title="ç³»ç»Ÿè¿ç»´"></a>ç³»ç»Ÿè¿ç»´</h2><ul><li><a href="http://tech.uc.cn/?p=1621" target="_blank" rel="noopener">è‡ªåŠ¨å¢é‡å‡çº§æ–¹æ¡ˆçš„è®¾è®¡åŠå®ç°</a> éå¸¸ç®€å•å®ç”¨çš„å¢é‡å‡çº§æ–¹æ¡ˆ</li><li><a href="http://blog.csdn.net/column/details/high-perf-network.html" target="_blank" rel="noopener">é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹ç³»åˆ—æ–‡ç« ï¼é™¶è¾‰</a></li><li><a href="http://blog.csdn.net/sparkliang/article/category/660506" target="_blank" rel="noopener">libevent æºç è§£æ</a> åŸºäºç»å…¸çš„1.4ç‰ˆæœ¬</li><li><a href="https://www.gitbook.com/book/aceld/libevent/details" target="_blank" rel="noopener">libevent æ·±å…¥æµ…å‡º</a> gitbookä¸Šçš„ç”µå­ä¹¦ï¼Œæœºé‡2.xç‰ˆæœ¬</li><li><a href="http://mysql.taobao.org/monthly/" target="_blank" rel="noopener">æ•°æ®åº“å†…æ ¸æœˆæŠ¥</a> é˜¿é‡Œæ•°æ®åº“å†…æ ¸å›¢é˜Ÿçš„ä¸€äº›åˆ†äº«</li></ul><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><ul><li><a href="https://code.aliyun.com/users/sign_in" target="_blank" rel="noopener">é˜¿é‡Œçš„gitå¹³å°</a></li></ul><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><ul><li>æœ€è¿‘ä¸€æ®µæ—¶é—´çœ‹ UNPå’ŒAPUEæ¯”è¾ƒå¤šï¼Œè¿˜æœ‰åœ¨é‡æ–°çœ‹Cï¼Œä¸»è¦ç›®çš„è¿˜æ˜¯çœ‹æ‡‚æƒ³çœ‹çš„ç»å…¸é¡¹ç›®çš„æºç ï¼Œçœ‹ä¹¦å’Œä»£ç æ—¶é—´æ¯”è¾ƒå¤šï¼Œç½‘ç»œä¸Šçš„æ–‡ç« ç­‰çœ‹çš„æ¯”è¾ƒå°‘äº†ã€‚</li><li>ä¸çŸ¥ä¸è§‰å·²ç»9æœˆä»½äº†ï¼Œä¸¤ä¸ªæœˆåŒ—äº¬ï¼Œæ·®åŒ—ï¼Œæ²ˆé˜³ï¼Œå¥”æ³¢å¤šæ¬¡ã€‚ã€‚æœ‰ç‚¹ç–²æƒ«ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;åˆæ˜¯ä¸€å¹´æš‘å‡ï¼Œè¿™ä¸ªæ—¶é—´è¿˜æ˜¯æŒºå«äººé«˜å…´çš„ï¼Œå› ä¸ºä»¥å‰è¿™ä¸ªæ—¶å€™æ€»æ˜¯æ”¾å‡å‘€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Projects&quot;&gt;&lt;a href=&quot;#Projects&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="é˜…è¯»" scheme="http://orangleliu.info/categories/%E9%98%85%E8%AF%BB/"/>
    
    
      <category term="reading" scheme="http://orangleliu.info/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå‘½ä»¤ä¹‹xargs</title>
    <link href="http://orangleliu.info/2016/05/19/linux-cmd-xargs/"/>
    <id>http://orangleliu.info/2016/05/19/linux-cmd-xargs/</id>
    <published>2016-05-19T09:46:03.000Z</published>
    <updated>2016-09-19T05:36:40.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>å¹³æ—¶åªæ˜¯åœ¨ç”¨findå‘½ä»¤æ—¶ä¼šä½¿ç”¨ <code>xargs</code>å‘½ä»¤ï¼Œä¸€ç›´æ²¡æ€ä¹ˆç³»ç»Ÿçš„å­¦ä¹ è¿‡ï¼Œä¹‹å‰ä¸€æ¬¡é¢è¯•ä¸­è¢«é—®åˆ°äº†ï¼Œæœ‰ç‚¹å“‘å£æ— è¨€ï¼Œç°åœ¨æ¥å­¦ä¸€å­¦ã€‚</p></blockquote><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><a href="https://zh.wikipedia.org/wiki/Xargs" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a>æ˜¯è¿™ä¹ˆä»‹ç»çš„,</p><blockquote><p>xargsæ˜¯ä¸€æ¡Unixå’Œç±»Unixæ“ä½œç³»ç»Ÿçš„å¸¸ç”¨å‘½ä»¤ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†å‚æ•°åˆ—è¡¨è½¬æ¢æˆå°å—åˆ†æ®µä¼ é€’ç»™å…¶ä»–å‘½ä»¤ï¼Œä»¥é¿å…å‚æ•°åˆ—è¡¨è¿‡é•¿çš„é—®é¢˜ã€‚<br>ä¾‹å¦‚åˆ é™¤æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™ä¹ˆåš rm <code>find /path -type f</code>, å¦‚æœæ–‡ä»¶è¿‡å¤šï¼Œå°±å¯èƒ½å‡ºç° <code>å‚æ•°åˆ—è¡¨è¿‡é•¿</code>çš„é”™è¯¯ï¼Œå¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚<br>è¿™ä¸ªæ—¶å€™ä½¿ç”¨ xargs å°±èƒ½æ¯”è¾ƒå¥½çš„è§£å†³é—®é¢˜ <code>find /path -type f -print0 | xargs -0 rm</code>ã€‚</p></blockquote><p>xargsæ˜¯é€šè¿‡æ ‡å‡†è¾“å…¥æˆ–è€…æ˜¯ç®¡é“ä¸­çš„ä¸€æ®µå­—ç¬¦ä¸²æ¥ä¼ é€’å‘½ä»¤çš„<code>å‚æ•°åˆ—è¡¨</code>, ä¸­é—´ä¼šæœ‰ä¸ªè§£æçš„å‚æ•°çš„è¿‡ç¨‹ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„å‘½ä»¤å¹¶æ‰§è¡Œï¼Œè¯¦ç»†çš„å‚æ•°è§£é‡Šè¯· <code>man xargs</code></p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><h3 id="0"><a href="#0" class="headerlink" title="-0"></a>-0</h3><p>xargså‚æ•°åˆ—è¡¨æ˜¯é€šè¿‡ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œè¿˜æœ‰æ¢è¡Œç¬¦æ¥åŒºåˆ†çš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¸€ä¸ªå‘½ä»¤</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">find</span> /tmp -name core -type f -<span class="builtin-name">print</span> | xargs /bin/rm -f</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¼šæ­£å¸¸çš„æ‰§è¡Œï¼Œä½†æ˜¯æ–‡ä»¶åä¸­å¦‚æœæœ‰ ç©ºæ ¼æˆ–è€…æ˜¯æ¢è¡Œç¬¦ï¼Œå°±ä¼šæ‰§è¡Œå¤±è´¥äº†</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> /tmp -<span class="built_in">name</span> core -<span class="built_in">type</span> f -print0 | xargs -<span class="number">0</span> /bin/rm -f</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™åŠ ä¸Š <code>-0</code> å°±èƒ½æ­£å¸¸æ‰§è¡Œäº†ã€‚</p><h3 id="I"><a href="#I" class="headerlink" title="-I"></a>-I</h3><p>æ›¿æ¢å­—ç¬¦ï¼ŒæŠŠè¾“å…¥è¿›æ¥çš„å‚æ•°æ›¿æ¢æˆä¸€ä¸ªè‡ªå·±å®šä¹‰çš„å­—ç¬¦ï¼Œç±»ä¼¼ç»™è¾“å…¥çš„å‚æ•°èµ·äº†ä¸€ä¸ªåˆ«åã€‚</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> . -<span class="built_in">name</span> <span class="string">'*.py'</span> -print0 | xargs -<span class="number">0</span> -I fname <span class="built_in">echo</span> fname python</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šè¾“å‡º <code>.py</code> æ–‡ä»¶çš„åç§°ï¼Œç„¶åé™„åŠ  â€œ pythonâ€ï¼Œä¹Ÿå°±æ˜¯ <code>./test.py</code> å˜æˆäº† <code>./test.py python</code></p><p>æŸ¥çœ‹ <code>/</code> ç›®å½•ä¸‹çš„æ–‡ä»¶</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">"ls -ls -h"</span>|xargs -I <span class="keyword">cmd</span><span class="bash"> sh -c cmd<span class="string">" /"</span></span></span><br></pre></td></tr></table></figure><h3 id="â€“show-limits"><a href="#â€“show-limits" class="headerlink" title="â€“show-limits"></a>â€“show-limits</h3><p>æ˜¾ç¤ºå½“å‰æ“ä½œç³»ç»Ÿï¼Œå‘½ä»¤è¡Œé•¿åº¦çš„é™åˆ¶</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[lzz@orangleliu test]$ xargs <span class="comment">--show-limits</span></span><br><span class="line">Your environment variables take up <span class="number">2161</span> bytes</span><br><span class="line">POSIX upper limit <span class="keyword">on</span> argument <span class="built_in">length</span> (this system): <span class="number">2617231</span></span><br><span class="line">POSIX smallest allowable upper limit <span class="keyword">on</span> argument <span class="built_in">length</span> (all systems): <span class="number">4096</span></span><br><span class="line">Maximum <span class="built_in">length</span> <span class="keyword">of</span> command we could actually use: <span class="number">2615070</span></span><br><span class="line">Size <span class="keyword">of</span> command buffer we are actually using: <span class="number">131072</span></span><br><span class="line"></span><br><span class="line">Execution <span class="keyword">of</span> xargs will <span class="keyword">continue</span> now, <span class="keyword">and</span> <span class="keyword">it</span> will <span class="keyword">try</span> <span class="keyword">to</span> <span class="built_in">read</span> <span class="keyword">its</span> input <span class="keyword">and</span> <span class="built_in">run</span> commands; <span class="keyword">if</span> this <span class="keyword">is</span> <span class="keyword">not</span> what you wanted <span class="keyword">to</span> happen, please type <span class="keyword">the</span> <span class="keyword">end</span>-<span class="keyword">of</span>-<span class="built_in">file</span> keystroke.</span><br><span class="line">Warning: /bin/echo will be <span class="built_in">run</span> <span class="keyword">at</span> least once.  If you do <span class="keyword">not</span> want <span class="keyword">that</span> <span class="keyword">to</span> happen, <span class="keyword">then</span> press <span class="keyword">the</span> interrupt keystroke.</span><br></pre></td></tr></table></figure><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>åˆ é™¤å½“å‰ç›®å½•ä¸‹ <code>.c</code>æ–‡ä»¶</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">find</span> . -name <span class="string">"*.c"</span> -print0 | xargs -0 rm -rf</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹åŒ…å« <code>utf-8</code>çš„ <code>.py</code> æ–‡ä»¶ï¼Œæ˜¾ç¤ºè¡Œå·</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find</span> . -name <span class="string">'*.py'</span> -print0 | xargs -<span class="number">0</span> <span class="keyword">grep</span> -n <span class="string">'utf-8'</span></span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹ <code>.bak</code> æ–‡ä»¶ï¼Œå¹¶ç§»åŠ¨åˆ° <code>~/old.files</code> æ–‡ä»¶å¤¹ä¸‹é¢</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find</span> . -name <span class="string">"*.bak"</span> -print0 | xargs -<span class="number">0</span> -I <span class="keyword">file</span> mv <span class="keyword">file</span> ~/old.<span class="keyword">files</span></span><br></pre></td></tr></table></figure><p>å®é™…ä½¿ç”¨ä¸­ï¼Œå¤æ‚çš„æ“ä½œæ¯”è¾ƒå°‘ï¼Œæš‚ä¸”è®°å½•é‚£ä¹ˆå¤šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;å¹³æ—¶åªæ˜¯åœ¨ç”¨findå‘½ä»¤æ—¶ä¼šä½¿ç”¨ &lt;code&gt;xargs&lt;/code&gt;å‘½ä»¤ï¼Œä¸€ç›´æ²¡æ€ä¹ˆç³»ç»Ÿçš„å­¦ä¹ è¿‡ï¼Œä¹‹å‰ä¸€æ¬¡é¢è¯•ä¸­è¢«é—®åˆ°äº†ï¼Œæœ‰ç‚¹å“‘å£æ— è¨€ï¼Œç°åœ¨æ¥å­¦ä¸€å­¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä»‹ç»&quot;
      
    
    </summary>
    
      <category term="linux" scheme="http://orangleliu.info/categories/linux/"/>
    
    
      <category term="cmd" scheme="http://orangleliu.info/tags/cmd/"/>
    
  </entry>
  
  <entry>
    <title>lzz&#39;s reading list 06</title>
    <link href="http://orangleliu.info/2016/05/04/reading-list-lzz-201605/"/>
    <id>http://orangleliu.info/2016/05/04/reading-list-lzz-201605/</id>
    <published>2016-05-04T06:14:24.000Z</published>
    <updated>2016-06-24T02:47:48.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>ä¸€å¹´çš„ä¸‰åˆ†ä¸€åˆè¿‡å®Œäº†ï¼Œè¿™ä¸ªæœˆåˆ«çš„äº‹ä¸æ˜¯å¾ˆå¤šï¼Œå·¥ä½œçš„äº‹æœ‰ç‚¹å¤šï¼ŒåŠ æ²¹å§ï¼</p></blockquote><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><h3 id="Philip-Guo"><a href="#Philip-Guo" class="headerlink" title="Philip Guo"></a>Philip Guo</h3><ul><li><a href="http://pgbovine.net/cpython-internals.htm" target="_blank" rel="noopener">cpython-internals</a> ä»æºç åˆ†æCPythonçš„ç³»åˆ—è§†é¢‘ å›½å¤–æŸä½å¤§å­¦è€å¸ˆçš„CSè¯¾ç¨‹</li><li><a href="http://pgbovine.net/what-is-a-programming-language.htm" target="_blank" rel="noopener">what-is-a-programming-language</a> åŒæ ·æ˜¯è¿™ä½è€å¸ˆçš„ä¸€ä¸ªå…³äºç¼–ç¨‹è¯­è¨€çš„ç†è§£çš„è§†é¢‘</li><li><a href="https://talkpython.fm/episodes/show/22/cpython-internals-and-learning-python-with-pythontutor.com" target="_blank" rel="noopener">CPython Internals and Learning Python with pythontutor.com</a> Talk Pyhton to me åšå®¢ä¸Šè¿™ä½è€å¸ˆçš„ä¸“åœºï¼Œä»–å¾—åå­—å°±æ˜¯ <strong>Philip Guo</strong></li><li><a href="http://www.pythontutor.com" target="_blank" rel="noopener">python ä»£ç æ‰§è¡Œè¿‡ç¨‹å¯è§†åŒ–</a> ä¸€ä¸ªåœ¨çº¿çš„ç½‘ç«™ï¼Œå¯ä»¥å•æ­¥æ‰§è¡ŒæŸ¥çœ‹Pythonä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒPythonå¯¹è±¡çš„ç”Ÿæˆä»¥åŠè°ƒç”¨å…³ç³»</li></ul><h3 id="Brandon-Rhodes"><a href="#Brandon-Rhodes" class="headerlink" title="Brandon Rhodes"></a>Brandon Rhodes</h3><ul><li><a href="https://www.youtube.com/watch?v=fYlnfvKVDoM" target="_blank" rel="noopener">Brandon Rhodes: All Your Ducks In A Row: Data Structures in the Std Lib and Beyond</a> Pythonæ•°æ®ç±»å‹çš„æ¼”è®²ï¼ˆè§†é¢‘ï¼‰ï¼Œ<a href="http://rhodesmill.org/brandon/slides/2014-04-pycon/data-structures/" target="_blank" rel="noopener">pptåœ°å€</a></li><li><a href="https://www.youtube.com/watch?v=C4Kc8xzcA68" target="_blank" rel="noopener">Python2010 The Mighty Dictionary</a> Python dict æ•°æ®ç±»å‹çš„åˆ†æ(è§†é¢‘ï¼‰</li><li><a href="http://rhodesmill.org/brandon/" target="_blank" rel="noopener">Brandon Rhodes talks</a>  Brandon Rhodesçš„æ¼”è®²åˆ—è¡¨ï¼Œä»–æ˜¯Dropboxçš„å·¥ç¨‹å¸ˆï¼Œå¤šæ¬¡åœ¨Pyconä¸Šåˆ†äº«ï¼Œéå¸¸å¤šçš„å¹²è´§å•Š</li></ul><h3 id="åšå®¢æ–‡ç« "><a href="#åšå®¢æ–‡ç« " class="headerlink" title="åšå®¢æ–‡ç« "></a>åšå®¢æ–‡ç« </h3><ul><li><a href="http://www.dataschool.io/easier-data-analysis-with-pandas/" target="_blank" rel="noopener">Easier data analysis in Python with pandas (video series)</a> é€šè¿‡pandaså­¦ä¹ æ•°æ®åˆ†æçš„ç³»åˆ—è§†é¢‘è¯¾ç¨‹ã€‚</li><li><a href="https://www.oreilly.com/ideas/5-reasons-you-need-to-learn-to-write-python-decorators" target="_blank" rel="noopener">5 reasons you need to learn to write Python decorators</a> å­¦ä¹ Pythonè£…é¥°å™¨çš„5ä¸ªç†ç”±ï¼Œè®²è¿°äº†è£…é¥°å™¨çš„å¸¸è§å‡ å¤§ç”¨é€”ã€‚åŒ…æ‹¬éªŒè¯ï¼Œè¿è¡Œæ—¶é—´ç»Ÿè®¡ï¼Œæ—¥å¿—ï¼Œåˆ›å»ºæ¡†æ¶ï¼Œé‡ç”¨ä»£ç ç­‰ç­‰ã€‚ï¼ˆä¸è¿‡æœ€åå¸¦äº†ç‚¹å¹¿å‘Šï¼‰</li><li><a href="http://www.openbookproject.net/py4fun/huffman/huffman.html" target="_blank" rel="noopener">The Basics of Data Compression å“ˆå¤«æ›¼ç¼–ç </a> å“ˆå¤«æ›¼ç¼–ç çš„Pythonå®ç°ï¼Œæ²¡æœ‰é‡‡ç”¨ç±»ï¼Œè€Œæ˜¯ç”¨å­—å…¸å’Œå…ƒç»„éå¸¸ç®€å•æ–¹é¢çš„å®ç°äº†é™æ€Huffmanbç¼–ç å’Œè§£ç </li></ul><h2 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h2><ul><li><a href="http://cdn.oreillystatic.com/en/assets/1/event/115/Introduction%20to%20Advanced%20Bash%20Usage%20Presentation.pdf" target="_blank" rel="noopener">GUN Bash:An Introduction to Advanced Usage</a> bashç¼–ç¨‹è¦ç‚¹æ€»ç»“ï¼Œéå¸¸å®ç”¨ï¼Œå­¦ä¹ å¤ä¹ çš„å¥½èµ„æ–™, é€‚åˆæœ‰ä¸€å®šbashç»éªŒï¼Œä½†æ˜¯åˆä¸æ˜¯å¾ˆç†Ÿçš„äºº</li><li><a href="http://www.chongh.wiki/blog/2016/05/25/sourceinsight-linux/" target="_blank" rel="noopener">vimæ‰“é€ çœ‹cæºä»£ç çš„ç¯å¢ƒ</a> æœ‰éœ€æ±‚å°±çœ‹çœ‹ï¼Œçœ‹æºç æ–¹é¢ä¸€ç‚¹</li></ul><p>1</p><h2 id="CSåŸºç¡€"><a href="#CSåŸºç¡€" class="headerlink" title="CSåŸºç¡€"></a>CSåŸºç¡€</h2><ul><li><a href="http://csapp.cs.cmu.edu/public/students.html" target="_blank" rel="noopener">csapp public</a> csapp(æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ) è¿™æœ¬ä¹¦çš„å®˜æ–¹ç½‘ç«™ï¼ŒåŒ…æ‹¬ä¸€äº›èµ„æºé“¾æ¥å’Œå®éªŒç­‰</li></ul><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><ul><li><a href="http://wpceo.com/user-database-table-design/" target="_blank" rel="noopener">æµ…è°ˆæ•°æ®åº“ç”¨æˆ·è¡¨ç»“æ„è®¾è®¡</a> é’ˆå¯¹æ¥å…¥å¤šé‡ç™»å½•æ–¹å¼çš„ç”¨æˆ·è¡¨è®¾è®¡</li></ul><h2 id="æœ‰ç”¨çš„ç½‘å€"><a href="#æœ‰ç”¨çš„ç½‘å€" class="headerlink" title="æœ‰ç”¨çš„ç½‘å€"></a>æœ‰ç”¨çš„ç½‘å€</h2><ul><li><a href="http://www.weeklypython.chat/" target="_blank" rel="noopener">Weekly Python Chat</a> ç”¨åœ¨çº¿è§†é¢‘èŠå¤©å®¤çš„å½¢å¼ï¼Œåˆ†äº«ä¸€äº›Pythonï¼Œå¼€æºç­‰ç›¸å…³çš„çŸ¥è¯†ã€‚ å¯ä»¥çœ‹ç›´æ’­ä¹Ÿå¯ä»¥çœ‹å›æ”¾ï¼Œæ¯å‘¨ä¸€æ¬¡ï¼Œæœ‰äº›ä¸»é¢˜è¿˜ä¸é”™ï¼ˆçœ‹è§†é¢‘éœ€è¦æ¢¯å­ã€‚ã€‚ï¼Œä¸»è¦æ˜¯å½¢å¼è¿˜å¬æ–°é¢–ï¼‰</li></ul><h3 id="å®‰å…¨ç›¸å…³ç½‘ç«™"><a href="#å®‰å…¨ç›¸å…³ç½‘ç«™" class="headerlink" title="å®‰å…¨ç›¸å…³ç½‘ç«™"></a>å®‰å…¨ç›¸å…³ç½‘ç«™</h3><p>ç”¨æ¥è·å–å’Œå­¦ä¹ å®‰å…¨çŸ¥è¯†çš„å¹³å°</p><p>æäº¤å¹³å°</p><ul><li>ä¹Œäº‘       </li><li>æ¼æ´ç›’å­</li><li>sobug æäº¤å¹³å°</li><li>è¡¥å¤©</li><li><a href="https://www.seebug.org" target="_blank" rel="noopener">seebug</a> æ¼æ´æäº¤ï¼Œæ¨¡å¼æœ‰ç‚¹ä¸ä¸€æ ·</li></ul><p>å®‰å…¨çŸ¥è¯†</p><ul><li>ä¹Œäº‘çŸ¥è¯†åº“  æ¯”è¾ƒä¸“ä¸šçš„æŠ€æœ¯åˆ†æ</li><li>FreeBuf  å®‰å…¨èµ„è®¯ï¼Œä»¥åŠæŠ€æœ¯æ–‡ç« ç­‰</li><li><a href="https://security.alibaba.com/?spm=a219k.7941681.0.0.Am1A99" target="_blank" rel="noopener">é˜¿é‡Œå®‰å…¨å“åº”ä¸­å¿ƒ</a> æœ‰ä¸€äº›æ¼æ´åˆ†æ</li></ul><h2 id="æ´»ç€-5-6æœˆ"><a href="#æ´»ç€-5-6æœˆ" class="headerlink" title="æ´»ç€ 5~6æœˆ"></a>æ´»ç€ 5~6æœˆ</h2><ul><li><p><code>ä¸“æ³¨</code> è¿™ä¸€æ®µæ—¶é—´å¼€å§‹æ¸æ¸å°‘å…³æ³¨èŠå¤©ç¾¤è¿˜æœ‰å¾®ä¿¡ï¼Œæ›´å¤šçš„æ—¶é—´èŠ±åœ¨é¡¹ç›®å¼€å‘ä¸Šï¼Œä¸šä½™çš„æ—¶é—´åŸºæœ¬éƒ½æ˜¯å†çœ‹ç®—æ³•åŸºç¡€å’Œæ“ä½œç³»ç»ŸåŸºç¡€ã€‚ è¿™æ ·è¿˜ä¸é”™ï¼Œå°±æ˜¯çœ‹çš„å¤šåŠ¨æ‰‹çš„å°‘ï¼Œè¦åŠ å¼ºåŠ¨æ‰‹èƒ½åŠ›ï¼ŒæŠŠæƒ³åˆ°çš„ç†è§£çš„ç”¨å®éªŒæˆ–è€…æ¨¡æ‹Ÿçš„æ–¹å¼ç›´è§‚çš„ç†è§£ï¼Œè¿˜æ¬ ç¼ºè¿™ä¸ªã€‚</p></li><li><p><code>æ€è€ƒ</code> åœ¨å…¶ä»–åšå®¢ä¸Šçœ‹åˆ°è¯´ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜è§£å†³æ€§èƒ½é—®é¢˜çš„æ–¹å¼å°±æ˜¯ æ‰“å¼€ç¼–è¾‘ï¼ŒæŠŠä»£ç çœ‹ä¸€éï¼ŒçŒœçŒœå“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œç„¶åæ”¹æ”¹æ”¹ï¼Œæœ€åè¿è¡Œï¼ŒæœŸå¾…èƒ½è¿è¡Œå¿«ç‚¹ã€‚ æ˜¯æœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Œå¯¹æ€§èƒ½é—®é¢˜å¹¶æ²¡æœ‰ä¸“ä¸šçš„æµ‹é‡ï¼Œè¿˜æœ‰æ€è€ƒï¼ŒççŒœï¼Œä¹±çŒœï¼Œç„¶åyyä¸€ä¸ªè§£å†³æ–¹å¼ï¼Œæ”¹å®Œä¹‹åå‘ç°æ²¡æ•ˆæœï¼Œç„¶åå†å°è¯•å…¶ä»–çš„ã€‚ã€‚ã€‚æ—¶é—´å°±æ˜¯æ€ä¹ˆè¢«æµªè´¹æ‰çš„ã€‚</p></li><li><p>6.1è¿™å¤©ç»ˆäºæ¬å®¶äº†ï¼Œ13å¹´10æœˆæ¥åŒ—äº¬ï¼Œå¿«3å¹´äº†å§ï¼Œè¿™åº”è¯¥æ˜¯ç¬¬äº”æ¬¡æ¬å®¶äº†ã€‚ ä½è¿‡è‡ªå»ºæˆ¿ï¼Œä½è¿‡å°é»‘å±‹ï¼Œä½è¿‡åœ°ä¸‹å®¤ï¼Œä¹Ÿä½è¿‡é«˜å±‚å°åŒºï¼Œéš”æ–­ï¼Œå•é—´ï¼Œä¸»å§ã€‚ã€‚ã€‚è¿™ç§ç§Ÿæˆ¿å‡ºç°è¿‡çš„è¯åŸºæœ¬éƒ½ä½“éªŒäº†ä¸€éã€‚ è¿™æ¬¡ä½çš„æ¯”è¾ƒé å¤–äº†ï¼Œåœ¨<code>è‚²æ–°</code>,äº”ç¯ä¹‹å¤–äº†ï¼Œæˆ¿ä¸œäººæŒºä¸é”™ï¼Œå¸Œæœ›å¯ä»¥ä½çš„é•¿ä¹…ä¸€äº›ï¼Œå®‰å®‰ç¨³ç¨³è¿‡æ—¥å­å‘€ã€‚</p></li><li><p>æœ€è¿‘è¶Šæ¥è¶Šæ„Ÿåˆ°è¿‡æ—¥å­çš„çç¢äº†ï¼Œä¸Šä¸ªæœˆå°±æ˜¯æ‰¾æˆ¿å­æ‰¾æˆ¿å­ï¼Œè™½ç„¶è¯´æˆ¿å­ç§Ÿå‡ºå»ä¸æ˜¯å¾ˆç€æ€¥ï¼Œæ€»æ˜¯ä¸ªäº‹å•Šã€‚ æ¬å®Œå®¶ï¼Œå°±å¼€å§‹æ”¶æ‹¾ï¼Œå„ç§æ´—åˆ·åˆ·ï¼Œå„ç§æ“¦æ“¦æ“¦ï¼Œç„¶åå°±æ˜¯ä¿®ç†ä¸å¥½ç”¨çš„ï¼Œç½®åŠç‚¹æƒ³ç”¨çš„ã€‚æ¥ç€å°±æ˜¯ç«¯åˆèŠ‚ï¼ˆ6.8ï¼‰å›è¶Ÿå®¶ï¼ŒåŠèº«ä»½è¯ï¼Œç°åœ¨çš„å…¬å®‰å±€è¿˜æŒºè·Ÿä¸Šæ—¶ä»£ï¼Œæ¯ä¸ªäººéƒ½è¦å½•æŒ‡çº¹äº†ï¼Œæ–°èº«ä»½è¯è¿˜èƒ½ç»™ä½ é‚®å¯„åˆ°ä»»ä½•åœ°æ–¹ã€‚ è¿™å°±æ˜¯ç”Ÿæ´»å•Šï¼Œåœ¨å®¶è·Ÿçˆ¶æ¯ï¼Œæœ‰ä»–ä»¬æ“å¿ƒï¼Œä¸€ä¸ªäººåœ¨å¤–é¢çš„æ—¶å€™ï¼Œèƒ½çœçš„éƒ½çœäº†ï¼Œä¹Ÿä¸æ“å¿ƒï¼Œç°åœ¨ä¸¤å£å­äº†ï¼Œå•¥äº‹è¯¥æ“å¿ƒçš„å°±è·‘ä¸äº†äº†ã€‚ã€‚ã€‚å¥½å¥½æ‰¿æ‹…èµ·æ¥è´£ä»»å§ï¼Œå°ä¼™å­ã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸€å¹´çš„ä¸‰åˆ†ä¸€åˆè¿‡å®Œäº†ï¼Œè¿™ä¸ªæœˆåˆ«çš„äº‹ä¸æ˜¯å¾ˆå¤šï¼Œå·¥ä½œçš„äº‹æœ‰ç‚¹å¤šï¼ŒåŠ æ²¹å§ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Python&quot;&gt;&lt;a href=&quot;#Python&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
    
      <category term="reading" scheme="http://orangleliu.info/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>lzz&#39;s reading list 05</title>
    <link href="http://orangleliu.info/2016/04/23/reading-list-lzz-201604/"/>
    <id>http://orangleliu.info/2016/04/23/reading-list-lzz-201604/</id>
    <published>2016-04-23T00:57:26.000Z</published>
    <updated>2016-08-18T09:54:53.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="ä¹¦å•-amp-amp-åšå®¢"><a href="#ä¹¦å•-amp-amp-åšå®¢" class="headerlink" title="ä¹¦å• &amp;&amp; åšå®¢"></a>ä¹¦å• &amp;&amp; åšå®¢</h3><ul><li><a href="https://github.com/tinyclub/open-c-book" target="_blank" rel="noopener">Cè¯­è¨€ç¼–ç¨‹é€è§†</a> å¼€æºç”µå­ä¹¦ï¼Œä¸»è¦è¯´è¯´ <code>Hello World</code> èƒŒåå‘ç”Ÿçš„æ•…äº‹</li><li><a href="http://blog.csdn.net/column/details/high-perf-network.html" target="_blank" rel="noopener">é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹</a>  é™¶è¾‰å¤§ç¥ç½‘ç»œç¼–ç¨‹çš„ç³»åˆ—åˆ†äº«</li><li><a href="http://how-to-write-makefile.readthedocs.org/zh_CN/latest/index.html" target="_blank" rel="noopener">è·Ÿæˆ‘ä¸€èµ·å†™Makefile</a> MakeFile æœ€å¹¿ä¸ºæµä¼ çš„æ•™ç¨‹ä¹‹ä¸€</li></ul><ul><li><a href="http://www.cnblogs.com/huangxincheng/" target="_blank" rel="noopener">ä¸€çº¿ç å†œ åšå®¢</a>æºç¨‹çš„ä¸€ä¸ªåŒè¡Œï¼Œå¾ˆå¤šåŸºç¡€å’Œå®ç”¨çš„åˆ†äº«ï¼Œç®—æ³•ï¼Œredisï¼Œmongodbï¼Œè¿˜æœ‰WINç›¸å…³çš„å¼€å‘ç»éªŒã€‚</li></ul><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><ul><li><a href="https://www.codementor.io/python/tutorial/essential-python-interview-questions" target="_blank" rel="noopener">Python é¢è¯•15é—®</a> æ¯”è¾ƒç»å…¸çš„é¢è¯•é—®é¢˜</li><li><a href="https://www.reddit.com/r/Python/comments/4fdi6j/how_fast_can_we_make_interpreted_python/" target="_blank" rel="noopener">How fast can we make interpreted Python?</a> redditä¸Šçš„ä¸€ä¸ªå…³äºPythonè§£é‡Šå™¨æ€§èƒ½ç›¸å…³çš„è®¨è®ºï¼ŒCPython2ï¼ŒCpython3ï¼ŒPypyè¿˜æ˜¯Falconï¼Œæˆ–è€…å…¶ä»–çš„å‘¢ï¼Ÿ</li><li><a href="http://faster-cpython.readthedocs.org/cpython36.html" target="_blank" rel="noopener">Faster CPython</a> cpython36 è§£é‡Šå™¨ç›¸å…³çš„å†…å®¹ï¼Œå„ç§ä¼˜åŒ–çš„æ–¹æ¡ˆä»¥åŠæµ‹è¯•ç­‰ä¿¡æ¯, å¯¹Pythonè§£é‡Šå™¨å…³æ³¨çš„å¯ä»¥çœ‹çœ‹ã€‚</li></ul><h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><ul><li><a href="http://coolshell.cn/articles/4102.html" target="_blank" rel="noopener">å¦‚ä½•å­¦å¥½Cè¯­è¨€</a> çš“å“¥çš„å»ºè®®å’Œå¿ƒå¾—ï¼Œè€æ–‡ç« ï¼Œå¤šæ‹¿æ¥çœ‹çœ‹. é‚£ä¹ˆå¤šå¹´éƒ½è¿˜æ˜¯çœ‹äº†Cå°±å¤´æ™•ï¼Œè¿™ä¸€æ¬¡è¦å…‹æœè¿™ä¸ªåã€‚è¯­è¨€ã€ç®—æ³•å’Œæ•°æ®ç»“æ„ã€ç³»ç»Ÿè°ƒç”¨å’Œè®¾è®¡ï¼Œå…¶å®è¿˜æ˜¯åŸºç¡€ä¸å¤Ÿï¼Œæ‰€ä»¥é‚£äº›ä¸Šå±‚å»ºç­‘ä¹Ÿæ˜¯ç©ºä¸­æ¥¼é˜å‘€ï¼Œæ·±å…¥é—®å‡ å¥å°±ä¸çŸ¥æ‰€ä»¥ç„¶äº†ã€‚è¦æœ‰ä¸ªé•¿æœŸçš„å¿ƒé‡Œå‡†å¤‡ï¼Œåˆ«è¢«å…¶ä»–çš„å°ç‹ç‹¸å¸å¼•èµ°ï¼Œå¥å…¨çš„çŸ¥è¯†ä½“ç³»æ˜¯è¦ä¸“æ³¨æ‰èƒ½æ…¢æ…¢å»ºç«‹èµ·æ¥çš„ã€‚</li></ul><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><ul><li><a href="http://www.cnblogs.com/DBFocus/archive/2011/10/12/2208580.html" target="_blank" rel="noopener">ä¸€æ­¥ä¸€æ­¥è¿›è¡Œæ•°æ®åº“è®¾è®¡</a> åšå®¢å›­ä¸Šçš„ä¸€ç³»åˆ—æ•°æ®åº“è®¾è®¡çš„ç»éªŒåˆ†äº«ï¼Œé’ˆå¯¹ç³»ç»Ÿå¼€å‘ä¸­æ•°æ®è®¾è®¡è¿›è¡Œçš„ç»éªŒæ€»ç»“ï¼ŒåŒ…æ‹¬æ¡ˆä¾‹çš„æ€è€ƒè®¾è®¡è¿‡ç¨‹ï¼Œç±»ä¼¼çš„æ–‡ç« çœ‹åˆ°çš„æ¯”è¾ƒå°‘ï¼Œå€¼å¾—å­¦ä¹ ã€‚</li><li><a href="http://dbanotes.net/arch/salesforce_multitenancy_intro.html" target="_blank" rel="noopener">å‰–æForce.comçš„å¤šç§Ÿæˆ·æ¶æ„</a>  è®²è§£äº†saleforceå¤šç§Ÿæˆ·æ¶æ„çš„è®¾è®¡ä»¥åŠå®ç°æ–¹å¼çš„æ¢è®¨ï¼Œå¯¹äºéœ€è¦åšè¿™æ–¹é¢éœ€æ±‚çš„æœ‰ä¸ªå¾ˆç›´è§‚çš„è®¤è¯†</li></ul><h3 id="å¼€æºé¡¹ç›®"><a href="#å¼€æºé¡¹ç›®" class="headerlink" title="å¼€æºé¡¹ç›®"></a>å¼€æºé¡¹ç›®</h3><ul><li><a href="https://github.com/aosabook/500lines" target="_blank" rel="noopener">500lines</a> è¿™æœ¬ä¹¦å’Œã€Šå¼€æºæ¡†æ¶ã€‹æ˜¯ä¸€ä¸ªç½‘ç«™å‡ºçš„ï¼Œé‡Œé¢è®²çš„çš„æ˜¯ä¸€äº›å¸¸ç”¨çš„webçš„æˆ–è€…æ˜¯å¼€å‘çš„ç»„ä»¶ï¼Œå‡ ç™¾è¡Œçš„ä»£ç æ¥å®ç°ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½çš„è¿‡ç¨‹ï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ã€‚</li><li><a href="https://github.com/yangyangwithgnu/use_vim_as_ide" target="_blank" rel="noopener">åƒIDEä¸€æ ·ä½¿ç”¨vim</a> ä½œè€…åŸºäºä¼—å¤šçš„å®ç”¨æ’ä»¶æ‰“é€ è‡ªå·±çš„ <code>C/C++</code> vim ideï¼Œä¾èµ–æ’ä»¶æ¯”è¾ƒå¤šï¼Œæ•ˆæœè¿˜æ˜¯æŒºå¥½çš„</li><li><a href="https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md" target="_blank" rel="noopener">å‘½ä»¤è¡Œçš„è‰ºæœ¯</a> githubä¸Šstartè¶…è¿‡25000ï¼Œä¸€ç¯‡ç®€çŸ­çš„æ–‡ç« åŒ…å«ä¸°å¯Œçš„shellç¼–ç¨‹çŸ¥è¯†ï¼Œä»”ç»†è¯»ä¸€è¯»ï¼Œèƒ½æ”¶è·ä¸å°‘ã€‚</li></ul><h3 id="æ¶æ„-ç»éªŒ"><a href="#æ¶æ„-ç»éªŒ" class="headerlink" title="æ¶æ„*ç»éªŒ"></a>æ¶æ„*ç»éªŒ</h3><ul><li><a href="http://www.jikexueyuan.com/course/2658.html" target="_blank" rel="noopener">è§å¾®çŸ¥è‘—-æŠ€æœ¯åˆ†äº«</a>  é›¨ç—•çš„ç»éªŒåˆ†äº«ï¼Œå¤§ç‰›çš„å®æˆ˜æ€è€ƒ</li><li><a href="http://web.archive.org/web/20120211232457/http://www.reachcrm.com/2010/03/11/multi-tenant-strategy-for-saas-using-mysql5" target="_blank" rel="noopener">Multi Tenant Saas using MySQL5</a>  ä¸€ä¸ªå®ä¾‹ä¸€ä¸ªDBæ¥å®ç°SAASä¸­çš„å¤šç§Ÿæˆ·ï¼Œè¿™ä½ä½œè€…è®²è¿°äº†ä»–åšä¸€ä¸ªSAASç³»ç»Ÿçš„ç»éªŒã€‚ tenant idå¯¹ç»ˆç«¯ç”¨æˆ·å’Œç§Ÿæˆ·å‡ä¸å¯çŸ¥ï¼Œbaseè¡¨å’Œåº”ç”¨è¡¨æƒé™åˆ†ç¦»ï¼ŒæŠŠç§Ÿæˆ·ä¿¡æ¯å’Œåº”ç”¨ä¿¡æ¯å­˜åœ¨ä¸åŒçš„æ•°æ®åº“ã€‚ ä»–è¿™é‡Œä¼šç»™æ¯ä¸ªç§Ÿæˆ·åˆ›å»ºä¸åŒçš„MySQLç”¨æˆ·ï¼Œæ¯ä¸ªç§Ÿæˆ·çš„ç”¨æˆ·è¿æ¥æ•°æ®åº“æ—¶å€™ä¼šä½¿ç”¨å½“å‰ç§Ÿæˆ·çš„MySQLé…ç½®ï¼Œé€šè¿‡ä¸€ä¸ªå®šåˆ¶çš„è§†å›¾ï¼ˆè§†å›¾å’Œbaseçš„åŒºåˆ«å°±æ˜¯å¢åŠ äº†ç§Ÿæˆ·IDçš„è¿‡æ»¤æ¡ä»¶ï¼‰æ¥è·å–ç”¨æˆ·çš„æ•°æ®ã€‚ä¸»è¦æ˜¯é€šè¿‡MySQLå’Œ<code>USER( )</code>æ¥å»ºç«‹è‡ªåŠ¨æ•°æ®è¿‡æ»¤è§†å›¾ï¼Œwebå±‚çš„å¼€å‘å°±å¯ä»¥ä»æ— æ•°çš„ <code>where tid=xxx</code> ä¸­è§£è„±å‡ºæ¥ã€‚ YII æ¡†æ¶çš„wikiä¸Šæœ‰ä¸ªphpç‰ˆæœ¬çš„<a href="http://www.yiiframework.com/wiki/603/a-multi-tenant-strategy-using-yii-and-mysql/" target="_blank" rel="noopener">ç®€å•å®ç°</a></li></ul><h3 id="ç”Ÿä¸æ´»"><a href="#ç”Ÿä¸æ´»" class="headerlink" title="ç”Ÿä¸æ´»"></a>ç”Ÿä¸æ´»</h3><ul><li><p>å¯¹äºæŸäº›ä¸åˆ‡å®é™…çš„ä¸œè¥¿è¿‡äºåæ‰§ï¼Œç‰¹åˆ«æ˜¯æŠ€æœ¯çš„ä¸œè¥¿ï¼Œæ–¹å‘ä¸Šæœ‰é—®é¢˜ã€‚ å¤ªè´ªå¤šï¼Œç¼ºä¹ä»ä¸€è€Œç»ˆï¼Œä»æ½œå…¥æ·±çš„è¿‡ç¨‹ï¼Œå…¶ä»–çš„èƒ½åŠ›çš„è‡ªæˆ‘è¦æ±‚å¤ªä½ï¼Œæ›´å¤šçš„ä»éæŠ€æœ¯å±‚é¢å»è®¤è¯†å’Œç†è§£äººäº‹ã€‚</p></li><li><p>ä¹‹å‰æˆ‘æ¯å¤©éƒ½èŠ±å¥½å¤šæ—¶é—´åœ¨æŠ€æœ¯ç¾¤ï¼Œçœ‹çš„å¤šèŠçš„å°‘ï¼Œæ¯å¤©çœ‹å¾ˆå¤šæŠ€æœ¯åšå®¢ï¼Œæ³›è¯»å¾ˆå¤šï¼Œåˆ°ç°åœ¨æˆ‘æ‰å‘ç°ï¼Œå¾ˆå¤šæ—¶é—´éƒ½æ˜¯æ¯«æ— æ”¶è·çš„ï¼Œçœ‹å®Œä¸€å †ä¸œè¥¿ä¹‹åï¼Œæˆ‘é—®è‡ªå·±æ”¶è·åˆ°äº†ä»€ä¹ˆï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯å•¥ä¹Ÿæ²¡æœ‰è®°ä½ï¼Œä¹Ÿæ²¡æœ‰å°è±¡æ·±åˆ»çš„æ–°çŸ¥è¯†å‘€ã€‚ åŸæ¥ä¹‹å‰é‚£ä¹ˆä¹…æ•ˆç‡é‚£ä¹ˆä½ï¼Œæ€ªä¸å¾—æ€»æ˜¯è§‰å¾—äº‹å€åŠŸåŠã€‚è¿˜æ˜¯è¸è¸å®å®æŠŠè¯»ä¹¦è®¡åˆ’è½å®äº†ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹å°±è¶³å¤Ÿäº†å‘€ã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;ä¹¦å•-amp-amp-åšå®¢&quot;&gt;&lt;a href=&quot;#ä¹¦å•-amp-amp-åšå®¢&quot; class=&quot;headerlink&quot; title=&quot;ä¹¦å• &amp;amp;&amp;amp; åšå®¢&quot;&gt;&lt;/a&gt;ä¹¦å• &amp;amp;&amp;amp; åšå®¢&lt;/h3&gt;&lt;ul&gt;

      
    
    </summary>
    
    
      <category term="reading" scheme="http://orangleliu.info/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>Pythonå’Œshellä¸­Base64ç¼–ç ä½¿ç”¨é‚£äº›äº‹</title>
    <link href="http://orangleliu.info/2016/04/17/python-shell-base64/"/>
    <id>http://orangleliu.info/2016/04/17/python-shell-base64/</id>
    <published>2016-04-17T01:40:30.000Z</published>
    <updated>2016-05-20T03:43:57.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>åšå¼€å‘ç¬¬ä¸€ä¸ªæ¥è§¦çš„ç¼–ç æ–¹å¼å°±æ˜¯Base64ï¼Œå½“æ—¶æ˜¯ç”¨urlæ¥ä¼ è¾“ä¸€äº›å‚æ•°ï¼Œä¼ è¾“çš„ä¸¤ç«¯ä¼šç”¨Base64æ¥ç¼–ç å’Œè§£ç ï¼Œä¿è¯æ•°æ®ä¸è¢«urlè½¬ä¹‰ç ´åã€‚</p></blockquote><p>ä¸‹é¢æ˜¯ <a href="https://zh.wikipedia.org/wiki/Base64" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a> Base64  ä¸­çš„ä»‹ç»ï¼Œå…¶å®è‡ªå·±å®ç°èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéº»çƒ¦ã€‚</p><blockquote><p><strong>Base64</strong> æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äº2çš„6æ¬¡æ–¹ç­‰äº64ï¼Œæ‰€ä»¥æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚ä¸‰ä¸ªå­—èŠ‚æœ‰24ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº4ä¸ªBase64å•å…ƒï¼Œå³3ä¸ªå­—èŠ‚éœ€è¦ç”¨4ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚å®ƒå¯ç”¨æ¥ä½œä¸ºç”µå­é‚®ä»¶çš„ä¼ è¾“ç¼–ç ã€‚åœ¨Base64ä¸­çš„å¯æ‰“å°å­—ç¬¦åŒ…æ‹¬å­—æ¯A-Zã€a-zã€æ•°å­—0-9ï¼Œè¿™æ ·å…±æœ‰62ä¸ªå­—ç¬¦ï¼Œæ­¤å¤–ä¸¤ä¸ªå¯æ‰“å°ç¬¦å·åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­è€Œä¸åŒã€‚</p></blockquote><h3 id="Shellä¸­ä½¿ç”¨"><a href="#Shellä¸­ä½¿ç”¨" class="headerlink" title="Shellä¸­ä½¿ç”¨"></a>Shellä¸­ä½¿ç”¨</h3><p>ä¸€èˆ¬Linuxç³»ç»Ÿä¸­éƒ½ä¼šæœ‰ä¸ªbase64çš„å‘½ä»¤ï¼Œopensslå‘½ä»¤ä¹Ÿæœ‰base64çš„é€‰é¡¹ã€‚</p><h4 id="base64-å‘½ä»¤"><a href="#base64-å‘½ä»¤" class="headerlink" title="base64 å‘½ä»¤"></a>base64 å‘½ä»¤</h4><p>å­—ç¬¦ä¸²æ“ä½œï¼Œæ›´å¤šå‚è€ƒ <code>man base64</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo "you are so cool"|base64</span></span><br><span class="line">eW91IGFyZSBzbyBjb29sCg==</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo "eW91IGFyZSBzbyBjb29sCg=="|base64 -d</span></span><br><span class="line">you are so cool</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸­æ–‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo "ä½ çœŸå¸…"|base64</span></span><br><span class="line">5L2g55yf5biFCg==</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo "5L2g55yf5biFCg=="|base64 -d</span></span><br><span class="line">ä½ çœŸå¸…</span><br></pre></td></tr></table></figure><h4 id="opensslå‘½ä»¤"><a href="#opensslå‘½ä»¤" class="headerlink" title="opensslå‘½ä»¤"></a>opensslå‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openssl enc -base64 &lt;&lt;&lt; <span class="string">"good boy"</span></span><br><span class="line">Z29vZCBib3kK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ openssl enc -base64 -d &lt;&lt;&lt; <span class="string">"Z29vZCBib3kK"</span></span><br><span class="line">good boy</span><br></pre></td></tr></table></figure><h3 id="Python-ä½¿ç”¨base64"><a href="#Python-ä½¿ç”¨base64" class="headerlink" title="Python ä½¿ç”¨base64"></a>Python ä½¿ç”¨base64</h3><p>æ ‡å‡†åº“ä¸­æä¾›äº†base16ï¼Œbase32, base64 å¥½å‡ ä¸ªæ¥å£ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ <code>base64.b64encode</code> å’Œ <code>base64.b64decode</code> ï¼Œè¿˜æœ‰é’ˆå¯¹äºurlçš„æ”¹è¿›æ–¹å¼ <code>base64.urlsafe_b64encode</code> å’Œ <code>base64.urlsafe_b64decode</code>, è¿™ä¸€å¯¹æ–¹æ³•å’Œæ ‡å‡†çš„base64ä¸åŒçš„æ˜¯é’ˆå¯¹urlæ”¹å–„äº†64ä¸ªå­—ç¬¦ä¸­æœ€å2ä¸ªï¼Œå…·ä½“çš„çœ‹è¿™é‡Œçš„<a href="https://docs.python.org/2/library/base64.html#base64.urlsafe_b64decode" target="_blank" rel="noopener">è¯´æ˜</a>, ç»“åˆwikiä¸­çš„ <code>base64ç´¢å¼•è¡¨</code> å°±æ˜ç™½äº†ã€‚</p><h4 id="ç¼–ç -å’Œ-è§£ç "><a href="#ç¼–ç -å’Œ-è§£ç " class="headerlink" title="ç¼–ç  å’Œ è§£ç "></a>ç¼–ç  å’Œ è§£ç </h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python -c <span class="string">"import base64; print base64.b64encode('you are so cool')"</span></span><br><span class="line">eW91IGFyZSBzbyBjb29s</span><br><span class="line"></span><br><span class="line">$ python -c <span class="string">"import base64; print base64.b64decode('eW91IGFyZSBzbyBjb29s')"</span></span><br><span class="line">you are so cool</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ— æ³•å¯¹unicodeç›´æ¥base64ç¼–ç , æ‰€ä»¥è¯·æ³¨æ„å­—ç¬¦ç¼–ç é—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python -c "import base64; print base64.b64encode('é…·')"</span></span><br><span class="line">6YW3</span><br><span class="line"></span><br><span class="line"><span class="comment"># python -c "import base64; print base64.b64encode(u'é…·')"</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;string&gt;"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/base64.py"</span>, line 53, <span class="keyword">in</span> b64encode</span><br><span class="line">    encoded = binascii.b2a_base64(s)[:-1]</span><br><span class="line">UnicodeEncodeError: <span class="string">'ascii'</span> codec can<span class="string">'t encode characters in position 0-2: ordinal not in range(128)</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨ä»£ç ç‰‡æ®µ"><a href="#å¸¸ç”¨ä»£ç ç‰‡æ®µ" class="headerlink" title="å¸¸ç”¨ä»£ç ç‰‡æ®µ"></a>å¸¸ç”¨ä»£ç ç‰‡æ®µ</h4><p>ç»å¸¸ä½¿ç”¨çš„æ–¹å¼æ˜¯å¯¹ç¼–ç ä¹‹åå­—ç¬¦ä¸²ç»“å°¾çš„ <code>=</code>åšå‰”é™¤ ã€‚å¯¹äº <code>urlsafe_b64encode</code> å’Œ <code>b64encode</code> éƒ½é€‚ç”¨ï¼Œé’ˆå¯¹ä¸åŒç¼–ç¨‹è¯­è¨€ç›¸äº’è½¬åŒ–çš„æƒ…å†µè¯·å…·ä½“å‚ç…§è¯­è¨€çš„å®ç°æ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64encode</span><span class="params">(raw)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> base64.urlsafe_b64encode(raw).strip(<span class="string">"="</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64decode</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> base64.urlsafe_b64decode(data + <span class="string">"="</span> * (-len(data)%<span class="number">4</span>))</span><br></pre></td></tr></table></figure><h3 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h3><ul><li><a href="http://askubuntu.com/questions/178521/how-can-i-decode-a-base64-string-from-the-command-line" target="_blank" rel="noopener">how can i decode a base64 string from command line</a></li><li><a href="https://zh.wikipedia.org/wiki/Base64" target="_blank" rel="noopener">base64 ä¸­æ–‡Wiki</a></li><li><a href="https://docs.python.org/2/library/base64.html" target="_blank" rel="noopener">python2 base64æ–‡æ¡£</a></li><li><a href="https://pymotw.com/2/base64/" target="_blank" rel="noopener">PyMOTW base64</a></li><li><a href="http://stackoverflow.com/questions/3302946/how-to-base64-url-decode-in-python" target="_blank" rel="noopener">how to base64 url decode in python</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;åšå¼€å‘ç¬¬ä¸€ä¸ªæ¥è§¦çš„ç¼–ç æ–¹å¼å°±æ˜¯Base64ï¼Œå½“æ—¶æ˜¯ç”¨urlæ¥ä¼ è¾“ä¸€äº›å‚æ•°ï¼Œä¼ è¾“çš„ä¸¤ç«¯ä¼šç”¨Base64æ¥ç¼–ç å’Œè§£ç ï¼Œä¿è¯æ•°æ®ä¸è¢«urlè½¬ä¹‰ç ´åã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ &lt;a href=&quot;
      
    
    </summary>
    
      <category term="å¯†ç å­¦" scheme="http://orangleliu.info/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="shell" scheme="http://orangleliu.info/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>lzz&#39;s reading list 04</title>
    <link href="http://orangleliu.info/2016/04/05/reading-list-201602/"/>
    <id>http://orangleliu.info/2016/04/05/reading-list-201602/</id>
    <published>2016-04-05T06:51:08.000Z</published>
    <updated>2016-04-05T07:01:59.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p> 2æœˆè¿‡å¹´ï¼Œå›å®¶çš„æ—¶é—´åŸºæœ¬æ²¡æœ‰æ€ä¹ˆé˜…è¯»ï¼Œæ‰€ä»¥ä¸¤ä¸ªæœˆåˆåœ¨ä¸€èµ·å§ï¼Œé¡ºä¾¿æ”¹äº†ä¸ªæ ‡é¢˜åå­—ï¼Œå˜¿å˜¿ã€‚</p></blockquote><h3 id="è¯»ä¹¦"><a href="#è¯»ä¹¦" class="headerlink" title="è¯»ä¹¦"></a>è¯»ä¹¦</h3><ul><li>Unixç¼–ç¨‹è‰ºæœ¯ï¼ˆä¸­æ–‡ç‰ˆï¼‰  è¯»äº†ä¸€åŠ</li><li><a href="http://interactivepython.org/runestone/static/thinkcspy/index.html" target="_blank" rel="noopener">How to Think Like a Computer Scientist</a>  åˆšå¼€å§‹è¯»</li><li><a href="http://interactivepython.org/runestone/static/pythonds/index.html" target="_blank" rel="noopener">Problem Solving with Algorithms and Data Structures</a>  åˆšå¼€å§‹è¯»</li><li><a href="http://inst.eecs.berkeley.edu/~cs61a/sp12/book/index.html" target="_blank" rel="noopener">ä¼¯å…‹åˆ©cs61Açš„æ•™æ</a>    æœªè¯», çœ‹èµ·æ¥å†…å®¹è¿˜ä¸é”™</li><li>ã€Šä¸€ä¸‡å°æ—¶å¤©æ‰ç†è®º ã€‹ ä¹‹å‰ç»å¸¸çœ‹åˆ°åˆ«äººå¼•ç”¨ï¼Œè¿™æ¬¡æ‰çœŸæ­£çœ‹åˆ°ä¹¦ã€‚ 1wå°æ—¶å…¶å®æ˜¯ä½œè€…æ ¹æ®åˆ«äººæˆåŠŸæ‰€éœ€è¦çš„ç»ƒä¹ æ—¶é—´æ¨ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯ä¹¦çš„é‡ç‚¹ã€‚ ä¹¦ä¸­æå‡ºæœ€ä¸»è¦çš„æˆåŠŸå› ç´ æ˜¯ <code>ç²¾æ·±ç»ƒä¹ </code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹ä¸€é—¨æŠ€æœ¯ç±»ä¼¼çš„çŸ¥è¯†ï¼Œéœ€è¦æ·±åº¦çš„ç»ƒä¹ ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è®²ç©¶æ–¹å¼æ–¹æ³•çš„ï¼Œè¿˜æœ‰ä¸€äº›æƒ…æ„Ÿï¼Œå“è´¨ï¼Œç¯å¢ƒçš„å› ç´ ã€‚ ç”¨è‡ªå·±è¯æ€»ç»“ä¸‹å°±æ˜¯ï¼šèƒ½åä½å†·æ¿å‡³ï¼Œå¸¦æœ‰æ¿€æƒ…çš„ç ”ç©¶çŸ¥è¯†çš„ç»†èŠ‚ï¼Œå»ºç«‹æ›´é«˜å±‚æ¬¡çš„çŸ¥è¯†ä½“ç³»ï¼Œå®è·µå®è·µå®è·µã€‚</li><li>ã€Šæ±‡ç¼–è¯­è¨€ã€‹ ç‹çˆ½è€å¸ˆçš„ï¼Œéšä¾¿ç¿»ç¿»ï¼Œæ²¡æœ‰ç»†ç»†ç ”è¯»ï¼Œåé¢æœ‰è®¡åˆ’è®¤çœŸçœ‹ä¸€çœ‹</li></ul><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><ul><li><a href="http://scotdoyle.com/python-epoll-howto.html" target="_blank" rel="noopener">Python epoll how to</a> pyä¸­æ€æ ·ä½¿ç”¨epollæ¥å†™socketç¨‹åºï¼ŒåŒ…æ‹¬è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘çš„ä¾‹å­</li><li><a href="https://speakerdeck.com/benoitc" target="_blank" rel="noopener">benoitc çš„ppt</a> benoitcæ˜¯Gunicornçš„åˆ›å»ºè€…ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šä»–çš„æ¼”è®²pptï¼Œå¦‚æœä½ æƒ³ç ”ç©¶Gunicornï¼Œæœ‰å¿…è¦çœ‹çœ‹</li><li><a href="https://blog.heroku.com/archives/2016/3/17/in_deep_with_django_channels_the_future_of_real_time_apps_in_django" target="_blank" rel="noopener">Finally, Real-Time Django Is Here: Get Started with Django Channels</a> ä»‹ç»äº†Django realtime åº”ç”¨çš„ä¸€ä¸ªæ–°çš„æ–¹æ¡ˆ django-channels, è¿™å¯èƒ½æ˜¯Djangoçš„æœªæ¥å“¦ï¼Œæ¯•ç«Ÿgevent ç­‰æ–¹æ¡ˆå¤ªéº»çƒ¦</li><li><a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">JSON-RPC2.0 è§„èŒƒä¸­æ–‡ç‰ˆ</a> jsonrpc å®šä¹‰éå¸¸ç®€æ´å’Œè½»é‡ï¼Œrpcç±»å‹çš„æœåŠ¡è®¾è®¡éœ€è¦è¯»ä¸€è¯»</li><li><a href="https://www.dabapps.com/blog/higher-level-query-api-django-orm/" target="_blank" rel="noopener">Building a higher-level query API: the right way to use djangoâ€™s ORM</a>  è¿™æ˜¯ä¸ªæ¯”è¾ƒæ—©çš„æ–‡ç« ï¼Œä½œè€…ç”¨ä¸€ç§hackçš„æ–¹å¼ï¼Œå¯¹djangoçš„modelè¿›è¡Œæ‹“å±•ï¼Œè‡ªå®šä¹‰Managerç­‰ï¼Œéå¸¸æœ‰å…ˆè§ã€‚ æ–‡ç« é€šè¿‡å¾ªåºæ¸è¿›çš„æ–¹å¼ï¼Œè®²è¿°äº†æ€æ ·å†™ä¸€ä¸ªå¥å£®çš„modelã€‚</li></ul><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><ul><li><a href="https://www.gitbook.com/book/gnuhpc/redis-all-about/details" target="_blank" rel="noopener">Rediså¼€å‘è¿ç»´å®æˆ˜æŒ‡å—</a></li><li><a href="http://redisbook.com/index.html" target="_blank" rel="noopener">Redis è®¾è®¡ä¸å®ç°</a></li></ul><h3 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h3><ul><li><a href="http://www.freebuf.com/tools/94777.html" target="_blank" rel="noopener">Python æ¸—é€æµ‹è¯•å·¥å…·é›†åˆ</a>  åˆ—ä¸¾äº†éå¸¸å¤šçš„pyç›¸å…³çš„æ¸—é€å·¥å…·ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥éšæ—¶æŸ¥æ‰¾</li><li><a href="http://blog.knownsec.com/wp-content/uploads/2014/07/%E7%BB%99%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E7%BB%88%E6%9E%81XSS%E9%98%B2%E6%8A%A4%E5%A4%87%E5%BF%98%E5%BD%95.pdf" target="_blank" rel="noopener">ç»™å¼€å‘è€…çš„ç»ˆæXSSé˜²æŠ¤å¤‡å¿˜å½•</a>  çŸ¥é“åˆ›å®‡ç¿»è¯‘ï¼Œwebå¼€å‘ä»ä¸šè€…éœ€è¦è®¤çœŸè¯»ä¸€è¯»ï¼Œè¯´å®è¯æœ‰ç‚¹ä¸“ä¸šï¼Œçœ‹èµ·æ¥ä¹ŸæŒºè´¹åŠŸå¤«çš„ã€‚ æœ€å¥½å»ä¹Œäº‘ä¸Šæ‰¾æ‰¾ç›¸å…³æ¼æ´çš„æŠ¥å‘Šæ¥å­¦å­¦ã€‚</li></ul><h3 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h3><ul><li><a href="http://autobahn.ws/python/" target="_blank" rel="noopener">AutoBahn-Python</a>  å®ç°äº†websocketå’ŒWAMPåè®®çš„åº”ç”¨æœåŠ¡å™¨ï¼ŒåŸºäºtwistedå’Œasyncioï¼Œç”¨æ¥å¼€å‘å®æ—¶äº¤äº’åº”ç”¨æˆ–è€…ç‰©è”ç½‘åº”ç”¨ç­‰ï¼Œæ˜¯AutoBahnçš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå…¶ä»–é¡¹ç›®åŒ…æ‹¬ä¸åŒåœºæ™¯å’Œè¯­è¨€çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œå€¼å¾—å…³æ³¨ä¸‹ã€‚æœ‰ç‚¹ç±»ä¼¼äºsocket.ioè¿™ç§ä¸œè¥¿ã€‚ Pythonä¸­websocketçš„æ–¹æ¡ˆæ˜¯éå¸¸å¤šçš„ï¼Œtornadoï¼Œgeventï¼Œasyncioç­‰ç­‰ï¼Œä¹Ÿç®—æ˜¯ç™¾å®¶é½æ”¾ï¼Œå¼€æºå‡ºæ¥çš„demoæ¯”è¾ƒå¤šï¼Œæˆç†Ÿçš„æ¡ˆä¾‹è§åˆ°çš„æ¯”è¾ƒå°‘ã€‚</li><li><a href="http://wamp-proto.org/implementations/" target="_blank" rel="noopener">WAMP</a> è¿™æ˜¯ä¸ªåŸºäºwebsocketï¼Œjsonï¼Œurlçš„åº”ç”¨å±‚åè®®ï¼Œæ”¯æŒpub/sub, rpc, æµè§ˆå™¨æ–¹å¼ï¼Œå¹¶ä¸”æœ‰è¿™ç§è¯­è¨€çš„å®ç°ã€‚ ç‰©è”ç½‘ï¼Œå®æ—¶åº”ç”¨éƒ½æœ‰ä¸€äº›æˆåŠŸçš„æ¡ˆä¾‹ã€‚æ„Ÿè§‰éå¸¸æœ‰æ„æ€ã€‚</li><li><a href="https://github.com/Suor/django-cacheops" target="_blank" rel="noopener">django-cacheops</a> ä¸»è¦ç”¨æ¥ç¼“å­˜django querysetçš„ä¸€ä¸ªæ¡†æ¶ï¼Œé’ˆå¯¹æŸ¥è¯¢ç»“æœçš„ç¼“å­˜ã€‚</li><li><a href="https://github.com/mopemope/meinheld" target="_blank" rel="noopener">meinheld</a> åŸºäºPython+Cçš„ä¸€ä¸ªé«˜æ€§èƒ½å¼‚æ­¥ WSGI webæœåŠ¡å™¨ï¼Œå¯ä»¥å’ŒGunicornç»“åˆï¼Œä½œä¸ºå®ƒçš„ä¸€ç§è‡ªå®šä¹‰workerã€‚ æ€§èƒ½éå¸¸é«˜ã€‚</li></ul><h3 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h3><h4 id="è¿‡å¹´æœˆ"><a href="#è¿‡å¹´æœˆ" class="headerlink" title="è¿‡å¹´æœˆ"></a>è¿‡å¹´æœˆ</h4><ul><li>è¿™ä¸ªæœˆèµ¶ä¸Šæ˜¥èŠ‚ï¼Œæœ‰10æ¥å¤©çš„æ—¶é—´å›å®¶è¿‡å¹´äº†ã€‚ åŸºæœ¬æ²¡æ€ä¹ˆå¼€ç”µè„‘ï¼Œä½†æ˜¯æ‰‹æœºä¹Ÿæ˜¯ç©ä¸ªä¸åœï¼Œå›åˆ°å®¶é‡Œå‘ç°å®¶é‡Œçš„é˜¿å§¨ä»¬éƒ½å¼€å§‹ç”¨åªèƒ½æ‰‹æœºäº†ï¼Œè¿˜è‡ªå·±å»ºç«‹äº†å¾®ä¿¡ç¾¤ï¼Œç©äº†å¥½å‡ å¤©çš„æŠ¢çº¢åŒ…ï¼Œæ­£å› ä¸ºæœ‰äº†è¿™ä¸ªå¾®ä¿¡ç¾¤æ•´ä¸ªæ˜¥èŠ‚è¿™äº›äº²æˆšä»¬ä¸€èµ·çš„æ´»åŠ¨æ›´å¤šäº†ï¼Œäº¤æµä¹Ÿæ¯”ä»å‰å¤šäº†ä¸å°‘ã€‚</li><li>å›åˆ°æ·®åŒ—æœ€å¤§çš„æ„Ÿè§‰å°±æ˜¯ æ—¥å­ä¸å¥½è¿‡ï¼Œç”±äºç…¤ç‚­è¡Œä¸šçš„ä½è¿·ï¼Œä¾é ç…¤ç‚­ç”Ÿæ´»çš„æ—¥å­è¶Šæ¥è¶Šä¸å¥½è¿‡äº†ï¼Œå¹´è½»äººè¶Šæ¥è¶Šå¤šçš„è¾èŒï¼Œè€å·¥äººä»¬ä¹Ÿè¿‡çš„æ¯”è¾ƒæ¸…è‹¦ã€‚</li><li>å‘ç°è®¤è¯†è‡ªå·±æ˜¯ä¸ªè‰°éš¾çš„è¿‡ç¨‹ï¼Œä¸æ˜¯è‡ªè´Ÿï¼Œå°±æ˜¯è‡ªå‘å‘€ï¼</li><li>æŠ•äº†å‡ ä»½ç®€å†éƒ½è¢«æ‹’ç»äº†ï¼Œé¢äº†å‡ ä¸ªå…¬å¸ä¹Ÿä¸å’‹åœ°ï¼Œå‘ç°åŸºç¡€è¿˜æ˜¯è–„å¼±ï¼Œ å¾ˆå¤šé—®é¢˜æ›¾ç»ç ”ç©¶è¿‡ç°åœ¨æ²¡å¤šå¤§å°è±¡äº†ï¼Œåœ¨ä¸å°±æ˜¯è®°å¾—ä¸å‡†ã€‚</li></ul><h4 id="3æœˆ"><a href="#3æœˆ" class="headerlink" title="3æœˆ"></a>3æœˆ</h4><ul><li>ä¹‹å‰çš„ç¢ç‰‡é˜…è¯»å¤ªå¤šï¼Œå…»æˆäº†å¾ˆå¤šåä¹ æƒ¯ã€‚ å›«å›µåæ£ï¼Œä¸åŠ æ€è€ƒï¼Œåªæ”¶é›†ä¸æ¶ˆåŒ–ï¼Œçœ‹çš„å¤šï¼ŒåŠ¨æ‰‹å°‘ï¼Œå…¶å®èŠ±äº†å¤§é‡çš„æ—¶é—´ï¼Œç¡®å®æ²¡æœ‰å¤šå°‘æ•ˆæœã€‚æœ€è¿‘å†çœ‹1wå°æ—¶ç†è®º è¿™æœ¬ä¹¦ï¼Œæ‰€ä»¥å‡†å¤‡æ”¹æ”¹æ€è€ƒï¼Œè°ƒæ•´ä¸‹ç”Ÿæ´»å­¦ä¹ çš„çŠ¶æ€ã€‚ ä»ç²¾æ·±ç»ƒä¹ ï¼Œä¸“å¿ƒç ”ç©¶å¼€å§‹ä¸€ç‚¹ä¸€ç‚¹çš„è®¤çŸ¥å’Œå­¦ä¹ ã€‚</li><li>å¼€å§‹å‡å°‘æ³›è¯»çš„é‡ï¼Œå¼€å§‹åšæŒæ¯å‘¨å‡ ä¸ªå°æ—¶çš„å…¶ä»–æ–¹é¢ä¹¦ç±é˜…è¯»ã€‚ å¯¹äºæŠ€æœ¯ç€æ‰‹çœ‹Gunicornçš„æºç ï¼Œå¯¹äºå…¶ä¸­çš„çŸ¥è¯†ç‚¹æ…¢æ…¢è¡¥å……ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt; 2æœˆè¿‡å¹´ï¼Œå›å®¶çš„æ—¶é—´åŸºæœ¬æ²¡æœ‰æ€ä¹ˆé˜…è¯»ï¼Œæ‰€ä»¥ä¸¤ä¸ªæœˆåˆåœ¨ä¸€èµ·å§ï¼Œé¡ºä¾¿æ”¹äº†ä¸ªæ ‡é¢˜åå­—ï¼Œå˜¿å˜¿ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;è¯»ä¹¦&quot;&gt;&lt;a href=&quot;#è¯»ä¹¦&quot; class=&quot;headerlink
      
    
    </summary>
    
      <category term="ä»–å±±ä¹‹çŸ³" scheme="http://orangleliu.info/categories/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3/"/>
    
    
      <category term="reading" scheme="http://orangleliu.info/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>python logging æ¨¡å—ä½¿ç”¨æ‚è®°</title>
    <link href="http://orangleliu.info/2016/03/14/python-logging-somenotes/"/>
    <id>http://orangleliu.info/2016/03/14/python-logging-somenotes/</id>
    <published>2016-03-14T10:25:26.000Z</published>
    <updated>2016-11-11T02:29:09.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>æ ‡å‡†åº“loggingæ¨¡å—æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å•è¿›ç¨‹åº”ç”¨ä¸­ä¸€èˆ¬çš„é—®é¢˜é›†ä¸­åœ¨å¦‚ä½•åˆ‡åˆ†ç­‰ï¼Œå¤šè¿›ç¨‹ä¸­ä½¿ç”¨loggingç›¸å¯¹æ¥è¯´å°±è¦å¤æ‚ä¸€äº›ï¼Œéœ€è¦å®šåˆ¶çš„handleræ¥è§£å†³å¤šè¿›ç¨‹å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…ä½¿ç”¨å¼€æºæ–¹æ¡ˆæ¥è§£å†³ã€‚ä¸‹é¢é›¶é›¶æ•£æ•£è®°å½•ä¸€äº›ä½¿ç”¨çš„å¿ƒå¾—ã€‚</p></blockquote><h3 id="æ—¥å¿—åˆ‡åˆ†"><a href="#æ—¥å¿—åˆ‡åˆ†" class="headerlink" title="æ—¥å¿—åˆ‡åˆ†"></a>æ—¥å¿—åˆ‡åˆ†</h3><p>loggingæ ‡å‡†åº“ä¸­æä¾›çš„æ—¥å¿—åˆ‡åˆ†çš„æ–¹å¼æœ‰</p><ul><li>RotatingFileHandler åŸºäºæ–‡ä»¶å¤§å°çš„åˆ‡åˆ†ï¼Œæ”¯æŒå¤šä¸ªbackup</li><li>TimedRotatingFileHandler åŸºäºæ—¶é—´é—´éš”çš„åˆ‡åˆ†ï¼Œæ”¯æŒå¤šç§æ—¶é—´å•ä½ï¼Œå¤šä¸ªbackupã€‚ è¿™ç§æ–¹å¼åœ¨ç¨‹åºå¯åŠ¨æ—¶ä¼šç”¨logæ–‡ä»¶æœ€åä¿®æ”¹çš„æ—¶é—´æˆ³åšstart timeè®¡ç®—ï¼Œå¦‚æœæˆ‘å®šä¹‰24å°æ—¶åˆ‡å‰²ä¸€æ¬¡ï¼Œè€Œç¨‹åºæ¯12å°æ—¶é‡å¯ä¸€æ¬¡ï¼Œé‚£ä¹ˆæ°¸è¿œéƒ½ä¸ä¼šåˆ‡å‰²æ—¥å¿—ï¼Œå› ä¸ºæ¯æ¬¡ç¨‹åºå¯åŠ¨åˆ°ç»“æŸä¸å¤Ÿ24å°æ—¶ï¼Œè¿™å°±æ˜¯å®ƒä¸å¥½çš„åœ°æ–¹ã€‚</li><li>å¾ˆå¤šæ—¶å€™éœ€è¦èƒ½æŒ‰æ•´ç‚¹æ—¶é—´è½®è¯¢çš„æ—¥å¿— ä¾‹å¦‚æ¯å¤©åªæ˜¯è¿™ä¸€å¤©24å°æ—¶çš„è®°å½•ï¼Œæ¯å°æ—¶åªæ˜¯å½“å‰è¿™ä¸ªå°æ—¶çš„è®°å½•ã€‚æ ‡å‡†åº“æ— æ³•æ»¡è¶³ï¼Œéœ€è¦è‡ªå·±å†™handlerï¼Œå½“ç„¶ç°æˆçš„è½®å­ä¹Ÿå¾ˆå¤šã€‚</li></ul><p>å½“æ—¥å¿—æ–‡ä»¶è¢«ç§»åŠ¨æˆ–åˆ é™¤å:</p><ul><li>FileHandlerä¼šç»§ç»­å°†æ—¥å¿—è¾“å‡ºè‡³åŸæœ‰çš„æ–‡ä»¶æè¿°ç¬¦, ä»è€Œå¯¼è‡´æ—¥å¿—åˆ‡åˆ†åæ—¥å¿—ä¸¢å¤±.</li><li>WatchedFileHandlerä¼šæ£€æµ‹æ–‡ä»¶æ˜¯å¦è¢«ç§»åŠ¨æˆ–åˆ é™¤, å¦‚æœæœ‰, ä¼šæ–°å»ºæ—¥å¿—æ–‡ä»¶, å¹¶è¾“å‡ºæ—¥å¿—åˆ°æ–°å»ºçš„æ–‡ä»¶. è¿™ä¸ªhanderl+corntabå¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°æ—¥å¿—çš„å‰²åˆ‡ã€‚</li></ul><h3 id="å¤šè¿›ç¨‹æ—¥å¿—"><a href="#å¤šè¿›ç¨‹æ—¥å¿—" class="headerlink" title="å¤šè¿›ç¨‹æ—¥å¿—"></a>å¤šè¿›ç¨‹æ—¥å¿—</h3><ul><li>å¤šè¿›ç¨‹å¾€ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å†™æ—¥å¿—ï¼ˆæ—¥å¿—å¯èƒ½ä¼šé”™è¡Œï¼Œå˜å¾—æ‚ä¹±æ— åº)</li><li>è¿›ç¨‹å®‰å…¨æ–¹æ¡ˆ: çœ‹åˆ°æœ‰äº›æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ–‡ä»¶é”æ¥å®ç°å®ç°åŒæ­¥ï¼Œä¹Ÿçœ‹åˆ°æœ‰äº›æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹çš„queueæ¥å®ç°åŒæ­¥ï¼Œæˆ–è€…é€šè¿‡ sockethandler ä¼ é€ç»™å•ç‹¬æœåŠ¡</li></ul><h4 id="ConcurrentLogHandler"><a href="#ConcurrentLogHandler" class="headerlink" title="ConcurrentLogHandler"></a>ConcurrentLogHandler</h4><p>çœ‹åˆ°stackoverflowä¸Šå¾ˆå¤šäººå›ç­”ç”¨ <a href="https://pypi.python.org/pypi/ConcurrentLogHandler/0.9.1" target="_blank" rel="noopener">ConcurrentLogHandler</a>æ¥è§£å†³å¤šloggingè¿›ç¨‹å®‰å…¨é—®é¢˜ï¼Œå®ƒæ˜¯RotatingFileHandlerçš„å¤šè¿›ç¨‹ç‰ˆæœ¬ï¼Œä½¿ç”¨<code>æ–‡ä»¶é”</code>æ¥ä¿æŒåŒæ­¥ã€‚</p><p>æºç <a href="http://bazaar.launchpad.net/~lowell-alleman/python-concurrent-log-handler/master/files" target="_blank" rel="noopener">åœ¨è¿™é‡Œ</a>, ç»“åˆå¤šè¿›ç¨‹Gunicorn+Djangoæ¥æµ‹äº†æµ‹ï¼Œä½¿ç”¨æ–¹æ³•<a href="https://pypi.python.org/pypi/ConcurrentLogHandler/0.9.1" target="_blank" rel="noopener">å‚è§æ–‡æ¡£</a>ï¼Œéå¸¸ç®€å•æ–¹é¢.</p><p>æˆ‘è¿™1000å¹¶å‘æµ‹è¯•çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½å½±å“ä¸å¤§ï¼ŒTPS å¤§æ¦‚ç™¾åˆ†ä¹‹åï¼ˆè¿™ä¸ªä¸»è¦å–å†³äºæ—¥å¿—çš„å¤æ‚åº¦ï¼‰æŸè€—ï¼Œæ—¥å¿—åŒæ­¥å’Œè½®è¯¢éƒ½æ²¡é—®é¢˜ã€‚ æ›´å¤§è§„æ¨¡å’Œå¤æ‚çš„æƒ…å†µè¿˜ä¸æ¸…æ¥šä¼šæ€æ ·ï¼Œåœ¨å°ç¨‹åºä¸­ä½¿ç”¨åº”è¯¥é—®é¢˜ä¸å¤§ï¼Œè¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿéœ€è¦è¿›ä¸€æ­¥æµ‹è¯•ã€‚</p><h3 id="socket-æ—¥å¿—"><a href="#socket-æ—¥å¿—" class="headerlink" title="socket æ—¥å¿—"></a>socket æ—¥å¿—</h3><p>å®˜æ–¹çš„ <a href="https://docs.python.org/2/howto/logging-cookbook.html" target="_blank" rel="noopener">loging cookbook</a> ä¸­æ¨èåœ¨å¤šè¿›ç¨‹ä¸­ä½¿ç”¨ <code>SocketHandler</code>æ¥è§£å†³æ—¥å¿—é—®é¢˜, è¿˜ç»™å‡ºæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­ <a href="https://docs.python.org/2/howto/logging-cookbook.html#sending-and-receiving-logging-events-across-a-network" target="_blank" rel="noopener">here</a>ã€‚ å¦å¤–è¿˜æœ‰å¾ˆå¤šå¼€æºçš„æ–¹æ¡ˆï¼ŒSyslogï¼ŒSentryï¼Œæˆ–è€…Githubæ‰¾äº›åˆ«äººå†™çš„æ—¥å¿—æ”¶é›†serverï¼Œè‡ªå·±æ’¸ä¸€ä¸ªè½®å­ç­‰ï¼Œé€‰æ‹©å¾ˆå¤šï¼Œé€‚åˆæ—¥å¿—é›†ä¸­æ”¶é›†ç®¡ç†ã€‚</p><h3 id="ä½¿ç”¨æ€»ç»“"><a href="#ä½¿ç”¨æ€»ç»“" class="headerlink" title="ä½¿ç”¨æ€»ç»“"></a>ä½¿ç”¨æ€»ç»“</h3><ul><li>root çº§åˆ«çš„è®¾ç½®åªåœ¨åº”ç”¨ä¸­è¿›è¡Œï¼Œä¸è¦åœ¨æ¨¡å—ä¸­è®¾ç½®</li><li>ä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰å¤šä¸ªç±»ï¼Œæ—¥å¿—æœ€å¥½æ¯ä¸ªç±»ä¸€ä¸ªloggerï¼Œå¦åˆ™åœ¨ç”Ÿäº§ä¸­å¾ˆéš¾å¿«é€Ÿå®šä½é—®é¢˜</li><li><code>self.logger = logging.getLogger(type(self).__name__)</code> è¿™ç§æ–¹å¼åœ¨base classè®¾ç½®ï¼Œè¿™æ ·æ¯ä¸ªå­ç±»éƒ½æœ‰ä¸åŒçš„loggeråç§°</li><li>è§„èŒƒformatï¼Œè¿™æ ·å®¹æ˜“å¤„ç†æ—¥å¿—</li><li>loggingå¯¹æ•´ä½“çš„æ€§èƒ½æœ‰äº›å½±å“çš„ï¼Œå¦‚æœæƒ³å‡å°‘åˆ°æ›´å°å¯ä»¥ <code>import syslog</code>ï¼Œ ä½†æ˜¯æ€ä¹ˆå›æº¯ï¼Œæ”¶é›†æ—¥å¿—ç­‰è¦å¥½å¥½ç›˜ç®—ä¸‹ï¼Œ<a href="http://www.aminus.org/blogs/index.php/2008/07/03/writing-high-efficiency-large-python-sys-1?blog=2" target="_blank" rel="noopener">use nothing but local syslog</a></li><li>éœ€è¦è®°å½•ä¸€ä¸ªå¼‚å¸¸çš„é”™è¯¯æ ˆæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ Logger.exception() æ–¹æ³•</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#logger æ˜¯å·²ç»åˆå§‹åŒ–çš„Logger</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">print</span> err</span><br><span class="line">except <span class="keyword">Exception</span> <span class="keyword">as</span> e:</span><br><span class="line">    logger.<span class="keyword">exception</span>(<span class="string">""</span>)</span><br></pre></td></tr></table></figure><h3 id="æºç é˜…è¯»"><a href="#æºç é˜…è¯»" class="headerlink" title="æºç é˜…è¯»"></a>æºç é˜…è¯»</h3><p>python2.6 çš„loggingæ¨¡å—æºç ï¼Œ<a href="https://github.com/python/cpython/tree/2.6/Lib/logging" target="_blank" rel="noopener">æºç åœ¨è¿™é‡Œ</a>ã€‚æ—¥å¿—ç›¸å…³çš„æ˜¯PEPEæ˜¯ <code>pep282</code>ã€‚</p><p>loggingæ¨¡å—ä¸€å…±æ˜¯3ä¸ªæ–‡ä»¶</p><ul><li><code>__init__.py</code>  å¸¸é‡å®šä¹‰ï¼ŒåŸºç¡€çš„APIï¼Œloggerï¼Œhandlerçš„çˆ¶ç±»ï¼Œhandlerçš„é€‚é…å™¨ç­‰ç­‰ï¼Œæœ€æ ¸å¿ƒçš„ä»£ç </li><li><code>config.py</code>  é…ç½®è¯»å–ç›¸å…³æ¨¡å—</li><li><code>handlers.py</code>  ä¸åŒçš„handlersæ¥å¤„ç†æ—¥å¿—çš„è¾“å‡ºç­–ç•¥ï¼Œå¦‚æœè‡ªå·±å†™handler è¿™é‡Œæ˜¯æœ€å¥½çš„ä¾‹å­</li></ul><h4 id="é€šè¿‡ä»£ç æ¥çœ‹çœ‹ä½¿ç”¨-basicConfig-å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"><a href="#é€šè¿‡ä»£ç æ¥çœ‹çœ‹ä½¿ç”¨-basicConfig-å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é€šè¿‡ä»£ç æ¥çœ‹çœ‹ä½¿ç”¨ basicConfig å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"></a>é€šè¿‡ä»£ç æ¥çœ‹çœ‹ä½¿ç”¨ basicConfig å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h4><p>ä½ å¯ä»¥çœ‹è¿™ä¸ªæ–‡ç« <a href="http://atlee.ca/blog/posts/diving-into-python-logging.html" target="_blank" rel="noopener">dive into logging</a>, å…¶å®çœ‹ä¸‹ä»£ç å°±èƒ½æ˜ç™½ã€‚</p><p>åœ¨ <code>import logging</code> çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª root logger, nameå°±æ˜¯rootï¼Œé»˜è®¤çº§åˆ«æ˜¯ warning</p><p>æºç é‡Œæ˜¯è¿™æ ·çš„</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root = RootLogger(WARNING)</span><br><span class="line">Logger<span class="selector-class">.root</span> = root</span><br><span class="line">Logger<span class="selector-class">.manager</span> = Manager(Logger.root)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé»˜è®¤çš„loggerä¹ŸbasicConfigéœ€è¦æ‰èƒ½ä½¿ç”¨ï¼ŒbasicConfigå…¶å®å°±æ˜¯è®¾ç½®root loggerçš„handlerã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: logger = logging.getLo</span><br><span class="line">logging.getLogger       logging.getLoggerClass</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: logger = logging.getLogger(<span class="string">'lzz'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: logger.info(<span class="string">'lzz'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: logger.root.info(<span class="string">"lzz"</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: logging.root.info(<span class="string">"hello"</span>)</span><br><span class="line">INFO:root:hello</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: logger.info(<span class="string">'lzz'</span>)</span><br><span class="line">INFO:lzz:lzz</span><br></pre></td></tr></table></figure><h4 id="é˜…è¯»æ€»ç»“"><a href="#é˜…è¯»æ€»ç»“" class="headerlink" title="é˜…è¯»æ€»ç»“"></a>é˜…è¯»æ€»ç»“</h4><ul><li>Logger ä¹‹é—´æ˜¯ä¸€ä¸ªæ ‘å‹ç»“æ„ï¼Œroot Loggeræ˜¯æ ¹èŠ‚ç‚¹ï¼Œçˆ¶å­å…³ç³»ç­‰ç”±Managerç±»å¤„ç†</li><li>ä¸€èˆ¬æ˜¯è·å–ä¸€ä¸ªLoggerå®ä¾‹ï¼Œè®¾ç½®logçº§åˆ«ï¼Œæ·»åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ªHandlerï¼Œä¸€ä¸ªæˆ–è€…å¤šä¸ªFilterï¼ŒHandlerä¸­è®¾ç½®formatæ—¥å¿—æ ¼å¼ã€‚</li><li>æ‰§è¡Œä¸€ä¸ªloggeræ–¹æ³•çš„è¿‡ç¨‹ï¼š ä¾‹å¦‚<code>logger.info(&quot;hi boy&quot;)</code>,  é¦–å…ˆloggeræ£€æŸ¥levelæ˜¯å¦ç¬¦åˆï¼Œå¦‚æœlevelæ­£ç¡®ï¼Œè°ƒç”¨ <code>Logger._log()</code>æ–¹æ³•ï¼Œæ ¹æ®logå†…å®¹ç»„æˆ <code>LogRecord</code>, è°ƒç”¨<code>Logger.handle(self, record)</code>æ–¹æ³•ã€‚</li></ul><p><code>Logger.handler()</code> æ£€æŸ¥loggeræ˜¯å¦disableï¼Œå¦‚æœå¯ç”¨, å†è°ƒç”¨ <code>Logger.filter(record)</code>, æ ¹æ®è®¾ç½®çš„è¿‡æ»¤å™¨æ¥è¿‡æ»¤æ—¥å¿—ã€‚ å¦‚æœrecordæ²¡æœ‰è¿‡æ»¤æ‰ï¼Œé‚£ä¹ˆç»§ç»­è°ƒç”¨ <code>Logger.callHandler(self, record)</code>, æ ¹æ®é…ç½®çš„handlersäº¤ç»™handlersæ¥å¤„ç†æ—¥å¿—ã€‚è¯´äº†ä¸€é€šï¼Œä¸å¦‚ç›´æ¥çœ‹<a href="https://docs.python.org/2/howto/logging.html#logging-flow" target="_blank" rel="noopener">å®˜æ–¹çš„æµç¨‹å›¾</a></p><p><img src="/img/logging_flow.png" alt="å®˜æ–¹çš„æµç¨‹å›¾"></p><ul><li>Filter æ¯”è®¾ç½®æ—¥å¿—levelæœ‰æ›´å¤§çš„çµæ´»æ€§, Loggerå’ŒHandlerséƒ½å¯ä»¥è®¾ç½®Filter, ä¾‹å¦‚å†™ä¸€ä¸ªè¿‡æ»¤ helloå…³é”®å­—çš„Filterã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloFilter</span><span class="params">(logging.Filter)</span>:</span></span><br><span class="line">    <span class="comment">#overwrite filter method, æœ€å¥½å…ˆçœ‹çœ‹LogRecordè¿™ä¸ªç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> record.msg.find(<span class="string">'hello'</span>) &gt; <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">logger.addFilter(HelloFilter())</span><br><span class="line">logger.info(<span class="string">"hello"</span>)</span><br><span class="line">logger.info(<span class="string">"hello boy"</span>)</span><br><span class="line">logger.info(<span class="string">"hi girl"</span>)</span><br></pre></td></tr></table></figure><ul><li>ç®€å•çš„ç±»å…³ç³»å¦‚ä¸‹å›¾</li></ul><p><img src="/img/logging_class.png" alt="class_pic"></p><h3 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h3><ul><li><a href="https://docs.python.org/2/library/logging.html#module-logging" target="_blank" rel="noopener">logging api</a> æŸ¥è¯¢æ‰‹å†Œ</li><li><a href="https://docs.python.org/2/howto/logging.html" target="_blank" rel="noopener">logging howto</a> å®˜æ–¹æ•™ç¨‹ï¼ŒåŸºç¡€çŸ¥è¯†ï¼Œå…¨é¢å®ç”¨</li><li><a href="https://docs.python.org/2/howto/logging-cookbook.html" target="_blank" rel="noopener">logging cookbook</a>  è¿›é˜¶å¿…è¯»ï¼Œè¦†ç›–å¸¸ç”¨æƒ…æ™¯</li><li><a href="http://www.blog.pythonlibrary.org/2014/02/11/python-how-to-create-rotating-logs/" target="_blank" rel="noopener">python-how-to-create-rotating-logs</a>  ç®€å•æ˜äº†è¯´æ˜äº† ä¸¤ä¸ªå¸¸ç”¨çš„æ—¥å¿—è½®è¯¢handleræ€ä¹ˆä½¿ç”¨</li><li><a href="http://www.shutupandship.com/2012/02/how-python-logging-module-works.html" target="_blank" rel="noopener">how-python-logging-module-works</a> æºç ç¬”è®°ï¼Œçœ‹æ‡‚loggingæ€æ ·å·¥ä½œ</li><li><a href="https://www.python.org/dev/peps/pep-0282/" target="_blank" rel="noopener">pep282</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;æ ‡å‡†åº“loggingæ¨¡å—æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å•è¿›ç¨‹åº”ç”¨ä¸­ä¸€èˆ¬çš„é—®é¢˜é›†ä¸­åœ¨å¦‚ä½•åˆ‡åˆ†ç­‰ï¼Œå¤šè¿›ç¨‹ä¸­ä½¿ç”¨loggingç›¸å¯¹æ¥è¯´å°±è¦å¤æ‚ä¸€äº›ï¼Œéœ€è¦å®šåˆ¶çš„handleræ¥è§£å†³å¤šè¿›ç¨‹å®‰å…¨é—®é¢˜ï¼Œæˆ–è€…ä½¿ç”¨å¼€æºæ–¹æ¡ˆæ¥è§£å†³ã€‚ä¸‹é¢é›¶é›¶æ•£æ•£è®°
      
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="http://orangleliu.info/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="logging" scheme="http://orangleliu.info/tags/logging/"/>
    
  </entry>
  
  <entry>
    <title>Pythonä¸­preforkæ¨¡å¼çš„ç®€å•å®ç°</title>
    <link href="http://orangleliu.info/2016/03/06/python-pre-fork-mode-use/"/>
    <id>http://orangleliu.info/2016/03/06/python-pre-fork-mode-use/</id>
    <published>2016-03-06T01:54:59.000Z</published>
    <updated>2016-03-11T03:48:35.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="prefork-æ¨¡å¼æ˜¯å•¥ï¼Ÿ"><a href="#prefork-æ¨¡å¼æ˜¯å•¥ï¼Ÿ" class="headerlink" title="prefork æ¨¡å¼æ˜¯å•¥ï¼Ÿ"></a>prefork æ¨¡å¼æ˜¯å•¥ï¼Ÿ</h3><p>è¿™ç§æ¨¡å¼æœ€æ—©çœ‹åˆ°æ˜¯åœ¨Apacheçš„ä»‹ç»ä¸­ï¼Œæ‰€ä»¥ä¸€èˆ¬çœ‹åˆ°è¿™ä¸ªè¯å°±ä¼šæƒ³åˆ°Apache(ç°åœ¨ä¹Ÿæ”¯æŒå…¶ä»–æ¨¡å¼ workerï¼Œeventç­‰)ï¼ŒwebæœåŠ¡å™¨ç”¨çš„æ¯”è¾ƒå¤šnginxï¼Œgunicornï¼Œunicornç­‰ã€‚ è¿™ä¸ªæ¨¡å¼ä¸­æœ‰Masterå’ŒWorkerä¸¤ç§è§’è‰²çš„è¿›ç¨‹ï¼ŒMasterè¿›ç¨‹forkå‡ºWorkeræ¥å¤„ç†ä»»åŠ¡ï¼ˆä¾‹å¦‚httpè¯·æ±‚ï¼‰ã€‚ Masterè¿›ç¨‹çš„ä½œç”¨æ˜¯ç®¡ç†Workerè¿›ç¨‹ï¼ŒåŒ…æ‹¬forkå‡ºworkerè¿›ç¨‹ï¼Œæ¥å—å¤–éƒ¨ä¿¡å·å¯¹workerç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ§åˆ¶ï¼Œå¯¹workerè¿›ç¨‹è¿›è¡Œå¥åº·æ£€æŸ¥ç­‰ç­‰ï¼ŒWorkerè¿›ç¨‹çš„ä½œç”¨å°±æ˜¯å¤„ç†ä»»åŠ¡(å¹²æ´»)ã€‚</p><h3 id="è¿™ç§æ¨¡å¼çš„å¥½å¤„ï¼Ÿ"><a href="#è¿™ç§æ¨¡å¼çš„å¥½å¤„ï¼Ÿ" class="headerlink" title="è¿™ç§æ¨¡å¼çš„å¥½å¤„ï¼Ÿ"></a>è¿™ç§æ¨¡å¼çš„å¥½å¤„ï¼Ÿ</h3><ul><li>å……åˆ†åˆ©ç”¨å¤šä¸ªCPUï¼Œç‰¹åˆ«æ˜¯åœ¨pythonè¿™ç§è¯­è¨€ä¸­ï¼Œä¸å—GILçš„å½±å“</li><li>ä¸€ä¸ªè¿›ç¨‹å‡ºç°é—®é¢˜ï¼Œå…¶ä»–è¿›ç¨‹ä»ç„¶å¯ä»¥æ­£å¸¸æœåŠ¡ï¼Œä¸ä¼šæ•´ä¸ªserveræŒ‚æ‰</li></ul><p>ç›—äº†ä¸€å¼ å›¾æ¥æ˜¯ <a href="http://xiaorui.cc" target="_blank" rel="noopener">xiaorui.cc</a>ï¼ŒGunicorn preforkæµç¨‹ã€‚</p><p><img src="/img/preforkxxx.png" alt="Gunicorn prefork"></p><h3 id="python-ä¸­æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#python-ä¸­æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="python ä¸­æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>python ä¸­æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>ç”¨çš„çŸ¥è¯†ï¼Œå’Œç®€å•çš„æ€è·¯ã€‚</p><p>ä¸‹é¢æ˜¯é˜…è¯»Gunicornæºç ä¹‹åï¼Œå®ç°çš„ä¸€ä¸ªç®€å•çš„preforkç¨‹åºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#master-slaves.py  python2.7.x</span></span><br><span class="line"><span class="comment">#orangleliu@gmail.com</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ç®€å•çš„æ¨¡æ‹Ÿpre-forkæ¨¡å¼ï¼Œmasterè¿›ç¨‹æ§åˆ¶å¤šä¸ªå­è¿›ç¨‹</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿™é‡Œå®ç°è¿™ä¹ˆå‡ ä¸ªä¿¡å·</span></span><br><span class="line"><span class="string">INT ctrl+c é€€å‡º</span></span><br><span class="line"><span class="string">TTIN å¢åŠ ä¸€ä¸ªworker</span></span><br><span class="line"><span class="string">TTOU å‡å°‘ä¸€ä¸ªworker</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å­è¿›ç¨‹è¦å®ç°ä¸€äº›ç‰¹å®šçš„ä¿¡å·æ¥å“åº”å¤–ç•Œå’Œçˆ¶è¿›ç¨‹çš„æ“ä½œ</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Master</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    WORKERS = &#123;&#125;</span><br><span class="line">    SIG_QUEUE = []</span><br><span class="line">    SIGNALS = [getattr(signal, <span class="string">"SIG%s"</span> % x)</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">"INT TTIN TTOU"</span>.split()]</span><br><span class="line">    SIG_NAMES = dict(</span><br><span class="line">        (getattr(signal, name), name[<span class="number">3</span>:].lower()) <span class="keyword">for</span> name <span class="keyword">in</span> dir(signal)</span><br><span class="line">        <span class="keyword">if</span> name[:<span class="number">3</span>] == <span class="string">"SIG"</span> <span class="keyword">and</span> name[<span class="number">3</span>] != <span class="string">"_"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, worker_nums=<span class="number">2</span>)</span>:</span></span><br><span class="line">        self.worker_nums = worker_nums</span><br><span class="line">        self.master_name = <span class="string">"Master"</span></span><br><span class="line">        self.reexec_pid = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"start master"</span></span><br><span class="line"></span><br><span class="line">        self.pid = os.getpid()</span><br><span class="line">        self.init_signals()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_signals</span><span class="params">(self)</span>:</span></span><br><span class="line">        [signal.signal(s, self.signal) <span class="keyword">for</span> s <span class="keyword">in</span> self.SIGNALS]</span><br><span class="line">        signal.signal(signal.SIGCHLD, self.handle_chld)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">signal</span><span class="params">(self, sig, frame)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ™®é€šçš„ä¿¡å·å‘ç”Ÿçš„æ—¶å€™ï¼Œå¾€ä¿¡å·é˜Ÿåˆ—å¢åŠ ä¸€ä¸ªä¿¡å·</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">if</span> len(self.SIG_QUEUE) &lt; <span class="number">5</span>:</span><br><span class="line">            self.SIG_QUEUE.append(sig)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.manage_workers()</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœä¸å¢åŠ sleep æ•´ä¸ªmasterè¿›ç¨‹å°±ä¼šè¿›å…¥å‡ ä¹100 cpuçš„çŠ¶æ€</span></span><br><span class="line">                <span class="comment"># ä½¿ç”¨sleepçš„å¥½å¤„å°±æ˜¯masterçš„cpuæ¶ˆè€—å°å¾ˆå¤šï¼Œå¯¹äºæ¥è‡ªç³»ç»Ÿçš„ç»™masterçš„ä¿¡å·å¯ä»¥å³ä½¿åé¦ˆ</span></span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                sig = self.SIG_QUEUE.pop(<span class="number">0</span>) <span class="keyword">if</span> len(self.SIG_QUEUE) <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line">                <span class="keyword">if</span> sig <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                    self.manage_workers()</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> sig <span class="keyword">not</span> <span class="keyword">in</span> self.SIG_NAMES:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">"unknow signals:%s"</span>%sig</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                signame = self.SIG_NAMES.get(sig)</span><br><span class="line">                handler = getattr(self, <span class="string">"handle_%s"</span>%signame, <span class="keyword">None</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> handler:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">"Unhandler signal: %s"</span>%signame</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                handler()</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            self.halt()</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            self.halt()</span><br><span class="line">        <span class="keyword">except</span> SystemExit:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">print</span> e</span><br><span class="line">            self.stop()</span><br><span class="line">            sys.exit(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_chld</span><span class="params">(self, sig, frame)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        å¯¹äºå­è¿›ç¨‹é€€å‡ºSIGCHLDä¿¡å·å¤„ç†ï¼Œé˜²æ­¢äº§ç”Ÿå¤§é‡åƒµå°¸è¿›ç¨‹</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.reap_workers()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_int</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        ctrl+c å…³é—­masterè¿›ç¨‹ï¼Œå…ˆå…³é—­å­è¿›ç¨‹ï¼Œç„¶åæŠ›å‡ºå¼‚å¸¸ï¼Œè‡ªå·±é€€å‡º</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.stop()</span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_ttin</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        å¢åŠ ä¸€ä¸ªå­è¿›ç¨‹</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"add a worker"</span></span><br><span class="line">        self.worker_nums += <span class="number">1</span></span><br><span class="line">        self.manage_workers()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_ttou</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        å‡å°‘ä¸€ä¸ªå­è¿›ç¨‹</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"deincrease a worker"</span></span><br><span class="line">        <span class="keyword">if</span> self.worker_nums &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.worker_nums -= <span class="number">1</span></span><br><span class="line">        self.manage_workers()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åœæ­¢å­è¿›ç¨‹ è¿™é‡Œéƒ½å½“åšSIGTERMæ¥å¤„ç†</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'stop workers'</span></span><br><span class="line">        sig = signal.SIGTERM</span><br><span class="line">        self.kill_workers(sig)</span><br><span class="line">        self.kill_workers(signal.SIGKILL)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">halt</span><span class="params">(self, exit_status=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        master è¿›ç¨‹è‡ªæ€</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"master exit"</span></span><br><span class="line">        self.stop()</span><br><span class="line">        sys.exit(exit_status)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reap_workers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è¿™é‡Œçš„æ£€æµ‹ä¹Ÿæ˜¯ä¸ºäº†é¿å…åƒµå°¸è¿›ç¨‹ï¼Œå¦åˆ™å¤§é‡èµ„æºæ— æ³•é‡Šæ”¾</span></span><br><span class="line"><span class="string">        å‚è€ƒï¼šhttp://www.cnblogs.com/mickole/p/3187770.html</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">                <span class="comment">#os.waitpid æ”¶é›†åƒµå°¸å­è¿›ç¨‹çš„ä¿¡æ¯,å¹¶æŠŠå®ƒå½»åº•é”€æ¯åè¿”å›</span></span><br><span class="line">                <span class="comment">#è¿™é‡Œçš„ -1 ä»£è¡¨æ‰€æœ‰å­è¿›ç¨‹</span></span><br><span class="line">                <span class="comment">#os.WNOHANG å¦‚æœæ²¡æœ‰å­è¿›ç¨‹ä¿¡æ¯å°±ç«‹åˆ»è¿”å›</span></span><br><span class="line">                wpid, status = os.waitpid(<span class="number">-1</span>, os.WNOHANG)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> wpid:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    exitcode = status &gt;&gt; <span class="number">8</span></span><br><span class="line">                    worker = self.WORKERS.pop(wpid, <span class="keyword">None</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> worker:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment">#errno.ECHILD æ˜¯æ²¡æœ‰å­è¿›ç¨‹é”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> e.error != errno.ECHILD:</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">manage_workers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        workers çš„å¥åº·æ£€æŸ¥ï¼Œæ•°é‡æ˜¯å¦å¯¹é½ç­‰</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">if</span> len(self.WORKERS.keys()) &lt; self.worker_nums:</span><br><span class="line">            self.spawn_workers()</span><br><span class="line"></span><br><span class="line">        workers = self.WORKERS.items()</span><br><span class="line">        <span class="keyword">while</span> len(workers) &gt; self.worker_nums:</span><br><span class="line">            (pid, _) = workers.pop(<span class="number">0</span>)</span><br><span class="line">            self.kill_worker(pid, signal.SIGTERM)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spawn_worker</span><span class="params">(self)</span>:</span></span><br><span class="line">        worker = Worker()</span><br><span class="line">        pid = os.fork()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#masterè¿›ç¨‹å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> pid != <span class="number">0</span>:</span><br><span class="line">            self.WORKERS[pid] = worker</span><br><span class="line">            <span class="keyword">return</span> pid</span><br><span class="line"></span><br><span class="line">        <span class="comment">#workerè¿›ç¨‹å¤„ç†</span></span><br><span class="line">        worker_pid = os.getpid()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            worker.run()</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">except</span> SystemExit:</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"work error %s"</span>%str(e)</span><br><span class="line">            sys.exit(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spawn_workers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.worker_nums - len(self.WORKERS.keys())):</span><br><span class="line">            self.spawn_worker()</span><br><span class="line">            <span class="comment">#ä¸ºä»€ä¹ˆè¦é‚£ä¹ˆç«¯æ—¶é—´çš„ä¼‘çœ </span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>*random.random())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kill_workers</span><span class="params">(self, sig)</span>:</span></span><br><span class="line">        worker_pids = list(self.WORKERS.keys())</span><br><span class="line">        <span class="keyword">for</span> pid <span class="keyword">in</span> worker_pids:</span><br><span class="line">            self.kill_worker(pid, sig)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kill_worker</span><span class="params">(self, pid, sig)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.kill(pid, sig)</span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"kill worker error: %s"</span>%str(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    Master().run()</span><br></pre></td></tr></table></figure><h3 id="æœ‰ç”¨é˜…è¯»"><a href="#æœ‰ç”¨é˜…è¯»" class="headerlink" title="æœ‰ç”¨é˜…è¯»"></a>æœ‰ç”¨é˜…è¯»</h3><ul><li><a href="http://xiaorui.cc/2015/07/13/python%E4%BD%BF%E7%94%A8master-worker%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E7%AB%AF/" target="_blank" rel="noopener">pythonä½¿ç”¨master workerç®¡ç†æ¨¡å‹å¼€å‘æœåŠ¡ç«¯</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;prefork-æ¨¡å¼æ˜¯å•¥ï¼Ÿ&quot;&gt;&lt;a href=&quot;#prefork-æ¨¡å¼æ˜¯å•¥ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;prefork æ¨¡å¼æ˜¯å•¥ï¼Ÿ&quot;&gt;&lt;/a&gt;prefork æ¨¡å¼æ˜¯å•¥ï¼Ÿ&lt;/h3&gt;&lt;p&gt;è¿™ç§æ¨¡å¼æœ€æ—©çœ‹åˆ°
      
    
    </summary>
    
      <category term="python" scheme="http://orangleliu.info/categories/python/"/>
    
    
      <category term="perfork" scheme="http://orangleliu.info/tags/perfork/"/>
    
  </entry>
  
  <entry>
    <title>Pythonè¿›ç¨‹é—´å¼‚æ­¥é€šä¿¡ä¹‹signalæ¨¡å—</title>
    <link href="http://orangleliu.info/2016/03/06/python-signal-module-simple-use/"/>
    <id>http://orangleliu.info/2016/03/06/python-signal-module-simple-use/</id>
    <published>2016-03-06T01:54:21.000Z</published>
    <updated>2016-03-08T14:15:45.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><blockquote><p>ä¿¡å·æ˜¯Unixç³»ç»Ÿä¸­å¸¸è§çš„ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼ˆIPCï¼‰ï¼Œä¾‹å¦‚æˆ‘ä»¬ç»å¸¸æ“ä½œçš„ <code>kill -9 pid</code> è¿™é‡Œçš„ <code>-9</code>å¯¹åº”çš„å°±æ˜¯ SIGKILL ä¿¡å·, 9å°±æ˜¯è¿™ä¸ªä¿¡å·çš„ç¼–å·ï¼ŒSIGKILLæ˜¯å®ƒçš„åç§°ã€‚ ç”±äºä¸åŒç‰ˆæœ¬çš„ *nux çš„å®ç°ä¼šæœ‰å·®å¼‚ï¼Œå…·ä½“è¯·å‚ç…§ç³»ç»ŸAPIï¼Œæˆ‘è¿™é‡Œæ˜¯OSXï¼Œå¯ä»¥ä½¿ç”¨ <code>man signal</code>æŸ¥çœ‹æ‰€æœ‰ä¿¡å·çš„å®šä¹‰ã€‚è¿™é‡Œ<strong>ç®€å•çš„å­¦ä¹ </strong>ä¸‹Pythonæ ‡å‡†åº“ä¸­ä¿¡å·å¤„ç†çš„æ¨¡å— signalæ¨¡å—.</p></blockquote><h3 id="ä¿¡å·æ˜¯å•¥ï¼Ÿ"><a href="#ä¿¡å·æ˜¯å•¥ï¼Ÿ" class="headerlink" title="ä¿¡å·æ˜¯å•¥ï¼Ÿ"></a>ä¿¡å·æ˜¯å•¥ï¼Ÿ</h3><p>ç”±äºsignalæ˜¯ç³»ç»Ÿç¼–ç¨‹çš„æ¥å£ï¼Œé‚£ä¹ˆå’±ä»¬æ¥çœ‹çœ‹ä»–çš„æ¦‚å¿µã€‚</p><blockquote><p>ä¿¡å·(signal)æ˜¯Linuxè¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ï¼Œå…¨ç§°ä¸ºè½¯ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿè¢«ç§°ä¸ºè½¯ä¸­æ–­ã€‚ä¿¡å·æœ¬è´¨ä¸Šæ˜¯åœ¨è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ç¡¬ä»¶ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿã€‚</p></blockquote><p>å†æ¥çœ‹çœ‹å¸¸ç”¨çš„åœºæ™¯</p><blockquote><p>ä¸å…¶ä»–è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼ˆä¾‹å¦‚ç®¡é“ã€å…±äº«å†…å­˜ç­‰ï¼‰ç›¸æ¯”ï¼Œä¿¡å·æ‰€èƒ½ä¼ é€’çš„ä¿¡æ¯æ¯”è¾ƒç²—ç³™ï¼Œåªæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚ä½†æ­£æ˜¯ç”±äºä¼ é€’çš„ä¿¡æ¯é‡å°‘ï¼Œä¿¡å·ä¹Ÿä¾¿äºç®¡ç†å’Œä½¿ç”¨ï¼Œå¯ä»¥ç”¨äºç³»ç»Ÿç®¡ç†ç›¸å…³çš„ä»»åŠ¡ï¼Œä¾‹å¦‚é€šçŸ¥è¿›ç¨‹ç»ˆç»“ã€ä¸­æ­¢æˆ–è€…æ¢å¤ç­‰ã€‚æ¯ç§ä¿¡å·ç”¨ä¸€ä¸ªæ•´å‹å¸¸é‡å®è¡¨ç¤ºï¼Œä»¥SIGå¼€å¤´ï¼Œæ¯”å¦‚SIGCHLDã€SIGINTç­‰ï¼Œå®ƒä»¬åœ¨ç³»ç»Ÿå¤´æ–‡ä»¶&lt;signal.h&gt;ä¸­å®šä¹‰ã€‚</p></blockquote><p>æ›´å…·ä½“çš„ä»‹ç»å’Œè¯¦ç»†çš„æœºåˆ¶åŸç†ï¼Œè¯·å‚è€ƒ ã€ŠUnixç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ç­‰ä¹¦ç±ã€‚</p><p>è‡ªå·±çš„ç†è§£å°±æ˜¯ï¼šå¯ä»¥ç»™ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å‘é€ä¸åŒçš„ä¿¡å·ï¼Œç„¶åè¿›ç¨‹å°±èƒ½ç«‹å³æ”¶åˆ°è¿™ä¸ªé€šçŸ¥ï¼Œå¹¶ä¸”åšå‡ºå“åº”çš„è¡Œä¸ºã€‚</p><p>å¸¸ç”¨çš„å‡ ä¸ªä¿¡å·</p><table><thead><tr><th>ç¼–å·</th><th>åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>1</td><td>SIGHUP</td><td>ç»ˆç«¯æŒ‚èµ·æˆ–è€…ç»ˆæ­¢è¿›ç¨‹ã€‚é»˜è®¤åŠ¨ä½œä¸ºç»ˆæ­¢è¿›ç¨‹</td></tr><tr><td>2</td><td>SIGINT</td><td>é”®ç›˜ä¸­æ–­ <code>&lt;ctrl+c&gt;</code> ç»å¸¸ä¼šç”¨åˆ°ã€‚é»˜è®¤åŠ¨ä½œä¸ºç»ˆæ­¢è¿›ç¨‹</td></tr><tr><td>3</td><td>SIGQUIT</td><td>é”®ç›˜é€€å‡ºé”®è¢«æŒ‰ä¸‹ã€‚ä¸€èˆ¬ç”¨æ¥å“åº” <code>&lt;ctrl+d&gt;</code>ã€‚ é»˜è®¤åŠ¨ä½œç»ˆæ­¢è¿›ç¨‹</td></tr><tr><td>9</td><td>SIGKILL</td><td>å¼ºåˆ¶é€€å‡ºã€‚ shellä¸­ç»å¸¸ä½¿ç”¨</td></tr><tr><td>14</td><td>SIGALRM</td><td>å®šæ—¶å™¨è¶…æ—¶ï¼Œé»˜è®¤ä¸ºç»ˆæ­¢è¿›ç¨‹</td></tr><tr><td>15</td><td>SIGTERM</td><td>ç¨‹åºç»“æŸä¿¡å·ï¼Œç¨‹åºä¸€èˆ¬ä¼šæ¸…ç†å®ŒçŠ¶æ€åœ¨é€€å‡ºï¼Œæˆ‘ä»¬ä¸€èˆ¬è¯´çš„ä¼˜é›…çš„é€€å‡º</td></tr></tbody></table><h3 id="signalæ¨¡å—"><a href="#signalæ¨¡å—" class="headerlink" title="signalæ¨¡å—"></a>signalæ¨¡å—</h3><p>åœ¨<a href="https://docs.python.org/2/library/signal.html" target="_blank" rel="noopener">æ–‡æ¡£</a>çš„å¼€å¤´ï¼Œè®²è¿°äº†Python signalå¯¹äºç³»ç»Ÿçš„å°è£…å’Œä¸€äº›ä½¿ç”¨å¸¸è¯†, ä½¿ç”¨ä¹‹å‰åº”å½“è®¤çœŸé˜…è¯»ä¸€ä¸‹ã€‚</p><h4 id="å¸¸ç”¨çš„API"><a href="#å¸¸ç”¨çš„API" class="headerlink" title="å¸¸ç”¨çš„API"></a>å¸¸ç”¨çš„API</h4><ul><li><code>signal.signal(signalnum, handler)</code> é’ˆå¯¹ä¸åŒçš„ä¿¡å·éœ€è¦å®šä¹‰å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œå½“è¿è¡Œä¸­çš„ç¨‹åºæ¥å—åˆ°å¯¹åº”çš„ä¿¡å·æ—¶å€™ï¼Œä¼šè°ƒç”¨å¯¹åº”çš„handlerã€‚ handlerå‡½æ•°åº”å½“æœ‰2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ signalnum, å¦ä¸€æ˜¯ <code>stack frame</code>(None æˆ–è€…æ˜¯ <a href="https://docs.python.org/2/reference/datamodel.html#frame-objects" target="_blank" rel="noopener">frameå¯¹è±¡</a>)</li></ul><p>ä¾‹å¦‚å†™ä¸€ä¸ªå°ç¨‹åºï¼Œæ¥å¤„ç† <code>ctrl+c</code>äº‹ä»¶å’Œ <code>SIGHUP</code>ï¼Œä¹Ÿå°±æ˜¯1å’Œ2ä¿¡å·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#orangleliu py2.7</span></span><br><span class="line"><span class="comment">#recv_signal.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_int</span><span class="params">(sig, frame)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"get signal: %s, I will quit"</span>%sig</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_hup</span><span class="params">(sig, frame)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"get signal: %s"</span>%sig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    signal.signal(<span class="number">2</span>, handle_int)</span><br><span class="line">    signal.signal(<span class="number">1</span>, handle_hup)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"My pid is %s"</span>%os.getpid()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼Œé¦–å…ˆå¯åŠ¨ç¨‹åºï¼ˆæ ¹æ®æ‰“å°çš„pidï¼‰ï¼Œåœ¨å¦å¤–çš„çª—å£è¾“å…¥ <code>kill -1 21838</code> å’Œ <code>kill -HUP 21838</code>, æœ€åä½¿ç”¨ <code>ctrl+c</code>å…³é—­ç¨‹åºã€‚ ç¨‹åºçš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">python</span> recv_signal.<span class="keyword">py</span></span><br><span class="line">My pid <span class="keyword">is</span> <span class="number">21838</span></span><br><span class="line"><span class="built_in">get</span> signa<span class="variable">l:</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">get</span> signa<span class="variable">l:</span> <span class="number">1</span></span><br><span class="line">^Cget signa<span class="variable">l:</span> <span class="number">2</span>, I will <span class="keyword">quit</span></span><br></pre></td></tr></table></figure><ul><li><code>signal.getsignal(signalnum)</code> æ ¹æ®signalnumè¿”å›ä¿¡å·å¯¹åº”çš„handlerï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¯ä»¥è°ƒç”¨çš„Pythonå¯¹è±¡ï¼Œæˆ–è€…æ˜¯ <code>signal.SIG_IGN</code>ï¼ˆè¡¨ç¤ºè¢«å¿½ç•¥ï¼‰, <code>signal.SIG_DFL</code>ï¼ˆé»˜è®¤è¡Œä¸ºå·²ç»è¢«ä½¿ç”¨ï¼‰ æˆ– <code>None</code>ï¼ˆPythonçš„handlerè¿˜æ²¡è¢«å®šä¹‰ï¼‰ã€‚</li></ul><p>è·å–signalä¸­å®šä¹‰çš„ä¿¡å·numå’Œåç§°ï¼Œè¿˜æœ‰å®ƒçš„handleræ˜¯ä»€ä¹ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#orangleliu py2.7</span></span><br><span class="line"><span class="comment">#getsignal_handler.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_hup</span><span class="params">(sig, frame)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"get signal: %s"</span>%sig</span><br><span class="line"></span><br><span class="line">signal.signal(<span class="number">1</span>, handle_hup)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    ign = signal.SIG_IGN</span><br><span class="line">    dfl = signal.SIG_DFL</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"SIG_IGN"</span>, ign</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"SIG_DFL"</span>, dfl</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"*"</span>*<span class="number">40</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> dir(signal):</span><br><span class="line">        <span class="keyword">if</span> name[:<span class="number">3</span>] == <span class="string">"SIG"</span> <span class="keyword">and</span> name[<span class="number">3</span>] != <span class="string">"_"</span>:</span><br><span class="line">            signum = getattr(signal, name)</span><br><span class="line">            gsig = signal.getsignal(signum)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">print</span> name, signum, gsig</span><br></pre></td></tr></table></figure><p>è¿è¡Œçš„ç»“æœï¼šå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†ä¿¡å·éƒ½æ˜¯éƒ½æœ‰é»˜è®¤çš„è¡Œä¸ºã€‚</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">SIG_IGN <span class="number">1</span></span><br><span class="line">SIG_DFL <span class="number">0</span></span><br><span class="line">****************************************</span><br><span class="line">SIGABRT <span class="number">6</span> <span class="number">0</span></span><br><span class="line">SIGALRM <span class="number">14</span> <span class="number">0</span></span><br><span class="line">SIGBUS <span class="number">10</span> <span class="number">0</span></span><br><span class="line">SIGCHLD <span class="number">20</span> <span class="number">0</span></span><br><span class="line">SIGCONT <span class="number">19</span> <span class="number">0</span></span><br><span class="line">SIGEMT <span class="number">7</span> <span class="number">0</span></span><br><span class="line">SIGFPE <span class="number">8</span> <span class="number">0</span></span><br><span class="line">SIGHUP <span class="number">1</span> &lt;function handle_hup at <span class="number">0x109371c80</span>&gt;</span><br><span class="line">SIGILL <span class="number">4</span> <span class="number">0</span></span><br><span class="line">SIGINFO <span class="number">29</span> <span class="number">0</span></span><br><span class="line">SIGINT <span class="number">2</span> &lt;built-in function default_int_handler&gt;</span><br><span class="line">SIGIO <span class="number">23</span> <span class="number">0</span></span><br><span class="line">SIGIOT <span class="number">6</span> <span class="number">0</span></span><br><span class="line">SIGKILL <span class="number">9</span> None</span><br><span class="line">SIGPIPE <span class="number">13</span> <span class="number">1</span></span><br><span class="line">SIGPROF <span class="number">27</span> <span class="number">0</span></span><br><span class="line">SIGQUIT <span class="number">3</span> <span class="number">0</span></span><br><span class="line">SIGSEGV <span class="number">11</span> <span class="number">0</span></span><br><span class="line">SIGSTOP <span class="number">17</span> None</span><br><span class="line">SIGSYS <span class="number">12</span> <span class="number">0</span></span><br><span class="line">SIGTERM <span class="number">15</span> <span class="number">0</span></span><br><span class="line">SIGTRAP <span class="number">5</span> <span class="number">0</span></span><br><span class="line">SIGTSTP <span class="number">18</span> <span class="number">0</span></span><br><span class="line">SIGTTIN <span class="number">21</span> <span class="number">0</span></span><br><span class="line">SIGTTOU <span class="number">22</span> <span class="number">0</span></span><br><span class="line">SIGURG <span class="number">16</span> <span class="number">0</span></span><br><span class="line">SIGUSR1 <span class="number">30</span> <span class="number">0</span></span><br><span class="line">SIGUSR2 <span class="number">31</span> <span class="number">0</span></span><br><span class="line">SIGVTALRM <span class="number">26</span> <span class="number">0</span></span><br><span class="line">SIGWINCH <span class="number">28</span> <span class="number">0</span></span><br><span class="line">SIGXCPU <span class="number">24</span> <span class="number">0</span></span><br><span class="line">SIGXFSZ <span class="number">25</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li><code>å¤šçº¿ç¨‹ä½¿ç”¨ä¿¡å·</code><br>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ä¿¡å·ï¼Œåªæœ‰main threadå¯ä»¥è®¾ç½®signalçš„handlerï¼Œä¹Ÿæœ‰å®ƒèƒ½æ¥æ”¶åˆ°signal.  ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­çœ‹çœ‹æ•ˆæœã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#orangleliu py2.7</span></span><br><span class="line"><span class="comment">#thread_signal.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">usr1_handler</span><span class="params">(num, frame)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"received signal %s %s"</span>%(num, threading.currentThread())</span><br><span class="line"></span><br><span class="line">signal.signal(signal.SIGUSR1, usr1_handler)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_get_signal</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#å¦‚æœåœ¨å­çº¿ç¨‹ä¸­è®¾ç½®signalçš„handler ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="comment">#ValueError: signal only works in main thread</span></span><br><span class="line">    <span class="comment">#signal.signal(signal.SIGUSR2, usr1_handler)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"waiting for signal in"</span>, threading.currentThread()</span><br><span class="line">    <span class="comment">#sleep è¿›ç¨‹ç›´åˆ°æ¥æ”¶åˆ°ä¿¡å·</span></span><br><span class="line">    signal.pause()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"waiting done"</span></span><br><span class="line"></span><br><span class="line">receiver = threading.Thread(target=thread_get_signal, name=<span class="string">"receiver"</span>)</span><br><span class="line">receiver.start()</span><br><span class="line">time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_signal</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"sending signal in "</span>, threading.currentThread()</span><br><span class="line">    os.kill(os.getpid(), signal.SIGUSR1)</span><br><span class="line"></span><br><span class="line">sender = threading.Thread(target=send_signal, name=<span class="string">"sender"</span>)</span><br><span class="line">sender.start()</span><br><span class="line">sender.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'pid'</span>, os.getpid()</span><br><span class="line"><span class="comment">#è¿™é‡Œæ˜¯ä¸ºäº†è®©ç¨‹åºç»“æŸï¼Œå”¤é†’pause</span></span><br><span class="line">signal.alarm(<span class="number">2</span>)</span><br><span class="line">receiver.join()</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># python thread_signal.py</span><br><span class="line">waiting for signal in <span class="tag">&lt;<span class="name">Thread(receiver,</span> <span class="attr">started</span> <span class="attr">123145306509312</span>)&gt;</span></span><br><span class="line">sending signal in  <span class="tag">&lt;<span class="name">Thread(sender,</span> <span class="attr">started</span> <span class="attr">123145310715904</span>)&gt;</span></span><br><span class="line">received signal 30 <span class="tag">&lt;<span class="name">_MainThread(MainThread,</span> <span class="attr">started</span> <span class="attr">140735138967552</span>)&gt;</span></span><br><span class="line">pid 23188</span><br><span class="line">[1]    23188 alarm      python thread_signal.py</span><br></pre></td></tr></table></figure><ul><li><code>å¤šè¿›ç¨‹ä½¿ç”¨ä¿¡å·</code></li></ul><p>ä¸»è¦æ˜¯æ¨¡æ‹Ÿä¸‹pre-forkæ¨¡å¼ï¼Œä»£ç æ¯”è¾ƒé•¿ï¼Œå¦å†™ä¸€ç¯‡æ¥è¯´æ˜ [Python ä¸­pre-forkæ¨¡å¼çš„ç®€å•å®ç°]</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://docs.python.org/2/library/signal.html" target="_blank" rel="noopener">python docs - signal</a></li><li><a href="https://pymotw.com/2/signal/" target="_blank" rel="noopener">pymotw - signal</a></li><li><a href="http://itsjustsosimple.blogspot.com/2014/01/python-signal-handling-and-identifying.html" target="_blank" rel="noopener">Python - Signal handling and identifying stack frame</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¿¡å·æ˜¯Unixç³»ç»Ÿä¸­å¸¸è§çš„ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼ˆIPCï¼‰ï¼Œä¾‹å¦‚æˆ‘ä»¬ç»å¸¸æ“ä½œçš„ &lt;code&gt;kill -9 pid&lt;/code&gt; è¿™é‡Œçš„ &lt;code&gt;-9&lt;/code&gt;å¯¹åº”çš„å°±æ˜¯ SIGKILL ä¿¡å·, 9å°±æ˜¯è¿™ä¸ªä¿¡
      
    
    </summary>
    
      <category term="python" scheme="http://orangleliu.info/categories/python/"/>
    
    
      <category term="ç³»ç»Ÿç¼–ç¨‹" scheme="http://orangleliu.info/tags/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>2016å¹´åé¢è¯•ä¹‹æ—…</title>
    <link href="http://orangleliu.info/2016/02/26/2016-spring-interview-travel/"/>
    <id>http://orangleliu.info/2016/02/26/2016-spring-interview-travel/</id>
    <published>2016-02-26T05:45:11.000Z</published>
    <updated>2017-03-20T11:08:55.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>ä»æ¯•ä¸šåˆ°ç°åœ¨3å¹´æœ‰ä½™äº†å§ï¼Œ3ä»½å·¥ä½œåŠ ä¸€èµ·çš„é¢è¯•ç»éªŒä¹Ÿå°±3ï¼Œ4æ¬¡å·¦å³çš„æ ·å­ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŠ•äº†ä¸€å®¶å…¬å¸ï¼Œé¢å®Œå°±å»ä¸Šç­äº†ï¼ˆå› ä¸ºæˆ‘è¦çš„å·¥èµ„ä½å‘€ã€‚ã€‚ï¼‰ã€‚ä»Šå¹´è¿‡å¹´çš„æ—¶å€™çº ç»“äº†å¾ˆä¹…ï¼Œæƒ³æƒ³å½“å‰çš„å·¥èµ„çš„ç¡®éš¾ä»¥å…»å®¶ç³Šå£äº†ï¼Œè™½ç„¶æ²¡æƒ³å¥½åˆ°åº•æ¢ä¸æ¢å·¥ä½œï¼Œä½†æ˜¯é¢è¯•çš„å¿µå¤´å·²ç»å®šä¸‹æ¥äº†ã€‚ä¸€æ–¹é¢çœ‹çœ‹è¿™ä¸ªå·¥ä½œå¹´é™çš„éƒ½ä¼šé¢äº›ä»€ä¹ˆï¼Œä¸€æ–¹é¢ä¹Ÿæƒ³è¯•è¯•è‡ªå·±çš„æ°´å¹³ï¼Œè¿˜æœ‰å¤§å®¶ç»å¸¸è®¨è®ºå¤§å…¬å¸å°å…¬å¸çš„åŒºåˆ«ï¼Œæƒ³å»ä½“ä¼šä½“ä¼šã€‚</p><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>è¿™æ˜¯å¹´åçš„ç¬¬äºŒå‘¨ï¼Œä¸€å…±é¢äº†3ä¸ªå…¬å¸ï¼ŒåŸºæœ¬éƒ½æ˜¯å¤±è´¥å‘Šç»ˆï¼ˆæœç‹è¿˜æ²¡é€šçŸ¥ï¼Œå‰ä¸¤å®¶æ˜¯è¿™ä¹ˆå›äº‹ï¼‰ã€‚</p><h4 id="æŸå®‰å“åŠ©æ‰‹"><a href="#æŸå®‰å“åŠ©æ‰‹" class="headerlink" title="æŸå®‰å“åŠ©æ‰‹"></a>æŸå®‰å“åŠ©æ‰‹</h4><p>ç¬¬ä¸€å®¶æ˜¯ä¸ªåœ¨<strong>å››æƒ </strong>çš„å…¬å¸ï¼Œæ‹‰å‹¾ä¸Šé‚€è¯·å»é¢è¯•çš„ï¼Œç»“æœæ‰‹è´±åŒæ„äº†ï¼Œçº¦äº†ä¸ªå‘¨ä¸€ä¸Šåˆã€‚é¢è¯•ä¹‹å‰å‡ ä¹æ˜¯ä¸€ç‚¹éƒ½æ²¡å‡†å¤‡å§ï¼Œåˆ°äº†é‚£é¦–å…ˆåšäº†ä¸ªé¢˜ï¼ˆhrè¿ä¸ªæ°´éƒ½æ²¡æœ‰ç»™å‘€ï¼‰ï¼Œç„¶åæ¥äº†ä¸€ä¸ªäººå¼€å§‹é¢ã€‚é¢˜ç›®å¤§æ¦‚å°±æ˜¯é“¾è¡¨å’‹å®ç°ï¼Œpyå­—ç¬¦ç¼–ç é—®é¢˜ï¼Œè¯´å®è¯ï¼Œæˆ‘åŸºæœ¬éƒ½æ²¡ç­”ä¸Šæ¥ï¼Œå› ä¸ºä»¥å‰æœ‰é—®é¢˜è§£å†³è¿‡äº†å°±å¾ˆå°‘æœ‰è¿™ç§é—®é¢˜äº†ï¼Œä¹Ÿä¸è®°å¾—æ€ä¹ˆè§£å†³äº†ã€‚åŸºæœ¬ä¸Šéƒ½æ˜¯è¿™äº›åˆšå­¦ç¼–ç¨‹çš„é—®é¢˜å§ï¼Œä¸‰ä¸ªé—®é¢˜è¯´çš„æˆ‘ä¹Ÿæ²¡å•¥åº•æ°”äº†ï¼Œé‚£ä¸ªé¢è¯•å®˜è¿˜æœ‰ç‚¹å°é«˜å‚²ï¼Œå†åŠ ä¸Šé‚£æ€åº¦ï¼ˆå…¶å®æˆ‘ä¹Ÿå‘µå‘µï¼‰ã€‚åæ¥å°±ç»“æŸäº†ã€‚ã€‚ã€‚ç»™æˆ‘çš„æ„Ÿè§‰æ˜¯è‡ªä»¥ä¸ºæ˜¯ï¼Œä¸“é—¨æ‰£ç»†èŠ‚ï¼Œå¦‚æœæˆ‘æ‰¾ç‚¹é¢˜ç›®åšä¸‹ï¼Œé‚£å¯ä¸å°±æ˜¯å•¥éƒ½ä¼šäº†å‘€ã€‚</p><h4 id="çŸ¥ä¹"><a href="#çŸ¥ä¹" class="headerlink" title="çŸ¥ä¹"></a>çŸ¥ä¹</h4><p>ç¬¬äºŒä¸ªæ˜¯<strong>çŸ¥ä¹</strong>ï¼Œæˆ‘æ˜¯æ‰¾äº†ä¸ªå¾®ä¿¡ä¸Šçš„æœ‹å‹å†…æ¨çš„ï¼ŒæŠ•é€’çš„èŒä½æ˜¯ä¸ªæ¯”è¾ƒé™Œç”Ÿçš„appåç«¯å¼€å‘ï¼ˆæˆ‘çœ‹äº†jdå°±æ„Ÿè§‰è¿™ä¸ªæ¯”è¾ƒæœ‰æ„æ€ï¼‰ã€‚è¿™æ¬¡hræ¯”è¾ƒçƒ­å¿ƒï¼Œé—®é—®ä»å“ªæ¥çš„å‘€ï¼Œå¼„ç‚¹çƒ­æ°´ä¹‹ç±»çš„ã€‚é¢è¯•å®˜æ¯”è¾ƒå¹´è½»ï¼Œæ²¡æœ‰ç­”é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯é—®äº›é—®é¢˜ï¼Œæœ‰ä¸€äº›åœ¨çº¸ä¸Šç”»ç”»ã€‚åŸºæœ¬éƒ½æ˜¯æŒ‰ç…§æˆ‘è‡ªå·±å†™çš„èŒä¸šæŠ€èƒ½æ¥é—®çš„ï¼Œæœ‰ä¸€äº›é—®å¾—æŒºåˆç†ï¼Œæ²¡ç­”å‡ºæ¥ï¼Œæœ‰ä¸€äº›å°±æ¯”è¾ƒæ€ªå¼‚ï¼ˆå¯èƒ½ä»–ä»¬ç”¨çš„å¤šä¸€äº›ï¼Œå…¶å®æˆ‘å¹¶ä¸çŸ¥é“ï¼‰ï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ä»–è¯´çš„å°±æœ‰é—®é¢˜ï¼Œå¤§éƒ¨åˆ†å›ç­”çš„æŒºä¸€èˆ¬ï¼Œæ²¡æ¥è§¦è¿‡çš„ï¼Œæ¥è§¦è¿‡å¿˜æ‰çš„ï¼Œå°±ç›´æ¥è¯´äº†ã€‚æ€»å¾—æ¥è¯´é¢è¯•ç»“æœä¸å¤ªå¥½ï¼Œè¿‡ç¨‹æ°”æ°›è¿˜æ˜¯ä¸é”™çš„ã€‚ æœ€åç»™çš„æ‹’ç»åŸå› æ˜¯ â€œæŠ€æœ¯ç»†èŠ‚ä¸ç†Ÿæ‚‰â€ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç°åœ¨çš„ä¸€ä¸ªé—®é¢˜å§ã€‚æ¥è§¦çš„ä¸œè¥¿å¤šï¼Œä½†æ˜¯ä¸ç²¾é€šï¼Œæœ‰ä¸»åŠ¨è§£å†³é—®é¢˜èƒ½åŠ›ï¼Œæœ‰ç‚¹ä¸æ±‚ç”šè§£ã€‚</p><h4 id="sohu"><a href="#sohu" class="headerlink" title="sohu"></a>sohu</h4><p>ç¬¬ä¸‰ä¸ªæ˜¯<strong>æœç‹æ‰‹æœºç½‘</strong>(m.sohu.com),è¿™æ˜¯æ‰¾<a href="http://www.the5fire.com" target="_blank" rel="noopener">@the5fire</a>å†…æ¨çš„ã€‚ æˆ‘å…ˆæ˜¯åœ¨qqä¸Šè¯´äº†æƒ³æ³•ï¼Œç„¶åæŠŠç®€å†ç»™ä»–ï¼Œç„¶åç»™äº†æˆ‘ä¸€ä¸ªé¢˜ç›®ã€‚ä¸€å‘¨æ—¶é—´æŠŠé¢˜ç›®åšå®Œï¼Œä»Šå¤©å»é¢çš„ã€‚æœç‹çš„åª’ä½“å¤§å¦æŒºæ°”æ´¾çš„ï¼Œç¬¬ä¸€è½®æ˜¯ä¸¤ä¸ªåŒäº‹é¢çš„ï¼Œä¹Ÿæ˜¯èŠå¤©æ–¹å¼ã€‚ä»–ä»¬é—®çš„é—®é¢˜ç›¸å¯¹å‰ä¸¤å®¶å°±å…¨é¢çš„å¤šäº†ï¼Œä¸ç®¡æ˜¯å¸¸ç”¨çš„æ¡†æ¶ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ¶æ„ï¼Œè¿˜æ˜¯ç½‘ç»œåè®®ï¼ŒLinuxéƒ½æœ‰æ¶‰åŠå§ï¼Œæˆ‘å›ç­”çš„ä¹Ÿæ˜¯ä¸€åŠå¯¹ä¸€åŠå§ã€‚ç¬¬äºŒè½®æ˜¯<a href="http://www.the5fire.com" target="_blank" rel="noopener">@the5fire</a>ï¼Œé—®çš„æ¯”è¾ƒç»†è‡´ï¼Œä¹ŸæŒºæœ‰æ·±åº¦ï¼Œéƒ½æ˜¯å¹³æ—¶ç”¨çš„ä¸œè¥¿æ¯”è¾ƒæ·±å…¥ä¸€äº›çš„æ€è€ƒï¼Œä¼šçš„ä¸ä¼šçš„æˆ‘éƒ½ä¸€äº”ä¸€åçš„è¯´äº†ã€‚å°½ç®¡æ˜¯è®¤è¯†ï¼Œé¢è¯•è¿˜æ˜¯è¦è¯¥æ€ä¹ˆæ ·å°±æ€ä¹ˆæ ·çš„ï¼Œå¯¹äºä¸æ¸…æ¥šçš„ï¼Œæœ‰äº›ä¹Ÿç»™æˆ‘è§£ç­”äº†ï¼Œç®—æ˜¯å­¦åˆ°äº†ä¸€äº›æ–°çŸ¥è¯†ï¼ŒæŒºä¸é”™ã€‚ æ€»ç»“ä¸‹å°±æ˜¯å¹¿åº¦è¿˜å¯ä»¥ï¼Œæ·±åº¦æ¯”è¾ƒæ¬ ç¼ºï¼Œç»™è‡ªå·±æ‰“åˆ†ä¹Ÿæ˜¯ä¸åŠæ ¼çš„ã€‚</p><h3 id="æƒ³æ³•"><a href="#æƒ³æ³•" class="headerlink" title="æƒ³æ³•"></a>æƒ³æ³•</h3><p>é€šè¿‡è¿™å‡ ä¸ªé¢è¯•ï¼Œçœ‹åˆ°äº†å¾ˆå¤šè‡ªå·±çš„ä¸è¶³ï¼Œå¯¹åé¢ä¸€æ®µæ—¶é—´çš„æˆé•¿éå¸¸æœ‰å¸®åŠ©ï¼Œæ„Ÿè°¢ç»™æˆ‘é¢è¯•æœºä¼šçš„è¿™äº›å…¬å¸ã€‚åŒæ—¶ä¹Ÿçœ‹åˆ°ä¸åŒå…¬å¸å¯¹äºé¢è¯•çš„æ€åº¦ï¼ŒçœŸæ˜¯ä»€ä¹ˆæ ·çš„å¥‡è‘©éƒ½æœ‰å‘€ã€‚é¢è¯•è¿˜æ˜¯æŒºæœ‰æ”¶è·çš„ï¼Œç»§ç»­åŠ æ²¹å§ï¼Œæé«˜è§£å†³é—®é¢˜çš„èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿè¦æ·±å…¥çš„ç ”ç©¶ä¸‹è‡ªå·±çš„ä½¿ç”¨çš„æŠ€æœ¯ï¼ŒçŸ¥å…¶ç„¶ä¹Ÿè¦çŸ¥æ‰€ä»¥ç„¶ã€‚æŠŠæ›´å¤šæ—¶é—´ç”¨åœ¨æŠ€æœ¯æ·±åº¦ä¸Šï¼Œä¸è¦èŠ±å¤ªå¤šçš„æ—¶é—´åœ¨å¹¿åº¦ä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h3&gt;&lt;p&gt;ä»æ¯•ä¸šåˆ°ç°åœ¨3å¹´æœ‰ä½™äº†å§ï¼Œ3ä»½å·¥ä½œåŠ ä¸€èµ·çš„é¢è¯•ç»éªŒä¹Ÿå°±3ï¼Œ4æ¬¡å·¦å³çš„æ ·å­ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŠ•äº†ä¸€å®¶å…¬å¸ï¼Œé¢å®Œå°±
      
    
    </summary>
    
      <category term="æ€»ç»“" scheme="http://orangleliu.info/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="é¢è¯•" scheme="http://orangleliu.info/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="æœç‹" scheme="http://orangleliu.info/tags/%E6%90%9C%E7%8B%90/"/>
    
  </entry>
  
</feed>
